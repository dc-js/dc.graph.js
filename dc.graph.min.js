/*!
 *  dc.graph 0.6.0-beta.6
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015-2016 AT&T Intellectual Property & the dc.graph.js Developers
 *  https://github.com/dc-js/dc.graph.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 */

!function(){function e(ce,le,se){"use strict";var de={version:"0.6.0-beta.6",constants:{CHART_CLASS:"dc-graph"}};function fe(e){return e.orig}function ge(e){return e}var he=function(e,n){void 0===n?n=fe:!1===n&&(n=ge);var t=e,r=null,o=[],a=function(e){return arguments.length?(r&&r(e),t=e,this):t};return a.cascade=function(e,t){for(var n=0;n<o.length;++n){if(o[n].n===e)return t?o[n].f=t:delete o[n],a;if(o[n].n>e)return o.splice(n,0,{n:e,f:t}),a}return o.push({n:e,f:t}),a},a._eval=function(e,t){return 0!==t&&o.length?o[t-1].f(e,function(){return a._eval(e,t-1)}):de.functor_wrap(a(),n)(e)},a.eval=function(e){return a._eval(e,o.length)},a.react=function(e){return arguments.length?(r=e,this):r},a};function pe(){var n={},e=function(e,t){return 1===arguments.length?n[e]:(n[e]===t||(n[e]&&n[e].parent(null),(n[e]=t)&&t.parent(this)),this)};return e.enum=function(){return Object.keys(n)},e.nameOf=function(t){var e=Object.entries(n).find(function(e){return e[1]==t});return e?e[0]:null},e}function ye(e,t){var n=he(t),r=function(){return arguments.length?(console.warn(e),n.apply(he,arguments),this):n()};return["cascade","_eval","eval","react"].forEach(function(e){r[e]=n[e]}),r}function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function ve(e){try{return e.getBBox()}catch(e){return{x:0,y:0,width:0,height:0}}}function n(n,r){return function(e,t){return n(e)?r(e):t()}}function t(n,r){return function(e,t){return ce.interpolate(t(e),r(e))(n(e))}}function f(e,t,n){var r={};for(var o in t)r[o]=n(e,xe(t[o]));return r}function c(e,t){return f(e,t,n)}function b(e,t,n){var r={},o={},a=[];for(var i in n)/^node/.test(i)?r[i]=n[i]:/^edge/.test(i)?o[i]=n[i]:a.push(i);a.length&&console.error('only know how to deal with properties that start with "node" or "edge"',a);var u=e?c(e,r):{};return t&&Object.assign(u,c(t,o)),u}function me(o){return function(e,t,n){for(var r in n){if(!o[r])throw new Error("unknown attribute "+r);o[r].cascade(e,t?n[r]:null)}return o}}function xe(e){return de.functor_wrap(e,fe)}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n},writable:!0,configurable:!0}),de.functor_wrap=function(t,n){return"function"==typeof t?n?function(e){return t(n(e))}:t:function(){return t}};var i={1:"L",2:"Q",3:"C"};function _e(e,t,n){for(var r=["M",e[0].x,",",e[0].y],o=t,a=1;a<e.length;++a)(isNaN(e[a].x)||isNaN(e[a].y))&&!0,r.push(o===t?i[t]:" ",e[a].x,",",e[a].y),0==--o&&(o=t);return o!=t&&console.log("warning: pts.length didn't match bezian degree",e,t),n&&r.push("Z"),r.join("")}Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,n=0;n<t;n++){if(arguments[n]===1/0||arguments[n]===-1/0)return 1/0;e+=arguments[n]*arguments[n]}return Math.sqrt(e)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var a=t[o];if(e.call(r,a,o,t))return a;o++}}});var r,u=function(){if(void 0===r){r=null;var e="dc.graph.js",t=document.getElementsByTagName("script");if(t&&0<t.length)for(var n in t)if(t[n].src&&t[n].src.match(new RegExp(e+"$"))){r=t[n].src.replace(new RegExp("(.*)"+e+"$"),"$1");break}}return r};function k(e){return Promise.resolve(e)}de.event_coords=function(e){var t=e.root().node().getBoundingClientRect();return e.invertCoord([ce.event.clientX-t.left,ce.event.clientY-t.top])};var x=-1!==navigator.platform.toUpperCase().indexOf("MAC");function a(e,t){return!!ce.select(e).classed(t)||e.parentElement&&a(e.parentElement,t)}function be(r,e,t,o,a,i,n){i||(i=function(e,t){}),n||(n=function(e){});var u={};var c=e.map(function(e){var t=o(e);r[t]||i(t,r[t]={},e);var n=r[t];return a(n,e),u[t]=!0,n});for(var l in t&&t.forEach(function(e){r[e]||(i(e,r[e]={},null),a(r[e],null)),u[e]||(c.push(r[e]),u[e]=!0)}),r)u[l]||(n(l,r[l]),delete r[l]);return c}de.depth_first_traversal=function(d){return function(e,t){d.init&&d.init(),d.tree&&(t=t.filter(function(e){return d.tree(e)}));var n,i={},u=t.reduce(function(e,t){var n=d.sourceid(t),r=d.targetid(t);return e[n]||(e[n]=[]),e[n].push(t),i[r]=(i[r]||0)+1,e},{}),c=e.reduce(function(e,t){return e[d.nodeid(t)]=t,e},{}),l=[],s={};d.root?n=e.filter(function(e){return d.root(e)}):(n=e.filter(function(e){return!i[d.nodeid(e)]}),e.length&&!n.length&&(n=[e[0]])),n.forEach(function(e,t){t&&d.sib&&d.sib(!0,n[t-1],e),d.push&&d.push(),function r(e,o){var a=d.nodeid(e);s[a]?d.skip&&d.skip(e,i[a]):(l[o]||(l[o]=[]),d.place&&d.place(e,o,l[o]),l[o].push(e),s[a]=!0,u[a]&&u[a].forEach(function(e,t){var n=c[d.targetid(e)];t&&d.sib&&d.sib(!1,c[d.targetid(u[a][t-1])],n),d.push&&d.push(),r(n,o+1)}),d.pop&&d.pop(e))}(e,d.row&&d.row(e)||0)}),d.finish(l)}},de.undirected_dfs=function(u){return function(e,t){var r=t.reduce(function(e,t){var n=u.sourceid(t),r=u.targetid(t);return e[n]||(e[n]=[]),e[r]||(e[r]=[]),e[n].push(r),e[r].push(n),e},{}),o=e.reduce(function(e,t){return e[u.nodeid(t)]=t,e},{}),a={};var i=0;e.forEach(function(e){a[u.nodeid(e)]||(u.comp&&u.comp(i),function t(e){var n=u.nodeid(e);u.node(i,e),a[n]=!0,r[n]&&r[n].forEach(function(e){a[e]||t(o[e])})}(e),++i)})}};var o=1e-7;function s(e,t,n){return e-o<=t&&t<=n+o}function l(e,t,n,r,o,a,i,u){var c=((e*r-t*n)*(o-i)-(e-n)*(o*u-a*i))/((e-n)*(a-u)-(t-r)*(o-i)),l=((e*r-t*n)*(a-u)-(t-r)*(o*u-a*i))/((e-n)*(a-u)-(t-r)*(o-i));if(isNaN(c)||isNaN(l))return!1;if(n<=e){if(!s(n,c,e))return!1}else if(!s(e,c,n))return!1;if(r<=t){if(!s(r,l,t))return!1}else if(!s(t,l,r))return!1;if(i<=o){if(!s(i,c,o))return!1}else if(!s(o,c,i))return!1;if(u<=a){if(!s(u,l,a))return!1}else if(!s(a,l,u))return!1;return{x:c,y:l}}function d(e,t,n,r,o){for(var a=0;a<e.length;++a){var i=a===e.length-1?0:a+1,u=l(e[a].x,e[a].y,e[i].x,e[i].y,t,n,r,o);if(u)return u}return null}de.shape_presets={egg:{generator:"polygon",preset:function(){return{sides:100,distortion:-.25}}},triangle:{generator:"polygon",preset:function(){return{sides:3}}},rectangle:{generator:"polygon",preset:function(){return{sides:4}}},diamond:{generator:"polygon",preset:function(){return{sides:4,rotation:45}}},trapezium:{generator:"polygon",preset:function(){return{sides:4,distortion:-.5}}},parallelogram:{generator:"polygon",preset:function(){return{sides:4,skew:.5}}},pentagon:{generator:"polygon",preset:function(){return{sides:5}}},hexagon:{generator:"polygon",preset:function(){return{sides:6}}},septagon:{generator:"polygon",preset:function(){return{sides:7}}},octagon:{generator:"polygon",preset:function(){return{sides:8}}},invtriangle:{generator:"polygon",preset:function(){return{sides:3,rotation:180}}},invtrapezium:{generator:"polygon",preset:function(){return{sides:4,distortion:.5}}},square:{generator:"polygon",preset:function(){return{sides:4,regular:!0}}},plain:{generator:"rounded-rect",preset:function(){return{noshape:!0}}}},de.available_shapes=function(){var e=Object.keys(de.shape_presets);return e.slice(0,e.length-1)};var we={shape:"ellipse"};function ke(n){return function(e){var t=n.nodeShape.eval(e)||we;e.dcg_shape=function(e,t){"string"==typeof t&&(t={shape:t});var n=t.shape,r=Object.assign({},t);if(delete r.shape,"random"===n){var o=de.available_shapes();n=o[Math.floor(Math.random()*o.length)]}else if(-1!==e.shape.enum().indexOf(n))return e.shape(n).elaborate({shape:n},r);if(!de.shape_presets[n])return console.warn("unknown shape ",n),we;var a=de.shape_presets[n].preset(r);return a.shape=de.shape_presets[n].generator,e.shape(a.shape).elaborate(a,r)}(n,t),e.dcg_shape.abstract=t}}function Ee(e,t){var n=e.nodeLabelPadding.eval(t);return"number"==typeof n||"string"==typeof n?{x:+n,y:+n}:n}function S(e,t,n){var r=100;if(0<=e(t).val)throw new Error("f(a) must be less than 0");if(e(n).val<=0)throw new Error("f(b) must be greater than 0");for(;;){if(!--r)throw new Error("patience ran out");var o=(t+n)/2,a=e(o),i=a.val;if(Math.abs(i)<.5)return a;0<i?n=o:t=o}}function Ke(u,e,t,n,r,o,a,i,c,l,s){var d,f,g,h;if(a){var p,y,v=function(o,a,i){return function(e){var t,n,r=(t=o,n=e,u.shape(t.dcg_shape.shape).intersect_vec(t,1e3*Math.cos(n),1e3*Math.sin(n)));return r?{port:r,val:Math.hypot(r.x-a.x,r.y-a.y)-i,ang:e}:{port:{x:0,y:0},val:0,ang:e}}},m=Math.atan2(a.sourcePort.y,a.sourcePort.x),x=Math.atan2(a.targetPort.y,a.targetPort.x);try{p=S(v(e.source,a.sourcePort,c),m,m+2*i*c/l)}catch(e){p={ang:m,port:a.sourcePort}}try{y=S(v(e.target,a.targetPort,c),x,x-2*i*c/l)}catch(e){y={ang:x,port:a.targetPort}}d=p.port,f=y.port;var _=Math.hypot(d.x,d.y)+l/2,b=Math.hypot(f.x,f.y)+s/2,w=t+_*Math.cos(p.ang),k=n+_*Math.sin(p.ang),E=r+b*Math.cos(y.ang),K=o+b*Math.sin(y.ang);g=[{x:t+d.x,y:n+d.y},{x:w,y:k},{x:E,y:K},{x:r+f.x,y:o+f.y}],h=3}else(d=e.sourcePort.pos)||(d={x:0,y:0}),(f=e.targetPort.pos)||(f={x:0,y:0}),g=[{x:t+d.x,y:n+d.y},{x:r+f.x,y:o+f.y}],h=1;return{sourcePort:d,targetPort:f,points:g,bezDegree:h}}function Se(e){return 1===e.bezDegree&&2===e.points.length||3===e.bezDegree&&4===e.points.length}function Ae(e){var t=e.points;if(3===e.bezDegree)return t;if(1===e.bezDegree)return[{x:t[0].x,y:t[0].y},{x:t[0].x+(t[1].x-t[0].x)/3,y:t[0].y+(t[1].y-t[0].y)/3},{x:t[0].x+2*(t[1].x-t[0].x)/3,y:t[0].y+2*(t[1].y-t[0].y)/3},{x:t[1].x,y:t[1].y}];throw new Error("unknown bezDegree "+e.bezDegree)}function g(e,t){for(var n=[],r=1;r<e.length;r++){var o=e[r-1],a=e[r];n.push({x:o.x+(a.x-o.x)*t,y:o.y+(a.y-o.y)*t})}return n}function Pe(e,t){var n=function(e,t){for(var n=[e],r=1;r<e.length;r++)n.push(g(n[n.length-1],t));return n}(e,t);return n[n.length-1][0]}function Ne(e,t){for(var n,r,o,a,i,u,c,l,s,d,f,g,h,p,y,v,m,x,_,b,w,k,E=[];1<t;){var K=(r=1/t,void 0,o=(n=e)[0].x,a=n[0].y,i=n[1].x,u=n[1].y,c=n[2].x,l=n[2].y,s=n[3].x,d=n[3].y,[[{x:o,y:a},{x:f=(i-o)*r+o,y:g=(u-a)*r+a},{x:m=((h=(c-i)*r+i)-f)*r+f,y:x=((p=(l-u)*r+u)-g)*r+g},{x:w=((_=((y=(s-c)*r+c)-h)*r+h)-m)*r+m,y:k=((b=((v=(d-l)*r+l)-p)*r+p)-x)*r+x}],[{x:w,y:k},{x:_,y:b},{x:y,y:v},{x:s,y:d}]]);E.push(K[0][0],K[0][1],K[0][2]),e=K[1],--t}return E.push.apply(E,e),E}de.no_shape=function(){return{parent:he(null),elaborate:function(e,t){return Object.assign(e,t)},useTextSize:function(){return!1},useRadius:function(){return!1},usePaddingAndStroke:function(){return!1},intersect_vec:function(e,t,n){return{x:0,y:0}},calc_radii:function(e,t,n){return{rx:0,ry:0}},create:function(e){},replace:function(e){},update:function(e){}}},de.ellipse_shape=function(){var t={parent:he(null),elaborate:function(e,t){return Object.assign(e,t)},intersect_vec:function(e,t,n){return function(e,t,n,r){var o=Math.tan(Math.atan2(r,n));o*=o;var a={x:e*t/Math.sqrt(t*t+e*e*o),y:e*t/Math.sqrt(e*e+t*t/o)};return n<0&&(a.x=-a.x),r<0&&(a.y=-a.y),a}(e.dcg_rx,e.dcg_ry,t,n)},calc_radii:function(e,t,n){t=Math.max(t,n.height/2+5);var r=n.width/2,o=n.height/2/t;return r/=Math.sqrt(1-o*o),{rx:r=Math.max(r,t),ry:t}},create:function(e){e.insert("ellipse",":first-child").attr("class","node-shape")},update:function(e){e.select("ellipse.node-shape").attr((t.parent(),{rx:function(e){return e.dcg_rx},ry:function(e){return e.dcg_ry}}))}};return t},de.polygon_shape=function(){var t={parent:he(null),elaborate:function(e,t){return Object.assign(e,t)},intersect_vec:function(e,t,n){return d(e.dcg_points,0,0,t,n)},calc_radii:function(e,t,n){t=Math.max(t,n.height/2+5);var r=n.width/2;return{rx:r=r*Math.sqrt(2)/Math.cos(Math.PI/(e.dcg_shape.sides||4)),ry:t}},create:function(e){e.insert("path",":first-child").attr("class","node-shape")},update:function(e){e.select("path.node-shape").attr((t.parent(),{d:function(e){var r=e.dcg_rx,o=e.dcg_ry,t=e.dcg_shape,n=t.sides||4,a=t.skew||0,i=t.distortion||0,u=t.rotation||0,c=n%2?0:.5,l=[];u=u/360+.25;for(var s=0;s<n;++s){var d=-((s+c)/n+u)*Math.PI*2;l.push({x:Math.cos(d),y:Math.sin(d)})}var f=ce.extent(l,function(e){return e.y});return t.regular?r=o=Math.max(r,o):r<o&&!t.squeeze?r=o:o/=Math.min(-f[0],f[1]),e.dcg_points=l.map(function(e){var t=r*e.x,n=o*e.y;return t*=1+i*((o-n)/o-1),{x:t-=a*n/2,y:n}}),_e(e.dcg_points,1,!0)}}))}};return t},de.rounded_rectangle_shape=function(){return{parent:he(null),elaborate:function(e,t){return e=Object.assign({rx:10,ry:10},e),Object.assign(e,t)},intersect_vec:function(e,t,n){return d([{x:e.dcg_rx,y:e.dcg_ry},{x:e.dcg_rx,y:-e.dcg_ry},{x:-e.dcg_rx,y:-e.dcg_ry},{x:-e.dcg_rx,y:e.dcg_ry}],0,0,t,n)},useRadius:function(e){return!e.noshape},calc_radii:function(e,t,n){var r=n.height/2;return e.dcg_shape.noshape||(r+=5),{rx:n.width/2,ry:Math.max(t,r)}},create:function(e){e.filter(function(e){return!e.dcg_shape.noshape}).insert("rect",":first-child").attr("class","node-shape")},update:function(e){e.select("rect.node-shape").attr({x:function(e){return-e.dcg_rx},y:function(e){return-e.dcg_ry},width:function(e){return 2*e.dcg_rx},height:function(e){return 2*e.dcg_ry},rx:function(e){return e.dcg_shape.rx+"px"},ry:function(e){return e.dcg_shape.ry+"px"}})}}},de.text_contents=function(){var a={parent:he(null),update:function(e){var t=e.selectAll("text.node-label").data(function(e){return[e]});t.enter().append("text").attr("class","node-label");var n=t.selectAll("tspan").data(function(n){var e=a.parent().nodeLabel.eval(n);if(!e)return[];"string"==typeof e&&(e=[e]);var r=a.parent().nodeLineHeight(),o=1-((e.length-1)*r+1)/2;return e.map(function(e,t){return{node:n,line:e,yofs:(0==t?o:r)+"em"}})});n.enter().append("tspan"),n.attr({"text-anchor":"start",x:0}).text(function(e){return e.line}),t.each(function(e){e.xofs=0}).filter(function(e){return"center"!==a.parent().nodeLabelAlignment.eval(e)}).each(function(e){var t=ve(this);switch(e.bbox={x:t.x,y:t.y,width:t.width,height:t.height},a.parent().nodeLabelAlignment.eval(e)){case"left":e.xofs=-e.bbox.width/2;break;case"right":e.xofs=e.bbox.width/2}}).selectAll("tspan"),n.attr({"text-anchor":function(e){switch(a.parent().nodeLabelAlignment.eval(e.node)){case"left":return"start";case"center":return"middle";case"right":return"end"}return null},x:function(e){return e.node.xofs},dy:function(e){return e.yofs}}),n.exit().remove(),t.attr("fill",a.parent().nodeLabelFill.eval)},textbox:function(e){var t=ve(this.selectContent(e).node());return{x:t.x,y:t.y,width:t.width,height:t.height}},selectContent:function(e){return e.select("text.node-label")}};return a},de.with_icon_contents=function(n,r,o){var a={parent:he(null).react(function(e){n.parent(e)}),padding:function(e){var t=Ee(a.parent(),e);return{x:3*t.x,y:3*t.y}},update:function(e){var t=e.selectAll("g.with-icon").data(function(e){return[e]});t.enter().append("g").attr("class","with-icon").append("image").attr({class:"icon",width:r+"px",height:o+"px"}),t.call(n.update),n.selectContent(t).attr("transform","translate("+r/2+")"),t.selectAll("image.icon").attr({href:a.parent().nodeIcon.eval,x:function(e){return-(r+n.textbox(ce.select(this.parentNode)).width)/2-Ee(a.parent(),e)},y:-o/2})},textbox:function(e){var t=n.textbox(e);return t.x+=r/2,t},selectContent:function(e){return e.select("g.with-icon")}};return a},de.diagram=function(t,e){var L=se.marginMixin({});L.__dcFlag__=se.utils.uniqueId(),L.margins({left:10,top:10,right:10,bottom:10});var a,T,D,f,g,n,r,o,i,h=null,M=null,p=null,O=null,j=null,C=ce.dispatch("preDraw","data","end","start","drawn","receivedLayout","transitionsStarted","zoomed"),I={},z={},R={},F={},u={},W=!1,c=200,l=function(e){var t=e&&e.getBoundingClientRect&&e.getBoundingClientRect().width;return t&&c<t?t:c},s=l,d=200,y=function(e){var t=e&&e.getBoundingClientRect&&e.getBoundingClientRect().height;return t&&d<t?t:d},v=y;function m(n){return function(e){L.layoutEngine()||L.layoutAlgorithm("cola",!0);var t=L.layoutEngine();if(t.getEngine&&(t=t.getEngine()),t[n]){if(console.warn("property is deprecated, call on layout engine instead: dc_graph.diagram.%c"+n,"font-weight: bold"),!arguments.length)return t[n]();t[n](e)}else if(console.warn("property is deprecated, and is not supported for Warning: dc_graph.diagram.<b>"+n+'</b> is deprecated, and it is not supported for the "'+t.layoutAlgorithm()+'" layout algorithm: ignored.'),!arguments.length)return null;return this}}function q(e){L.layoutEngine()||L.layoutAlgorithm("cola",!0),(e||L.layoutEngine()).init({width:L.width(),height:L.height()})}function B(e){return!!e.source&&!!e.target}L.height=function(e){return arguments.length?(v=ce.functor(e||y),i=void 0,L):(se.utils.isNumber(i)||(i=v(L.root().node())),i)},L.minHeight=function(e){return arguments.length?(d=e,L):d},L.width=function(e){return arguments.length?(s=ce.functor(e||l),o=void 0,L):(se.utils.isNumber(o)||(o=s(L.root().node())),o)},L.minWidth=function(e){return arguments.length?(c=e,L):c},L.root=he(null).react(function(e){e.empty()&&console.log("Warning: parent selector "+t+" doesn't seem to exist")}),L.mouseZoomable=he(!0),L.zoomExtent=he([.1,2]),L.modKeyZoom=L.altKeyZoom=he(!1),L.fitStrategy=he("default"),L.restrictPan=he(!1),L.autoZoom=he(null),L.zoomToFit=function(e){if(O&&j){var t=L.selectAllNodes();L.selectAllEdges();Q(t)}},L.zoomDuration=he(500),L.nodeDimension=he(),L.nodeGroup=he(),L.edgeDimension=he(),L.edgeGroup=he(),L.edgesInFront=he(!1),L.nodeKey=L.nodeKeyAccessor=he(function(e){return e.key}),L.edgeKey=L.edgeKeyAccessor=he(function(e){return e.key}),L.edgeSource=L.sourceAccessor=he(function(e){return e.value.sourcename}),L.edgeTarget=L.targetAccessor=he(function(e){return e.value.targetname}),L.portDimension=he(null),L.portGroup=he(null),L.portNodeKey=he(null),L.portEdgeKey=he(null),L.portName=he(null),L.portStyleName=he(null),L.portElastic=he(!0),L.portStyle=pe(),L.portBounds=he(null),L.edgeSourcePortName=he(null),L.edgeTargetPortName=he(null),L.nodeRadius=L.nodeRadiusAccessor=he(25),L.nodeStrokeWidth=L.nodeStrokeWidthAccessor=he(1),L.nodeStroke=L.nodeStrokeAccessor=he("black"),L.nodeStrokeDashArray=he(null),L.nodeFillScale=he(null),L.nodeFill=L.nodeFillAccessor=he("white"),L.nodeOpacity=he(1),L.nodePadding=he(6),L.nodeLabelPadding=he(0),L.nodeLineHeight=he(1),L.nodeLabel=L.nodeLabelAccessor=he(function(e){return e.value.label||e.value.name}),L.nodeLabelAlignment=he("center"),L.nodeLabelFill=L.nodeLabelFillAccessor=he(null),L.nodeFitLabel=L.nodeFitLabelAccessor=he(!0),L.nodeShape=he(we),L.shape=pe(),L.shape("nothing",de.no_shape()),L.shape("ellipse",de.ellipse_shape()),L.shape("polygon",de.polygon_shape()),L.shape("rounded-rect",de.rounded_rectangle_shape()),L.nodeContent=he("text"),L.content=pe(),L.content("text",de.text_contents()),L.nodeIcon=he(null),L.nodeTitle=L.nodeTitleAccessor=he(function(e){return L.nodeKey()(e)}),L.nodeOrdering=he(null),L.nodeFixed=L.nodeFixedAccessor=he(null),L.edgeStroke=L.edgeStrokeAccessor=he("black"),L.edgeStrokeWidth=L.edgeStrokeWidthAccessor=he(1),L.edgeStrokeDashArray=he(null),L.edgeOpacity=L.edgeOpacityAccessor=he(1),L.edgeLabel=L.edgeLabelAccessor=he(function(e){return L.edgeKey()(e)}),L.edgeArrowhead=L.edgeArrowheadAccessor=he("vee"),L.edgeArrowtail=L.edgeArrowtailAccessor=he(null),L.edgeArrowSize=he(1),L.edgeIsLayout=L.edgeIsLayoutAccessor=he(function(e){return!e.value.notLayout}),L.edgeIsShown=he(!0),L.lengthStrategy=m("lengthStrategy"),L.edgeLength=L.edgeDistanceAccessor=he(function(e){return e.value.distance}),L.flowLayout=m("flowLayout"),L.rankdir=m("rankdir"),L.baseLength=m("baseLength"),L.transitionDuration=he(500),L.stageTransitions=he("none"),L.deleteDelay=he(0),L.groupConnected=m("groupConnected"),L.timeLimit=he(0),L.constrain=he(function(e,t){return[]}),L.parallelEdgeOffset=he(10),L.edgeOrdering=he(null),L.cascade=me(L),L.initLayoutOnRedraw=he(!1),L.layoutUnchanged=he(!1),L.relayout=function(){return T=D=null,this},L.initialLayout=ye("initialLayout is deprecated - use layout algorithms instead",null),L.initialOnly=ye("initialOnly is deprecated - see the initialLayout deprecation notice in the documentation",!1),L.induceNodes=he(!1),L.showLayoutSteps=he(!1),L.legend=he(null).react(function(e){e.parent(L)}),L.mode=L.child=pe(),L.layoutAlgorithm=function(e,t){if(!arguments.length)return L.layoutEngine()?L.layoutEngine().layoutAlgorithm():"cola";var n;switch(t||console.warn("dc.graph.diagram.layoutAlgorithm is depecrated - pass the layout engine object to dc_graph.diagram.layoutEngine instead"),e){case"cola":n=de.cola_layout();break;case"dagre":n=de.dagre_layout()}return n=de.webworker_layout(n),L.layoutEngine(n),this},L.layoutEngine=he(null).react(function(e){e&&e.parent&&e.parent(L),p&&(Object.keys(z).forEach(function(e){z[e].cola.points=null}),q(e))}),L.enforceEdgeDirection=he(null),L.tickSize=m("tickSize"),L.uniqueId=function(){return L.anchorName().replace(/[ .#=\[\]"]/g,"-")},L.edgeId=function(e){return"edge-"+L.edgeKey.eval(e).replace(/[^\w-_]/g,"-")},L.arrowId=function(e,t){return"arrow-"+t+"-"+L.uniqueId()+"-"+L.edgeId(e)},L.textpathId=function(e){return"textpath-"+L.uniqueId()+"-"+L.edgeId(e)},L.getNode=function(e){return I[e]?I[e].orig:null},L.getWholeNode=function(e){return I[e]?I[e]:null},L.getEdge=function(e){return z[e]?z[e].orig:null},L.getWholeEdge=function(e){return z[e]?z[e]:null},L.getPort=function(e,t,n){return R[Le(e,t,n)]},L.nodePorts=function(){return a},L.handleDisconnected=m("handleDisconnected"),L.forEachChild=function(e,n,r,o){n.enum().forEach(function(t){o(n(t),e.filter(function(e){return r(e)===t}))})},L.forEachShape=function(e,t){L.forEachChild(e,L.shape,function(e){return e.dcg_shape.shape},t)},L.forEachContent=function(e,t){L.forEachChild(e,L.content,L.nodeContent.eval,t)},L.renderNode=L._enterNode=function(e){return L.nodeTitle()&&e.append("title"),e.each(ke(L)),L.forEachShape(e,function(e,t){t.call(e.create)}),L},L.redrawNode=L._updateNode=function(e){var r,t,n,o=e.filter((r=L,function(e){var t=r.nodeShape.eval(e)||we,n=e.dcg_shape.abstract;return t.shape!==n.shape||"polygon"===t.shape&&(t.shape.sides!==n.sides||t.shape.skew!==n.skew||t.shape.distortion!==n.distortion||t.shape.rotation!==n.rotation)}));return o.selectAll(".node-shape").remove(),o.each(ke(L)),L.forEachShape(o,function(e,t){t.call(e.create)}),e.select("title").text(L.nodeTitle.eval),L.forEachContent(e,function(e,t){t.call(e.update),L.forEachShape(e.selectContent(t),function(e,t){var s,d;t.call((s=e,d=L,function(e){e.each(function(e){var t=null;if((!s.useTextSize||s.useTextSize(e.dcg_shape))&&d.nodeFitLabel.eval(e)){var n;t={x:(t=ve(this)).x,y:t.y,width:t.width,height:t.height};var r=d.nodeContent.eval(e);if(r&&d.content(r).padding)n=d.content(r).padding(e);else{var o=Ee(d,e);n={x:2*o.x,y:2*o.y}}t.width+=n.x,t.height+=n.y,e.bbox=t}var a,i=0;s.useRadius&&!s.useRadius(e.dcg_shape)||(i=d.nodeRadius.eval(e)),a=t&&t.width&&t.height||s.useTextSize&&!s.useTextSize(e.dcg_shape)?s.calc_radii(e,i,t):{rx:i,ry:i},e.dcg_rx=a.rx,e.dcg_ry=a.ry;var u=2*a.rx,c=2*a.ry;if(u<c&&(u=c),!s.usePaddingAndStroke||s.usePaddingAndStroke(e.dcg_shape)){var l=d.nodePadding.eval(e)+d.nodeStrokeWidth.eval(e);u+=l,c+=l}e.cola.width=u,e.cola.height=c})}))})}),L.forEachShape(e,function(e,t){t.call(e.update)}),e.select(".node-shape").attr({stroke:L.nodeStroke.eval,"stroke-width":L.nodeStrokeWidth.eval,"stroke-dasharray":L.nodeStrokeDashArray.eval,fill:(t=L.nodeFillScale()||ge,n=L.nodeFill.eval,function(){return t(n.apply(null,arguments))})}),L},L.stagedDuration=function(){return"none"!==L.stageTransitions()?L.transitionDuration()/2:L.transitionDuration()},L.stagedDelay=function(e){return"none"===L.stageTransitions()||"modins"===L.stageTransitions()==!e?0:L.transitionDuration()/2},L.selectAllNodes=function(e){return e=e||".node",O.selectAll(e).filter(function(e){return!e.deleted})},L.selectAllEdges=function(e){return e=e||".edge",j.selectAll(e).filter(function(e){return!e.deleted})},L.selectAllDefs=function(e){return M.selectAll(e).filter(function(e){return!e.deleted})};var G,H=!(L.isRunning=function(){return W});function x(e,t){var n,r,o=t.target.cola.y-t.source.cola.y,a=t.target.cola.x-t.source.cola.x;return t.source!==e&&(o=-o,a=-a),t.parallel&&1<t.parallel.edges.length&&t.source.index>t.target.index&&(o=-o,a=-a),n=[a,o],r=Math.hypot(n[0],n[1]),[n[0]/r,n[1]/r]}function Y(e,t){for(var n in a={},t.forEach(function(e){var t=L.nodeKey.eval(e.node);(a[t]=a[t]||[]).push(e)}),a){var r=e[n];a[n].forEach(function(e){if(L.portElastic.eval(e)&&e.edges.length){var t=e.edges.map(x.bind(null,r));e.vec=[ce.sum(t,function(e){return e[0]})/t.length,ce.sum(t,function(e){return e[1]})/t.length]}else e.vec=e.vec||void 0;e.pos=null})}}function X(e,t,n){for(var r in a){var o=e[r];a[r].forEach(function(e){e.pos||Te(L,o,e)})}t.forEach(function(e){var t=L.edgeSourcePortName.eval(e);e.sourcePort.pos=t?n[Le(L.nodeKey.eval(e.source),null,t)].pos:n[Le(null,L.edgeKey.eval(e),"source")].pos,t=L.edgeTargetPortName.eval(e),e.targetPort.pos=t?n[Le(L.nodeKey.eval(e.target),null,t)].pos:n[Le(null,L.edgeKey.eval(e),"target")].pos,console.assert(e.sourcePort.pos&&e.targetPort.pos)})}function Z(e,t){t.attr("stroke",L.edgeStroke.eval).attr("stroke-width",L.edgeStrokeWidth.eval).attr("stroke-dasharray",L.edgeStrokeDashArray.eval).attr("marker-end",function(e){var t=ne(e,"head",L.edgeArrowhead.eval(e));return t?"url(#"+t+")":null}).attr("marker-start",function(e){var t=L.edgeArrowtail.eval(e),n=ne(e,"tail",t);return t?"url(#"+n+")":null}).each(function(e){ce.selectAll("#"+L.arrowId(e,"head")+",#"+L.arrowId(e,"tail")).attr("fill",L.edgeStroke.eval(e))}),L._updateNode(e),te(e)}function U(e){C.end(e),W=!1,H&&(H=!1,window.setTimeout(function(){L.isRunning()||L.redraw()},0))}function _(e,t){var n=e[0],r=e[e.length-1],o=Pe(e,"tail"===t?.25:.75);return("head"===t?Math.atan2(r.y-o.y,r.x-o.x):Math.atan2(n.y-o.y,n.x-o.x))+"rad"}function b(e,t,n){var r=e.points,o=r[0],a=r[r.length-1];switch(L.enforceEdgeDirection()){case"LR":if(t.x>=n.x){var i=o.x-a.x;return{points:[o,{x:o.x+i,y:o.y-i/2},{x:a.x-i,y:a.y-i/2},a],bezDegree:3,sourcePort:e.sourcePort,targetPort:e.targetPort}}break;case"TB":if(t.y>=n.y){var u=o.y-a.y;return{points:[o,{x:o.x+u/2,y:o.y+u},{x:a.x+u/2,y:a.y-u},a],bezDegree:3,sourcePort:e.sourcePort,targetPort:e.targetPort}}}return e}function w(e,t,n,r,o,a){var i,u=e.parallel,c=e.source,l=e.target;1<u.edges.length&&e.source.index>e.target.index&&(i=l,l=c,c=i,i=o,o=n,n=i,i=a,a=r,r=i);for(var s=c.dcg_ry+L.nodeStrokeWidth.eval(c)/2,d=l.dcg_ry+L.nodeStrokeWidth.eval(l)/2,f=0;f<u.edges.length;++f){var g=!!(f%2)==n<o?-1:1,h=0<Math.floor((f+1)/2)?u.edges[2<f?f-2:0].pos[t].path:null,p=Ke(L,e,n,r,o,a,h,g,L.parallelEdgeOffset(),s,d);1<u.edges.length&&u.rev[f]&&p.points.reverse(),L.enforceEdgeDirection()&&(p=b(p,c.cola,l.cola)),u.edges[f].pos[t]={path:p,orienthead:_(p.points,"head"),orienttail:_(p.points,"tail")}}}function k(n){return function(e){var t=e.pos[n].path;return _e(t.points,t.bezDegree)}}function E(n){return function(e){var t=e.pos[n].path;return _e(t.points[t.points.length-1].x<t.points[0].x?t.points.slice(0).reverse():t.points,t.bezDegree)}}function $(e){return{left:e.cola.x-e.dcg_rx,top:e.cola.y-e.dcg_ry,right:e.cola.x+e.dcg_rx,bottom:e.cola.y+e.dcg_ry}}function J(e,t){return{left:Math.min(e.left,t.left),top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom)}}function K(e){return{left:e.x,top:e.y,right:e.x,bottom:e.y}}function V(e){return e.pos.new.path.points.map(K).reduce(J)}function Q(e){if(L.fitStrategy()){if(!G)return;var t=G.right-G.left,n=G.bottom-G.top,r=L.width()-L.margins().left-L.margins().right,o=L.height()-L.margins().top-L.margins().bottom;L.DEBUG_BOUNDS&&(s=G,(d=p.selectAll("rect.bounds").data([0])).enter().insert("rect",":first-child").attr({class:"bounds",fill:"rgba(128,255,128,0.1)",stroke:"#000"}),d.attr({x:s.left,y:s.top,width:s.right-s.left,height:s.bottom-s.top}));var a=L.fitStrategy(),i=[0,0],u=1;if(0<=["default","vertical","horizontal"].indexOf(a))u=("default"===a?!(n/t<o/r):"vertical"===a)?o/n:r/t,u=Math.max(L.zoomExtent()[0],Math.min(L.zoomExtent()[1],u)),i=[L.margins().left-G.left*u+(r-t*u)/2,L.margins().top-G.top*u+(o-n*u)/2];else if("string"==typeof a&&a.match(/^align_/)){var c=a.split("_")[1].toLowerCase().split("");if(2<c.length)throw new Error("align_ expecting 0-2 sides, not "+c.length);var l=S();i=f.translate(),u=f.scale(),c.forEach(function(e){switch(e){case"l":i[0]=A(i,l.left);break;case"t":i[1]=P(i,l.top);break;case"r":i[0]=N(i,l.right);break;case"b":i[1]=re(i,l.bottom);break;default:throw new Error("align_ expecting l t r or b, not '"+e+"'")}})}else{if("zoom"!==a)throw new Error("unknown fitStrategy type "+typeof a);i=oe(f.translate())}g=e,f.translate(i).scale(u).event(h),g=!1}var s,d}function ee(e,t,n,r,o,a,i,u,c,l,s){console.assert(n.data().every(B));var d={};t.each(function(e){d[L.nodeKey.eval(e)]=!0}).attr("transform",function(e){return"translate("+e.cola.x+","+e.cola.y+")"});var f=e.transition().duration(L.stagedDuration()).delay(function(e){return L.stagedDelay(d[L.nodeKey.eval(e)])}).attr("opacity",L.nodeOpacity.eval);s&&f.attr("transform",function(e){return"translate("+e.cola.x+","+e.cola.y+")"}).each("end.record",function(e){e.prevX=e.cola.x,e.prevY=e.cola.y}),n.each(function(e){e.pos.new=null}),n.each(function(e){e.cola.points?e.pos.new={path:{points:e.cola.points,bezDegree:3},orienthead:_(e.cola.points,"head"),orienttail:_(e.cola.points,"tail")}:(e.pos.old||w(e,"old",e.source.prevX||e.source.cola.x,e.source.prevY||e.source.cola.y,e.target.prevX||e.target.cola.x,e.target.prevY||e.target.cola.y),e.pos.new||w(e,"new",e.source.cola.x,e.source.cola.y,e.target.cola.x,e.target.cola.y)),e.pos.old?e.pos.old.path.bezDegree===e.pos.new.path.bezDegree&&e.pos.old.path.points.length===e.pos.new.path.points.length||(console.log("old",e.pos.old.path.points.length,"new",e.pos.new.path.points.length),Se(e.pos.old.path)?(e.pos.new.path.points=Ae(e.pos.new.path),e.pos.old.path.points=Ne(Ae(e.pos.old.path),(e.pos.new.path.points.length-1)/3),e.pos.old.path.bezDegree=e.pos.new.bezDegree=3):Se(e.pos.new.path)?(e.pos.old.path.points=Ae(e.pos.old.path),e.pos.new.path.points=Ne(Ae(e.pos.new.path),(e.pos.old.path.points.length-1)/3),e.pos.old.path.bezDegree=e.pos.new.bezDegree=3):console.warn("don't know how to interpolate two multi-segments")):e.pos.old=e.pos.new});var g={};r.each(function(e){g[L.edgeKey.eval(e)]=!0}).each(function(e){var t="modins"===L.stageTransitions()?"new":"old";L.edgeArrowhead.eval(e)&&ce.select("#"+L.arrowId(e,"head")).attr("orient",function(){return e.pos[t].orienthead}),L.edgeArrowtail.eval(e)&&ce.select("#"+L.arrowId(e,"tail")).attr("orient",function(){return e.pos[t].orienttail})}).attr("d",k("modins"===L.stageTransitions()?"new":"old"));var h=n.each(function(e){L.edgeArrowhead.eval(e)&&ce.select("#"+L.arrowId(e,"head")).transition().duration(L.stagedDuration()).delay(L.stagedDelay(!1)).attr("orient",function(){return e.pos.new.orienthead}),L.edgeArrowtail.eval(e)&&ce.select("#"+L.arrowId(e,"tail")).transition().duration(L.stagedDuration()).delay(L.stagedDelay(!1)).attr("orient",function(){return e.pos.new.orienttail})}).transition().duration(L.stagedDuration()).delay(function(e){return L.stagedDelay(g[L.edgeKey.eval(e)])}).attr("opacity",L.edgeOpacity.eval);s&&h.attr("d",function(e){return k("insmod"===L.stageTransitions()&&g[L.edgeKey.eval(e)]?"old":"new")(e)}),i.selectAll("textPath").text(function(e){return L.edgeLabel.eval(e)}),l.attr("d",E("modins"===L.stageTransitions()?"new":"old"));var p=c.transition().duration(L.stagedDuration()).delay(function(e){return L.stagedDelay(g[L.edgeKey.eval(e)])}).attr("opacity",L.edgeOpacity.eval);s&&p.attr("d",function(e){return E("insmod"===L.stageTransitions()&&g[L.edgeKey.eval(e)]?"old":"new")(e)}),"insmod"===L.stageTransitions()&&s&&(50<=L.stagedDuration()?(h=h.transition().duration(L.stagedDuration()).attr("d",k("new")),p=p.transition().duration(L.stagedDuration()).attr("d",E("new"))):(h.attr("d",k("new")),p.attr("d",k("new")))),L.showLayoutSteps()||function(e,t){e.every(function(e){return 0===e.size()})&&t();var n=0;e.forEach(function(e){e.each(function(){++n}).each("end.all",function(){--n||t()})})}([f,h,p],function(){U(!0)}),s&&o.attr("d",k("new")),n.each(function(e){e.pos.old=e.pos.new})}function te(o){a&&L.portStyle.enum().forEach(function(t){var e={};for(var n in a)e[n]=a[n].filter(function(e){return L.portStyleName.eval(e)===t});var r=L.selectNodePortsOfStyle(o,t);L.portStyle(t).drawPorts(r,e,o)})}function ne(e,t,n){var r=L.arrowId(e,t),o=L.addOrRemoveDef(r,!!n,"svg:marker");return n&&o.attr("viewBox","0 -5 10 10").attr("refX",u[n].refX).attr("refY",u[n].refY).attr("markerUnits","userSpaceOnUse").attr("markerWidth",u[n].width*L.edgeArrowSize.eval(e)).attr("markerHeight",u[n].height*L.edgeArrowSize.eval(e)).attr("stroke",L.edgeStroke.eval(e)).attr("fill",L.edgeStroke.eval(e)).call(u[n].drawFunction),n?r:null}function S(){var e=G||{left:0,top:0,right:0,bottom:0},t=f?f.scale():1;return{left:e.left-L.margins().left/t,top:e.top-L.margins().top/t,right:e.right+L.margins().right/t,bottom:e.bottom+L.margins().bottom/t}}function A(e,t){return e[0]-L.x()(t)+L.x().range()[0]}function P(e,t){return e[1]-L.y()(t)+L.y().range()[0]}function N(e,t){return e[0]-L.x()(t)+L.x().range()[1]}function re(e,t){return e[1]-L.y()(t)+L.y().range()[1]}function oe(e){var t,n=L.x().domain(),r=L.y().domain(),o=S(),a=o.left<n[0],i=o.right<n[1],u=o.right-o.left<n[1]-n[0];switch(a&&i?t=u?"left":"right":a||i||(t=u?"right":"left"),t){case"left":e[0]=A(e,o.left);break;case"right":e[0]=N(e,o.right);break;default:0}switch(a=o.top<r[0],i=o.bottom<r[1],u=o.bottom-o.top<r[1]-r[0],a&&i?t=u?"top":"bottom":a||i||(t=u?"bottom":"top"),t){case"top":e[1]=P(e,o.top);break;case"bottom":e[1]=re(e,o.bottom);break;default:0}return e}function ae(){var e,t=ce.event.scale;L.restrictPan()?f.translate(e=oe(ce.event.translate)):e=ce.event.translate,function(e,t,n){e,t;var r=p;n&&(r=p.transition().duration(L.zoomDuration())),r.attr("transform","translate("+e+") scale("+t+")")}(e,t,g),C.zoomed(e,t)}function ie(){h.call(f),h.on("dblclick.zoom",null)}function ue(){h.on(".zoom",null)}return L.redraw=function(){return W?(H=!0,this):L.startLayout()},L.startLayout=function(){var e=L.nodeGroup().all(),t=L.edgeGroup().all(),n=L.portGroup()?L.portGroup().all():[];if(W)throw new Error("dc_graph.diagram.redraw already running!");W=!0,L.resizeSvg(),L.initLayoutOnRedraw()&&q(),L.layoutEngine().stop(),C.preDraw(),L.nodeOrdering()&&(e=le.quicksort.by(L.nodeOrdering())(e.slice(0),0,e.length)),L.edgeOrdering()&&(t=le.quicksort.by(L.edgeOrdering())(t.slice(0),0,t.length));var i=be(I,e,null,function(e){return L.nodeKey()(e)},function(e,t){e.orig=t,e.cola=e.cola||{},e.cola.dcg_nodeKey=L.nodeKey.eval(e),L.layoutEngine().populateLayoutNode(e.cola,e)}),u=be(z,t,null,function(e){return L.edgeKey()(e)},function(e,t){e.orig=t,e.cola=e.cola||{},e.cola.dcg_edgeKey=L.edgeKey.eval(e),e.cola.dcg_edgeSource=L.edgeSource.eval(e),e.cola.dcg_edgeTarget=L.edgeTarget.eval(e),e.source=I[e.cola.dcg_edgeSource],e.target=I[e.cola.dcg_edgeTarget],e.cola.dcg_edgeLength=L.edgeLength.eval(e),e.sourcePort=e.sourcePort||{},e.targetPort=e.targetPort||{},L.layoutEngine().populateLayoutEdge(e.cola,e)}),r=(u=(u=(u=u.filter(B)).filter(function(e){return e.source!==e.target})).filter(L.edgeIsShown.eval)).map(function(e){return L.edgeSourcePortName.eval(e)?Le(L.edgeSource.eval(e),null,L.edgeSourcePortName.eval(e)):Le(null,L.edgeKey.eval(e),"source")});r=r.concat(u.map(function(e){return L.edgeTargetPortName.eval(e)?Le(L.edgeTarget.eval(e),null,L.edgeTargetPortName.eval(e)):Le(null,L.edgeKey.eval(e),"target")})),n=n.filter(function(e){return L.portNodeKey()&&L.portNodeKey()(e)||L.portEdgeKey()&&L.portEdgeKey()(e)});var c=be(R,n,r,function(e){return Le(L.portNodeKey()&&L.portNodeKey()(e),L.portEdgeKey()&&L.portEdgeKey()(e),L.portName()(e))},function(e,t){e.orig=t,e.named&&(e.edges=[])},function(e,t){console.assert(e,"should have screened out invalid ports");var n,r=(n=e.split("/"),console.assert(3===n.length),"node"===(n=n.map(function(e){return e.replace(/%2F/g,"/")}))[0]?{nodeKey:n[1],name:n[2]}:{edgeKey:n[1],name:n[2]});if(r.nodeKey)t.node=I[r.nodeKey],t.named=!0;else{var o=z[r.edgeKey];t.node=o[r.name],t.edges=[o],t.named=!1}t.name=r.name});if(c=c.filter(function(e){return e.node}),u.forEach(function(e){var t=L.edgeSourcePortName.eval(e);t&&R[Le(L.nodeKey.eval(e.source),null,t)].edges.push(e),(t=L.edgeTargetPortName.eval(e))&&R[Le(L.nodeKey.eval(e.target),null,t)].edges.push(e)}),L.induceNodes()){var o={};for(var a in u.forEach(function(e){o[e.cola.dcg_edgeSource]=!0,o[e.cola.dcg_edgeTarget]=!0}),i=i.filter(function(e){return o[e.cola.dcg_nodeKey]}),I)o[a]||delete I[a]}if(i.forEach(function(e,t){e.index=t}),C.data(L,I,i,z,u,R,c),F={nnodes:i.length,nedges:u.length},i.forEach(function(e){L.nodeFixed()&&(e.cola.dcg_nodeFixed=L.nodeFixed.eval(e))}),L.parallelEdgeOffset()){for(var l=new Array(i.length),s=0;s<i.length;++s)l[s]=new Array(s);u.forEach(function(e){var t,n,r,o;e.pos=e.pos||{},e.source.index<e.target.index?(t=e.source.index,n=e.target.index,r="edgeSourcePortName",o="edgeTargetPortName"):(n=e.source.index,t=e.target.index,o="edgeSourcePortName",r="edgeTargetPortName");var a=L[r].eval(e)||"no port",i=L[o].eval(e)||"no port";l[n][t]=l[n][t]||{},l[n][t][i]=l[n][t][i]||{},e.parallel=l[n][t][i][a]=l[n][t][i][a]||{rev:[],edges:[]},e.parallel.edges.push(e),e.parallel.rev.push(t!==e.source.index)})}var d=j.selectAll(".edge").data(u,L.edgeKey.eval),f=d.enter().append("svg:path").attr({class:"edge",id:L.edgeId,opacity:0});d.exit().each(function(e){e.deleted=!0}).transition().duration(L.stagedDuration()).delay(L.deleteDelay()).attr("opacity",0).each(function(e){ne(e,"head",null),ne(e,"head",null)}).remove();var g=j.selectAll(".edge-hover").data(u,L.edgeKey.eval),h=g.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("fill","none").attr("stroke","green").attr("stroke-width",10).on("mouseover",function(e){ce.select("#"+L.edgeId(e)+"-label").attr("visibility","visible")}).on("mouseout",function(e){ce.select("#"+L.edgeId(e)+"-label").attr("visibility","hidden")});g.exit().remove();var p=j.selectAll(".edge-label").data(u,L.edgeKey.eval),y=p.enter().append("text").attr("id",function(e){return L.edgeId(e)+"-label"}).attr("visibility","hidden").attr({class:"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(e){var t=L.textpathId(e);return window.location.href.split("#")[0]+"#"+t}),v=M.selectAll("path.edge-label-path").data(u,L.textpathId),m=v.enter().append("svg:path").attr({class:"edge-label-path",id:L.textpathId});p.exit().transition().duration(L.stagedDuration()).delay(L.deleteDelay()).attr("opacity",0).remove();var x=O.selectAll(".node").data(i,L.nodeKey.eval),_=x.enter().append("g").attr("class","node").attr("opacity","0");L._enterNode(_),x.exit().each(function(e){e.deleted=!0}).transition().duration(L.stagedDuration()).delay(L.deleteDelay()).attr("opacity",0).remove(),C.drawn(x,d,g),Z(x,d),L.initialLayout()&&L.initialLayout()(L,i,u);var b=!1;if(!L.layoutUnchanged()){var w=JSON.stringify(i.map(function(e){return{orig:fe(e),cola:{dcg_nodeFixed:e.cola.dcg_nodeFixed}}})),k=JSON.stringify(u.map(function(e){return{orig:fe(e),cola:e.cola}}));w===T&&k===D&&(b=!0),T=w,D=k}var E=L.constrain()(L,i,u);E.forEach(function(e){if(e.type)switch(e.type){case"alignment":e.offsets.forEach(function(e){e.node=I[e.node].index});break;case"circle":e.nodes.forEach(function(e){e.node=I[e.node].index})}else e.axis&&(e.left=I[e.left].index,e.right=I[e.right].index)});var K=u.filter(L.edgeIsLayout.eval),S=(u.filter(function(e){return!L.edgeIsLayout.eval(e)}),E.filter(function(e){return"circle"===e.type}));E=E.filter(function(e){return"circle"!==e.type}),S.forEach(function(e){var t=(e.distance||4*L.baseLength())/(2*Math.sin(Math.PI/e.nodes.length)),n=e.nodes.map(function(e){return e.node}),r=de.wheel_edges(function(e){return L.nodeKey.eval(i[e])},n,t).map(function(e){var t={internal:e};return t.source=I[e.sourcename],t.target=I[e.targetname],t});K=K.concat(r)});var A=E.filter(function(e){return"ordering"===e.type});if(E=E.filter(function(e){return"ordering"!==e.type}),A.forEach(function(n){var r,e=n.nodes.map(function(e){return I[e]});n.ordering&&(e=le.quicksort.by(xe(n.ordering))(e,0,e.length));e.forEach(function(e,t){0===t?r=e:E.push({left:r.index,right:(r=e).index,axis:n.axis,gap:n.gap})})}),L.legend()&&L.legend().redraw(),b)return W=!1,C.end(!1),this;var P=Date.now();function N(e,t){e.forEach(function(e){var t=I[e.dcg_nodeKey];t?(t.cola.x=e.x,t.cola.y=e.y):console.warn('received node "'+e.dcg_nodeKey+'" that we did not send')}),t.forEach(function(e){var t=z[e.dcg_edgeKey];t?e.points&&(t.cola.points=e.points):console.warn('received edge "'+e.dcg_edgeKey+'" that we did not send')})}return L.layoutEngine().on("tick",function(e,t){var n=Date.now()-P;L.initialOnly()||N(e,t),L.showLayoutSteps()&&(Y(I,c),C.receivedLayout(L,I,i,z,u,R,c),X(I,u,R),ee(x,_,d,f,g,h,p,y,v,m,!0),te(x),C.transitionsStarted(x,d,g)),(H||L.timeLimit()&&n>L.timeLimit())&&(console.log("cancelled"),L.layoutEngine().stop())}).on("end",function(e,t){L.showLayoutSteps()?U(!0):(L.initialOnly()||N(e,t),Y(I,c),C.receivedLayout(L,I,i,z,u,R,c),X(I,u,R),ee(x,_,d,f,g,h,p,y,v,m,!0),te(x),C.transitionsStarted(x,d,g));var n,r,o,a=!0;switch(L.autoZoom()){case"always-skipanimonce":a=!1,L.autoZoom("always");case"always":n=!0;break;case"once-noanim":a=!1;case"once":n=!0,L.autoZoom(null);break;default:n=!1}r=x,o=d,(L.fitStrategy()||L.restrictPan())&&r.size()&&(G=r.data().map($).reduce(J),G=o.data().map(V).reduce(J,G)),n&&Q(a)}).on("start",function(){console.log("algo "+L.layoutEngine().layoutAlgorithm()+" started."),C.start()}),L.initialOnly()?L.layoutEngine().dispatch().end(i,u):(C.start(),L.layoutEngine().data({width:L.width(),height:L.height()},i.map(function(e){return e.cola}),K.map(function(e){return e.cola}),E),L.layoutEngine().start()),this},L.refresh=function(e,t,n,r,o){Z(e=e||L.selectAllNodes(),t=t||L.selectAllEdges()),n=n||L.selectAllEdges(".edge-hover"),r=r||L.selectAllEdges(".edge-label"),o=o||L.selectAllDefs("path.edge-label-path");var a=ce.select(null);return ee(e,a,t,a,n,a,r,a,o,a,!1),this},L.reposition=function(e,t){return e.attr("transform",function(e){return"translate("+e.cola.x+","+e.cola.y+")"}),t.each(function(e){e.pos.new=null,e.pos.old=null,w(e,"new",e.source.cola.x,e.source.cola.y,e.target.cola.x,e.target.cola.y),L.edgeArrowhead.eval(e)&&ce.select("#"+L.arrowId(e,"head")).attr("orient",function(){return e.pos.new.orienthead}),L.edgeArrowtail.eval(e)&&ce.select("#"+L.arrowId(e,"tail")).attr("orient",function(){return e.pos.new.orienttail})}).attr("d",k("new")),this},L.selectNodePortsOfStyle=function(e,t){return e.selectAll("g.port").filter(function(e){return L.portStyleName.eval(e)===t})},L.render=function(){L.initLayoutOnRedraw()||q(),L.resetSvg(),p=h.append("g").attr("class","draw");var e=["edge-layer","node-layer"];return L.edgesInFront()&&e.reverse(),p.selectAll("g").data(e).enter().append("g").attr("class",function(e){return e}),j=p.selectAll("g.edge-layer"),O=p.selectAll("g.node-layer"),L.legend()&&L.legend().render(),L.redraw()},L.on=function(e,t){return 1===arguments.length?C.on(e):(C.on(e,t),this)},L.getStats=function(){return F},L.select=function(e){return L.root().select(e)},L.selectAll=function(e){return L.root()?L.root().selectAll(e):null},L.x=he(null),L.y=he(null),L.svg=function(e){return arguments.length?(h=e,L):h},L.g=function(e){return arguments.length?(p=e,L):p},L.resetSvg=function(){return L.select("svg").remove(),function(){h=L.root().append("svg"),L.resizeSvg(),M=h.append("svg:defs"),L.x()||L.x(ce.scale.linear().domain([0,L.width()]).range([0,L.width()]));L.y()||L.y(ce.scale.linear().domain([0,L.height()]).range([0,L.height()]));if(f=ce.behavior.zoom().on("zoom",ae).x(L.x()).y(L.y()).scaleExtent(L.zoomExtent()),L.mouseZoomable()){var e,t,n=L.child("brush");if(e=L.modKeyZoom()){t=Array.isArray(e)?e.slice():"string"==typeof e?[e]:["Alt"];var r=!1,o=!1,a=!1;h.on("mousedown.modkey-zoom",function(){r=!0}).on("mouseup.modkey-zoom",function(){(r=!1)||o||!a||(a=!1,ue(),n&&n.activate())}),ce.select(document).on("keydown.modkey-zoom",function(){-1<t.indexOf(ce.event.key)&&(o=!0,r||(a=!0,ie(),n&&n.deactivate()))}).on("keyup.modkey-zoom",function(){-1<t.indexOf(ce.event.key)&&(o=!1,r||(a=!1,ue(),n&&n.activate()))})}else ie()}return h}()},L.redrawGroup=function(){se.redrawAll(r)},L.renderGroup=function(){se.renderAll(r)},L.defineArrow=function(e,t,n,r,o,a){return u[e]={name:e,width:t,height:n,refX:r,refY:o,drawFunction:a},L},L.addOrRemoveDef=function(e,t,n){var r=t?[0]:[],o=M.selectAll("#"+e).data(r),a=o.enter().append(n).attr("id",e);return o.exit().remove(),a},L.resizeSvg=function(e,t){return h&&h.attr("width",e||L.width()).attr("height",t||L.height()),L},L.invertCoord=function(e){return[L.x().invert(e[0]),L.y().invert(e[1])]},L.defineArrow("vee",12,12,10,0,function(e){e.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),L.defineArrow("crow",12,12,0,0,function(e){e.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),L.defineArrow("dot",7,7,0,0,function(e){e.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),L.anchor=function(e,t){if(!arguments.length)return n;if(!e)throw new se.errors.BadArgumentException("parent must be defined");return n=e.select&&e.classed?e.node():e,L.root(ce.select(n)),L.root().classed(de.constants.CHART_CLASS,!0),se.registerChart(L,t),r=t,L},L.chartID=function(){return L.__dcFlag__},L.anchorName=function(){var e=L.anchor();return e&&e.id?e.id:e&&e.replace?e.replace("#",""):"dc-graph"+L.chartID()},L.anchor(t,e)},de.spawn_engine=function(e,t,n){return t=t||{},de.engines.instantiate(e,t,n)||de.engines.instantiate(de._default_engine,t,n)},de._engines=[{name:"dagre",params:["rankdir"],instantiate:function(){return de.dagre_layout()}},{name:"d3force",instantiate:function(){return de.d3_force_layout()}},{name:"d3v4force",instantiate:function(){return de.d3v4_force_layout()}},{name:"tree",instantiate:function(){return de.tree_layout()}},{names:["circo","dot","neato","osage","twopi","fdp"],instantiate:function(e,t){return de.graphviz_layout(null,e,t.server)}},{name:"cola",params:["lengthStrategy"],instantiate:function(){return de.cola_layout()}}],de._default_engine="cola",de.engines={entry_pred:function(t){return function(e){return e.name===t||e.names&&e.names.includes(t)}},get:function(e){return de._engines.find(this.entry_pred(e))},instantiate:function(e,t,n){var r=this.get(e);if(!r)return null;var o=r.instantiate(e,t);return(r.params||[]).forEach(function(e){t[e]&&o[e](t[e])}),o.supportsWebworker&&o.supportsWebworker()&&n&&(o=de.webworker_layout(o)),o},available:function(){return de._engines.reduce(function(e,t){return e.concat(t.name?[t.name]:t.names)},[])},unregister:function(e){var t=de._engines.findIndex(this.entry_pred(e)),n=!1;if(t<0)return!1;var r=de._engines[t];if(r.name===e)n=!0;else{var o=r.names.indexOf(e);0<=o?r.names.splice(o,1):console.warn("search for engine failed",e),0===r.names.length&&(n=!0)}return n&&de._engines.splice(t,1),!0},register:function(e){var t=this;if(!e.instantiate)return console.error("engine definition needs instantiate: function(layout, args) { ... }"),this;if(e.name)this.unregister(e.name);else{if(!e.names)return console.error("engine definition needs name or names[]"),this;e.names.forEach(function(e){t.unregister(e)})}return de._engines.push(e),this}};var h={};function Le(e,t,n){return e||t?(e&&(e=e.replace(/\//g,"%2F")),t&&(t=t.replace(/\//g,"%2F")),(e?"node/"+e:"edge/"+t)+"/"+n):null}function Te(e,t,n){if(!n.vec)throw console.assert(!n.edges.length),new Error("port has not been placed, maybe install place_ports? "+n.name);n.pos=e.shape(t.dcg_shape.shape).intersect_vec(t,1e3*n.vec[0],1e3*n.vec[1])}function e(e){var t=function(){return{type:"alignment",axis:e}};return t.listname="offsets",t.wrap=function(e){return{node:e,offset:0}},t}function p(e,t,n){if(t)e(t,null);else{var r=Object.keys(n[0]),o=r[0],a=r[1],i=ce.set(n.map(function(e){return e[o]}));n.forEach(function(e){i.add(e[a])}),e(null,{nodes:i=i.values().map(function(e){return{name:e}}),links:n.map(function(e,t){return{key:t,sourcename:e[o],targetname:e[a]}})})}}function E(e){return(e.nodes||e.vertices)&&(e.edges||e.links)}de.webworker_layout=function(o){var n=ce.dispatch("init","start","tick","end"),a=function(e){if(!h[e]){var n=h[e]={worker:new Worker(u()+"dc.graph."+e+".worker.js"),layouts:{}};n.worker.onmessage=function(e){var t=e.data.layoutId;if(!n.layouts[t])throw new Error('layoutId "'+t+'" unknown!');n.layouts[t].dispatch()[e.data.response].apply(null,e.data.args)}}return h[e]}(o.layoutAlgorithm()),e={};(a.layouts[o.layoutId()]=e).parent=function(e){o.parent&&o.parent(e)},e.init=function(e){return e=o.optionNames().reduce(function(e,t){return e[t]=o[t](),e},e),a.worker.postMessage({command:"init",args:{layoutId:o.layoutId(),options:e}}),this},e.data=function(e,t,n,r){a.worker.postMessage({command:"data",args:{layoutId:o.layoutId(),graph:e,nodes:t,edges:n,constraints:r}})},e.start=function(){a.worker.postMessage({command:"start",args:{layoutId:o.layoutId()}})},e.stop=function(){return a.worker.postMessage({command:"stop",args:{layoutId:o.layoutId()}}),this},e.getEngine=function(){return o};return["layoutAlgorithm","needsStage","populateLayoutNode","populateLayoutEdge","rankdir","ranksep"].concat(o.optionNames()).forEach(function(t){e[t]=function(){var e=o[t].apply(o,arguments);return arguments.length?this:e}}),e.on=function(e,t){return 1===arguments.length?n.on(e):(n.on(e,t),this)},e.dispatch=function(){return n},e},de.graphviz_attrs=function(){return{rankdir:he("TB"),nodesep:he(40),ranksep:he(40)}},de.cola_layout=function(e){var t,n=e||w(),u=null,c=ce.dispatch("tick","start","end"),l={},s={};var r=de.graphviz_attrs(),o=Object.keys(r);r.rankdir(null);var d=Object.assign(r,{layoutAlgorithm:function(){return"cola"},layoutId:function(){return n},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},parent:he(null),on:function(e,t){return 1===arguments.length?c.on(e):(c.on(e,t),this)},init:function(t){return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),function(t){switch((u=cola.d3adaptor().avoidOverlaps(!0).size([t.width,t.height]).handleDisconnected(t.handleDisconnected)).tickSize&&u.tickSize(t.tickSize),t.lengthStrategy){case"symmetric":u.symmetricDiffLinkLengths(t.baseLength);break;case"jaccard":u.jaccardLinkLengths(t.baseLength);break;case"individual":u.linkDistance(function(e){return e.dcg_edgeLength||t.baseLength})}t.flowLayout&&u.flowLayout(t.flowLayout.axis,t.flowLayout.minSeparation)}(t),this},data:function(e,t,n,r){!function(e,t,n){var r=be(l,e,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height,e.fixed=!!t.dcg_nodeFixed,e.fixed&&"object"==typeof t.dcg_nodeFixed?(e.x=t.dcg_nodeFixed.x,e.y=t.dcg_nodeFixed.y):(void 0!==t.x&&(e.x=t.x),void 0!==t.y&&(e.y=t.y))}),o=be(s,t,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.source=l[t.dcg_edgeSource],e.target=l[t.dcg_edgeTarget],e.dcg_edgeLength=t.dcg_edgeLength});r.forEach(function(e,t){e.index=t});var a=null;function i(e){c[e](r,o.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}d.groupConnected()&&(a=cola.separateGraphs(r,o).map(function(e){return{leaves:e.array.map(function(e){return e.index})}})),u.on("tick",function(){i("tick")}).on("start",function(){c.start()}).on("end",function(){i("end")}),u.nodes(r).links(o).constraints(n).groups(a)}(t,n,r)},start:function(){u.start(d.unconstrainedIterations(),d.userConstraintIterations(),d.allConstraintsIterations(),d.gridSnapIterations())},stop:function(){u&&u.stop()},optionNames:function(){return["handleDisconnected","lengthStrategy","baseLength","flowLayout","tickSize","groupConnected"].concat(o)},populateLayoutNode:function(){},populateLayoutEdge:function(){},handleDisconnected:he(!0),lengthStrategy:he("symmetric"),baseLength:he(30),flowLayout:function(e){if(!arguments.length){if(t)return t;switch(d.rankdir()){case"LR":return{axis:"x",minSeparation:d.ranksep()+2*d.parent().nodeRadius()};case"TB":return{axis:"y",minSeparation:d.ranksep()+2*d.parent().nodeRadius()};default:return null}}return t=e,this},unconstrainedIterations:he(10),userConstraintIterations:he(20),allConstraintsIterations:he(20),gridSnapIterations:he(0),tickSize:he(1),groupConnected:he(!1)});return d},de.cola_layout.scripts=["d3.js","cola.js"],de.dagre_layout=function(e){var a,t=e||w(),i=null,u=ce.dispatch("tick","start","end"),c={},l={};var n=de.graphviz_attrs(),r=Object.keys(n);return Object.assign(n,{layoutAlgorithm:function(){return"dagre"},layoutId:function(){return t},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},on:function(e,t){return 1===arguments.length?u.on(e):(u.on(e,t),this)},init:function(t){var e;return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),e=t,(i=new dagre.graphlib.Graph({multigraph:!0})).setGraph({rankdir:e.rankdir,nodesep:e.nodesep,ranksep:e.ranksep}),i.setDefaultEdgeLabel(function(){return{}}),this},data:function(e,t,n){!function(e,t){var n=be(c,e,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height},function(e,t){i.setNode(e,t)},function(e){i.removeNode(e)}),r=be(l,t,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.dcg_edgeSource=t.dcg_edgeSource,e.dcg_edgeTarget=t.dcg_edgeTarget},function(e,t,n){i.setEdge(n.dcg_edgeSource,n.dcg_edgeTarget,t)},function(e,t){i.removeEdge(t.dcg_edgeSource,t.dcg_edgeTarget,t.dcg_edgeKey)});function o(e){u[e](n,r.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}(function(){o("tick")}),a=function(){o("end")}}(t,n)},start:function(){u.start(),dagre.layout(i),a()},stop:function(){},optionNames:function(){return r},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},de.dagre_layout.scripts=["d3.js","dagre.js"],de.tree_layout=function(e){var n,r,o,t=e||w(),a=ce.dispatch("tick","start","end");return{layoutAlgorithm:function(){return"tree"},layoutId:function(){return t},supportsWebworker:function(){return!1},on:function(e,t){return 1===arguments.length?a.on(e):(a.on(e,t),this)},init:function(t){return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),function(a){var i,u=ce.functor(a.nodeWidth);function f(e,t){return(u(e)+u(t))/2}n=de.depth_first_traversal({nodeid:function(e){return e.dcg_nodeKey},sourceid:function(e){return e.dcg_edgeSource},targetid:function(e){return e.dcg_edgeTarget},init:function(){i=a.offsetX},row:function(e){return e.dcg_rank},place:function(e,t,n){if(n.length){var r=n[n.length-1],o=(u(r)+u(e))/2;i=Math.max(i,r.left_x+o)}e.left_x=i,e.hit_ins=1,e.y=t*a.gapY+a.offsetY},sib:function(e,t,n){var r=f(t,n);e&&(r*=1.5),i+=r},pop:function(e){e.x=(e.left_x+i)/2},skip:function(e,t){e.x=(e.hit_ins*e.x+i)/++e.hit_ins,e.hit_ins===t&&delete e.hit_ins},finish:function(e){e.forEach(function(e){for(var t,n=e.sort(function(e,t){return e.x-t.x}),r=null,o=null,a=0;a<n.length-1;++a){var i=n[a],u=n[a+1];if(r){if(t+=f(i,u),a<n.length-2&&u.x<o+t)continue;var c,l;if(0<r&&--r,a<n.length-2){var s=u.x-(o+t);c=n[r].x+s/2,l=a+1}else c=Math.max(n[r].x,o-f(n[r],n[r+1])-(t-u.x+o)/2),l=n.length;for(var d=r+1;d<l;++d)c+=f(n[d-1],n[d]),n[d].x=c;r=o=t=null}else u.x-i.x<f(i,u)&&(r=a,o=i.x,t=f(i,u))}})}})}(t),this},data:function(e,t,n){r=t,o=n},start:function(){n(r,o),a.end(r,o)},stop:function(){},optionNames:function(){return["nodeWidth","offsetX","offsetY","rowFunction","gapY"]},populateLayoutNode:function(e,t){this.rowFunction()&&(e.dcg_rank=this.rowFunction.eval(t))},populateLayoutEdge:function(){},nodeWidth:he(function(e){return e.width}),offsetX:he(30),offsetY:he(30),rowFunction:he(null),gapY:he(100)}},de.tree_layout.scripts=[],de.graphviz_layout=function(e,o,t){var a,i,u,n=e||w(),c=ce.dispatch("tick","start","end");function l(e){return e.replace(/^%/,"&#37;")}function s(e){return e.replace(/^&#37;/,"%")}function d(e,t){return[e,'"'+t+'"'].join("=")}function f(e){return"["+e.join(", ")+"]"}function r(e,t){c.start();var r=t.bb.split(",").map(function(e){return+e}),n=(t.objects||[]).filter(function(e){return e.pos}).map(function(e){var t=e.pos.split(",");return{dcg_nodeKey:s(e.name),x:+t[0],y:r[3]-t[1]}});(u=(t.objects||[]).filter(function(e){return/^cluster/.test(e.name)})).forEach(function(e){e.bbflip=e.bb.split(",").map(function(e){return+e});var t=r[3]-e.bbflip[1];e.bbflip[1]=r[3]-e.bbflip[3],e.bbflip[3]=t});var o=(t.edges||[]).map(function(e){var t={dcg_edgeKey:s(e.id||"n"+e._gvid)};if(e._draw_){var n=e._draw_.find(function(e){return e.op&&e.points});t.points=n.points.map(function(e){return{x:e[0],y:r[3]-e[1]}})}return t});c.end(n,o)}var g=de.graphviz_attrs(),h=Object.keys(g);return Object.assign(g,{layoutAlgorithm:function(){return o},layoutId:function(){return n},supportsWebworker:function(){return!1},on:function(e,t){return 1===arguments.length?c.on(e):(c.on(e,t),this)},init:function(t){return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),this},data:function(e,t,n){!function(e,t){if(a)i=a;else{var n=[],r="neato"!==o;n.push((r?"digraph":"graph")+" g {"),n.push("graph "+f([d("nodesep",g.nodesep()/72),d("ranksep",g.ranksep()/72),d("rankdir",g.rankdir())])),(n=(n=n.concat(e.map(function(e){var t=[d("width",e.width/72),d("height",e.height/72),d("fixedsize","true")];return e.dcg_nodeFixed&&t.push(d("pos",[e.dcg_nodeFixed.x,1e3-e.dcg_nodeFixed.y].join(","))),'  "'+l(e.dcg_nodeKey)+'" '+f(t)}))).concat(t.map(function(e){return'  "'+l(e.dcg_edgeSource)+(r?'" -> "':'" -- "')+l(e.dcg_edgeTarget)+'" '+f([d("id",l(e.dcg_edgeKey)),d("arrowhead","none"),d("arrowtail","none")])}))).push("}"),n.push(""),i=n.join("\n")}}(t,n)},dotInput:function(e){return a=e,this},clusters:function(){return u},start:function(){!function(){if(t)ce.json(t).header("Content-type","application/x-www-form-urlencoded").post("layouttool="+o+"&"+encodeURIComponent(i),r);else{var e=Viz(i,{format:"json",engine:o});r(0,e=JSON.parse(e))}}()},stop:function(){},optionNames:function(){return h},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},de.d3_force_layout=function(e){var t=e||w(),u=null,n=ce.dispatch("tick","start","end"),v={},c={},l=[],s=[],m=null,r=null;function o(e){n[e](l,s.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}function a(){!function(){if(null===r)u.gravity(m.gravityStrength).charge(m.initialCharge);else{if(m.fixOffPathNodes){var t=ce.set();r.forEach(function(e){e.forEach(function(e){t.add(e)})}),Object.keys(v).forEach(function(e){t.has(e)?v[e].fixed=!1:v[e].fixed=!0})}u.charge(m.chargeForce)}}(),function(e){if(!e)return o("end");u.start();for(var t=0;t<300;++t)u.tick(),r&&i();u.stop()}(m.iterations)}function i(){function a(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function h(e,t){var n,r,o=(r=t,((n=e).x*r.x+n.y*r.y)/(a(e)*a(t)));return o=Math.min(o,1),o=Math.max(o,-1),Math.acos(o)}function p(e){var t=-e.y/e.x,n=a({x:t,y:1});return{x:t/n,y:1/n}}function y(e,t,n,r){e.x+=n.x*(Math.PI-t)*r,e.y+=n.y*(Math.PI-t)*r}r.forEach(function(e){if(!(e.length<3))for(var t=1;t<e.length-1;++t){var n=v[e[t]],r=v[e[t-1]],o=v[e[t+1]],a={x:r.x-n.x,y:r.y-n.y},i={x:o.x-n.x,y:o.y-n.y},u=h(a,i),c=p(a),l=p(i),s=(r.x+o.x)/2,d=(r.y+o.y)/2,f={x:s-r.x,y:d-r.y},g={x:s-o.x,y:d-o.y};c=h(f,c)>=Math.PI/2?c:{x:-c.x,y:-c.x},l=h(g,l)>=Math.PI/2?l:{x:-l.x,y:-l.x},y(r,u,c,m.angleForce),y(o,u,l,m.angleForce)}})}var d=de.graphviz_attrs(),f=Object.keys(d);return Object.assign(d,{layoutAlgorithm:function(){return"d3-force"},layoutId:function(){return t},supportsWebworker:function(){return!0},parent:he(null),on:function(e,t){return 1===arguments.length?n.on(e):(n.on(e,t),this)},init:function(t){var e;return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),m=e=t,(u=ce.layout.force().size([e.width,e.height])).on("tick",function(){o("tick")}).on("start",function(){n.start()}).on("end",function(){o("end")}),this},data:function(e,t,n,r){var o,a,i;a=n,i={},(o=t).forEach(function(e,t){i[e.dcg_nodeKey]=t}),l=be(v,o,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height,e.id=t.dcg_nodeKey}),s=be(c,a,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.source=v[t.dcg_edgeSource],e.source.id=i[e.source.dcg_nodeKey],e.target=v[t.dcg_edgeTarget],e.target.id=i[e.target.dcg_nodeKey],e.dcg_edgeLength=t.dcg_edgeLength}),u.nodes(l),u.links(s)},start:function(){a()},stop:function(){u&&u.stop()},paths:function(e){r=e},savePositions:function(){var t={};return Object.keys(v).forEach(function(e){t[e]={x:v[e].x,y:v[e].y}}),t},restorePositions:function(t){Object.keys(t).forEach(function(e){v[e]&&(v[e].fixed=!1,v[e].x=t[e].x,v[e].y=t[e].y)})},optionNames:function(){return["iterations","angleForce","chargeForce","gravityStrength","initialCharge","fixOffPathNodes"].concat(f)},iterations:he(300),angleForce:he(.02),chargeForce:he(-500),gravityStrength:he(1),initialCharge:he(-400),fixOffPathNodes:he(!1),populateLayoutNode:function(){},populateLayoutEdge:function(){}})},de.d3_force_layout.scripts=["d3.js"],de.d3v4_force_layout=function(e){var t=e||w(),u=null,n=ce.dispatch("tick","start","end"),v={},c={},l=[],s=[],r=null,o=null;function a(e){n[e](l,s.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}function i(){n.start(),function(t){if(null===t)u.force("charge").strength(r.initialCharge),u.force("angle",null);else{var n;r.fixOffPathNodes&&(n=ce.set(),t.forEach(function(e){e.forEach(function(e){n.add(e)})})),Object.keys(v).forEach(function(e){r.fixOffPathNodes&&!n.has(e)?(v[e].fx=v[e].x,v[e].fy=v[e].y):(v[e].fx=null,v[e].fy=null)}),u.force("charge").strength(r.chargeForce),u.force("angle",function(e){!function(e,t,g){function a(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function h(e,t){var n,r,o=(r=t,((n=e).x*r.x+n.y*r.y)/(a(e)*a(t)));return o=Math.min(o,1),o=Math.max(o,-1),Math.acos(o)}function p(e){var t=-e.y/e.x,n=a({x:t,y:1});return{x:t/n,y:1/n}}function y(e,t,n,r){e.x+=n.x*(Math.PI-t)*r,e.y+=n.y*(Math.PI-t)*r}t.forEach(function(e){if(!(e.length<3))for(var t=1;t<e.length-1;++t){var n=v[e[t]],r=v[e[t-1]],o=v[e[t+1]],a={x:r.x-n.x,y:r.y-n.y},i={x:o.x-n.x,y:o.y-n.y},u=h(a,i),c=p(a),l=p(i),s={x:(r.x+o.x)/2,y:(r.y+o.y)/2},d={x:s.x-r.x,y:s.y-r.y},f={x:s.x-o.x,y:s.y-o.y};c=h(d,c)>=Math.PI/2?c:{x:-c.x,y:-c.x},l=h(f,l)>=Math.PI/2?l:{x:-l.x,y:-l.x},y(r,u,c,g),y(o,u,l,g)}})}(0,t,r.angleForce)})}}(o),function(e){u.alpha(1);for(var t=0;t<e;++t)u.tick(),a("tick");a("end")}(r.iterations)}var d=de.graphviz_attrs(),f=Object.keys(d);return Object.assign(d,{layoutAlgorithm:function(){return"d3v4-force"},layoutId:function(){return t},supportsWebworker:function(){return!0},parent:he(null),on:function(e,t){return 1===arguments.length?n.on(e):(n.on(e,t),this)},init:function(t){var e;return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),r=e=t,u=d3v4.forceSimulation().force("link",d3v4.forceLink()).force("center",d3v4.forceCenter(e.width/2,e.height/2)).force("gravityX",d3v4.forceX(e.width/2).strength(r.gravityStrength)).force("gravityY",d3v4.forceY(e.height/2).strength(r.gravityStrength)).force("collision",d3v4.forceCollide(r.collisionRadius)).force("charge",d3v4.forceManyBody()).stop(),this},data:function(e,t,n,r){var o,a,i;a=n,i={},(o=t).forEach(function(e,t){i[e.dcg_nodeKey]=t}),l=be(v,o,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height,e.id=t.dcg_nodeKey}),s=be(c,a,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.source=i[v[t.dcg_edgeSource].dcg_nodeKey],e.target=i[v[t.dcg_edgeTarget].dcg_nodeKey],e.dcg_edgeLength=t.dcg_edgeLength}),u.nodes(l),u.force("link").links(s)},start:function(){i()},stop:function(){},paths:function(e){o=e},savePositions:function(){var t={};return Object.keys(v).forEach(function(e){t[e]={x:v[e].x,y:v[e].y}}),t},restorePositions:function(t){Object.keys(t).forEach(function(e){v[e]&&(v[e].fx=t[e].x,v[e].fy=t[e].y)})},optionNames:function(){return["iterations","angleForce","chargeForce","gravityStrength","collisionRadius","initialCharge","fixOffPathNodes"].concat(f)},iterations:he(300),angleForce:he(.01),chargeForce:he(-600),gravityStrength:he(.3),collisionRadius:he(8),initialCharge:he(-100),fixOffPathNodes:he(!1),populateLayoutNode:function(){},populateLayoutEdge:function(){}})},de.d3v4_force_layout.scripts=["d3.js","d3v4-force.js"],de.flexbox_layout=function(e){var r,o,a,t=e||w(),i=ce.dispatch("tick","start","end");function n(e,t){r=e,o={},t.forEach(function(e){!function e(t,n,r,o){if(o.address=t.slice(),o.children=o.children||{},n.length){var a=o.children[n[0]]=o.children[n[0]]||{};t.push(n.shift()),e(t,n,r,a)}else o.node=r}([],d.keyToAddress()(e.dcg_nodeKey),e,o)});(function t(n){var e=d.addressToKey()(n.address);return Array.prototype.concat.apply([e],Object.keys(n.children).map(function(e){return t(n.children[e])}))})(o);a=t}var c=["sort","dcg_nodeKey","x","y"],l=["width","height"];function u(){var e,t,n=function t(e,n){var r={name:d.addressToKey()(n.address),style:{}},o=Object.assign({},e),a=Object.keys(n.children).length;for(var i in n.node&&Object.assign(e,n.node),e)if(!(c.includes(i)||a&&l.includes(i))){var u=e[i];"function"==typeof u&&(u=u(n.node)),r.style[i]=u}return a&&(r.children=Object.values(n.children).sort(e.sort).map(function(e){return e.address[e.address.length-1]}).map(function(e){return t(Object.assign({},o),n.children[e])})),n.flexnode=r}({sort:function(e,t){return ce.ascending(e.node.dcg_nodeKey,t.node.dcg_nodeKey)}},o);n.style.width=r.width,n.style.height=r.height,d.logStuff()&&console.log(JSON.stringify(n,null,2)),computeLayout(n),function t(n,r){d.logStuff()&&console.log(r.node.dcg_nodeKey+": "+JSON.stringify(r.flexnode.layout)),r.node.x=n.x+r.flexnode.layout.left+r.flexnode.layout.width/2,r.node.y=n.y+r.flexnode.layout.top+r.flexnode.layout.height/2,Object.keys(r.children).map(function(e){return r.children[e]}).forEach(function(e){t({x:n.x+r.flexnode.layout.left,y:n.y+r.flexnode.layout.top},e)})}({x:0,y:0},o),e=a,t=[],i["end"](e,t.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}var s=["width","height","minWidth","minHeight","maxWidth","maxHeight","left","right","top","bottom","margin","marginLeft","marginRight","marginTop","marginBottom","padding","paddingLeft","paddingRight","paddingTop","paddingBottom","borderWidth","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","flexDirection","justifyContent","alignItems","alignSelf","flex","flexWrap","position"],d={layoutAlgorithm:function(){return"cola"},layoutId:function(){return t},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},parent:he(null),on:function(e,t){return 1===arguments.length?i.on(e):(i.on(e,t),this)},init:function(t){return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),this},data:function(e,t){n(e,t)},start:function(){u()},stop:function(){},optionNames:function(){return[]},populateLayoutNode:function(t,n){["sort","order"].concat(s).forEach(function(e){n.orig.value[e]&&(t[e]=n.orig.value[e])})},populateLayoutEdge:function(){},addressToKey:he(function(e){return e.join(",")}),keyToAddress:he(function(e){return e.split(",")}),logStuff:he(!1)};return d},de.flexbox_layout.scripts=["css-layout.js"],de.manual_layout=function(e){var r,t=e||w(),n=ce.dispatch("tick","start","end");function o(){var e,t;e=r,t=[],n["end"](e,t.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}return{layoutAlgorithm:function(){return"cola"},layoutId:function(){return t},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},parent:he(null),on:function(e,t){return 1===arguments.length?n.on(e):(n.on(e,t),this)},init:function(t){return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),this},data:function(e,t,n){r=t},start:function(){o()},stop:function(){},optionNames:function(){return[]},populateLayoutNode:function(t,n){["x","y"].forEach(function(e){void 0!==n.orig.value[e]&&(t[e]=n.orig.value[e])})},populateLayoutEdge:function(){},addressToKey:he(function(e){return e.join(",")}),keyToAddress:he(function(e){return e.split(",")})}},de.manual_layout.scripts=["css-layout.js"],de.place_ports=function(){function t(n,e,t,r,o,a,i){var u,c,l=n.nodePorts();function s(e,t){return 0<e[0]*t[1]-e[1]*t[0]}function d(e){return[Math.cos(e),Math.sin(e)]}function f(e){return Math.atan2(e[1],e[0])}function g(e,t){return Math.hypot(t.pos.x-e.pos.x,t.pos.y-e.pos.y)}for(var h in l){var p=e[h],y=l[h];y.forEach(function(e){var t=e.orig&&n.portBounds.eval(e)||[0,2*Math.PI];Array.isArray(t[0])?(e.vbounds=t,e.abounds=t.map(f)):(e.vbounds=t.map(d),e.abounds=t),e.abounds[0]>e.abounds[1]&&(e.abounds[1]+=2*Math.PI),console.assert(e.orig||e.vec,"unplaced unspecified port")});var v=[],m=[],x=[];y.forEach(function(e){var t,n;e.vec?!e.vbounds||(t=e.vec,s((n=e.vbounds)[0],t)&&s(t,n[1]))?v.push(e):m.push(e):x.push(e)}),m.forEach(function(e){var t,n;e.vec=(t=e.vec,n=e.vbounds,s(t,n[0])?n[0]:s(n[1],t)?n[1]:t),v.push(e)});var _={},b={};for(var w in x.forEach(function(e){var t=e.abounds.map(function(e){return e.toFixed(3)}).join(",");_[t]=e.abounds,b[t]=b[t]||[],b[t].push(e)}),b){var k=_[w],E=b[w];if(1===E.length)E[0].vec=d((k[0]+k[1])/2);else{var K=(k[1]-k[0])/(b[w].length-1);b[w].forEach(function(e,t){e.vec=d(k[0]+t*K)})}}v=v.concat(x),x=[],v.forEach(function(e){Te(n,p,e)});for(var S=0;S<v.length;++S){var A=v[S];if(!x.includes(A))for(var P=S+1;P<v.length;++P){var N=v[P];if(!x.includes(N)&&!(g(A,N)>j.minDistance())){if(!A.edges.length){x.push(A);continue}x.push(N)}}}v=v.filter(function(e){return!x.includes(e)});for(var L,T=j.patience(),D=0;x.length;){var M=x[0];M.vec=d((u=M.abounds[0],c=M.abounds[1],u+Math.random()*(c-u))),Te(n,p,M);var O=ce.min(v,function(e){return g(M,e)});D<O&&(D=O,L=M.vec),(!T--||O>j.minDistance())&&(T<0&&(console.warn("ran out of patience placing a port"),M.vec=L,Te(n,p,M)),v.push(M),x.shift(),T=j.patience(),D=0)}}}var j={parent:he(null).react(function(e){e?e.on("receivedLayout.place-ports",t):j.parent()&&j.parent().on("receivedLayout.place-ports",null)}),minDistance:he(20),patience:he(20)};return j},de.troubleshoot=function(){var s=null;function d(e,t,n){return{left:e.x-t/2,top:e.y-n/2,right:e.x+t/2,bottom:e.y+n/2}}function t(e,t,n,r){return"M"+e+","+(t+r)+" v"+-r+" h"+n}function n(e){return[t(e.left,e.top,g.boundsWidth(),g.boundsHeight()),t(e.right,e.top,-g.boundsWidth(),g.boundsHeight()),t(e.right,e.bottom,-g.boundsWidth(),-g.boundsHeight()),t(e.left,e.bottom,g.boundsWidth(),-g.boundsHeight())].join(" ")}function f(e,t){e.exit().remove(),e.enter().append("path").attr("class",t),e.attr({d:n,opacity:null!==g.boundsOpacity()?g.boundsOpacity():g.opacity(),stroke:g.boundsColor(),fill:"none"})}var g=de.behavior("highlight-paths",{laterDraw:!0,add_behavior:function(e,t,n,r){s||(s=e.g().append("g").attr({class:"draw-graphs","pointer-events":"none"}));var o=t.data().map(function(e){return{x:e.cola.x,y:e.cola.y}}),a=s.selectAll("path.nodecenter").data(o);function i(e){return{x:e.cola.x,y:e.cola.y}}a.exit().remove(),a.enter().append("path").attr("class","nodecenter"),a.attr({d:function(e){return"M"+(e.x-g.xhairWidth()/2)+","+e.y+" h"+g.xhairWidth()+" M"+e.x+","+(e.y-g.xhairHeight()/2)+" v"+g.xhairHeight()},opacity:null!==g.xhairOpacity()?g.xhairOpacity():g.opacity(),stroke:g.xhairColor()});var u=t.data().map(function(e){return d(i(e),e.cola.width,e.cola.height)});f(s.selectAll("path.colaboundary").data(u),"colaboundary");var c=t.data().map(function(e){return e.bbox?d(i(e),e.bbox.width,e.bbox.height):null}).filter(function(e){return!!e});f(s.selectAll("path.textboundary").data(c),"textboundary");var l=t.data().map(function(e){return"number"===(e.dcg_rx,!1)?null:d(i(e),2*e.dcg_rx,2*e.dcg_ry)}).filter(function(e){return!!e});f(s.selectAll("path.radiiboundary").data(l),"radiiboundary")},remove_behavior:function(e,t,n,r){s&&s.remove()}});return g.opacity=he(.75),g.xhairOpacity=he(null),g.xhairWidth=he(10),g.xhairHeight=he(10),g.xhairColor=he("blue"),g.boundsOpacity=he(null),g.boundsWidth=he(10),g.boundsHeight=he(10),g.boundsColor=he("green"),g},de.validate=function(p){function y(e,t,n,r){var o=e.filter(function(e){return!t(e)});return o.length?[n+" is empty for "+o.length+" of "+e.length+" "+r,o]:null}function v(e,n){return e.reduce(function(e,t){return e[n(t)]=t,e},{})}function m(t,e,n,r,o,a){var i=e.filter(function(e){return!t[n(e)]}).map(function(e){return{key:n(e),value:e}});return i.length?[r+" was not found in "+o,Object.keys(t),"for "+i.length+" of "+e.length+" "+a,i]:null}function t(){var t=x.parent(),e=t.nodeGroup().all(),n=t.edgeGroup().all(),r=t.portGroup()?t.portGroup().all():[],o=[];function a(e){e&&o.push(e)}a(y(e,t.nodeKey(),"nodeKey","nodes")),a(y(n,t.edgeSource(),"edgeSource","edges")),a(y(n,t.edgeTarget(),"edgeTarget","edges"));var i=ce.set(t.content.enum()),u=de.functor_wrap(t.nodeContent()),c=e.filter(function(e){return!i.has(u(e))});c.length&&o.push(["there are "+c.length+" nodes with nodeContent not matching any content",c]);var l=v(e,t.nodeKey()),s=v(n,t.edgeKey());a(m(l,n,t.edgeSource(),"edgeSource","nodes","edges")),a(m(l,n,t.edgeTarget(),"edgeTarget","nodes","edges")),a(y(r,function(e){return t.portNodeKey()&&t.portNodeKey()(e)||t.portEdgeKey()&&t.portEdgeKey()(e)},"portNodeKey||portEdgeKey","ports"));var d=!t.portNodeKey()&&[]||r.filter(function(e){return t.portNodeKey()(e)}),f=!t.portEdgeKey()&&[]||r.filter(function(e){return t.portEdgeKey()(e)});if(a(m(l,d,t.portNodeKey(),"portNodeKey","nodes","ports")),a(m(s,f,t.portEdgeKey(),"portEdgeKey","edges","ports")),t.portName()){var g=v(d,function(e){return t.portNodeKey()(e)+" - "+t.portName()(e)});t.edgeSourcePortName()&&a(m(g,n,function(e){return t.edgeSource()(e)+" - "+ce.functor(t.edgeSourcePortName())(e)},"edgeSourcePortName","ports","edges")),t.edgeTargetPortName()&&a(m(g,n,function(e){return t.edgeTarget()(e)+" - "+ce.functor(t.edgeTargetPortName())(e)},"edgeTargetPortName","ports","edges"))}function h(){return e.length+" nodes, "+n.length+" edges, "+r.length+" ports"}o.length?(console.warn("validation of "+p+" failed with "+h()+":"),o.forEach(function(e){console.warn.apply(null,e)})):console.log("validation of "+p+" succeeded with "+h()+".")}var x={parent:he(null).react(function(e){e?e.on("data.validate",t):x.parent().on("data.validate",null)})};return x},de.legend=function(){var r,o={},a=[],i=ce.dispatch("filtered");function u(){o.dimension()&&(o.dimension().filterFunction(function(e){return!a.length||a.includes(e)}),o.redraw(),o.parent().redraw())}return o.x=he(0),o.y=he(0),o.gap=he(5),o.nodeWidth=he(40),o.nodeHeight=he(40),o.noLabel=he(!0),o.replaceFilter=function(e){return a=e&&1===e.length?e[0]:[],o},o.filters=function(){return a},o.on=function(e,t){return i.on(e,t),o},o.exemplars=he({}),o.parent=he(null),o.redraw=function(){var e=o.parent().svg().selectAll("g.dc-graph-legend").data([0]);e.enter().append("g").attr("class","dc-graph-legend").attr("transform","translate("+o.x()+","+o.y()+")");var t=e.selectAll(".node").data(r,function(e){return e.name}),n=t.enter().append("g").attr("class","node");n.append("text").attr("dy","0.3em").attr("class","legend-label"),t.attr("transform",function(e,t){return"translate("+o.nodeWidth()/2+","+(o.nodeHeight()+o.gap())*(t+.5)+")"}),t.select("text.legend-label").attr("transform","translate("+(o.nodeWidth()/2+o.gap())+",0)").attr("pointer-events",o.dimension()?"auto":"none").text(function(e){return e.name}),o.parent()._enterNode(n)._updateNode(t),o.noLabel()&&t.selectAll(".node-label").remove(),o.dimension()?t.attr("cursor","pointer").on("click.legend",function(e){var t=o.parent().nodeKey.eval(e);a.length||(a=r.map(o.parent().nodeKey.eval)),a.includes(t)?a=a.filter(function(e){return e!==t}):a.push(t),u(),i.filtered(o,t)}):t.attr("cursor","auto").on("click.legend",null),t.transition().duration(1e3).attr("opacity",function(e){return!a.length||a.includes(o.parent().nodeKey.eval(e))?1:.25})},o.render=function(){var e=o.exemplars();if(e instanceof Array)r=e.map(function(e){return{name:e.name,orig:{key:e.key,value:e.value},cola:{}}});else for(var t in r=[],e)r.push({name:t,orig:{key:t,value:e[t]},cola:{}});o.redraw()},o.dimension=he(null).react(function(e){e||(a=[],u())}),o},de.constraint_pattern=function(e){var l={},r=[];return e.nodes.forEach(function(t){var e=t.id,n=l[e]||(l[e]={});if(t.partition){var r=t.partition,o=t.value||t.id;t.all||t.typename?(n.match=t.extract?function(e){return t.extract(e.value[r])}:function(e){return e.value[r]},n.typename=t.typename||function(e){return r+"="+e.value[r]}):n.match=function(e){return e.value[r]===o}}else{if(!t.match)throw new Error("couldn't determine matcher for type "+JSON.stringify(t));n.match=t.match}}),e.edges.forEach(function(t){if(!t.disable){var n={source:t.source,target:t.target};n.produce="function"==typeof t.produce?t.produce:function(){return function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(t.produce)},["listname","wrap","reverse"].forEach(function(e){void 0!==t[e]&&(n[e]=t[e])}),r.push(n)}}),function(i,o,a){var u=[],c={};o.forEach(function(e){var t=i.nodeKey.eval(e);for(var n in l){var r=l[n],o=r.match(e.orig);if(o){var a=r.typename?r.typename(n,o):n;c[a]||(c[a]={nodes:[],whether:{}}),c[a].nodes.push(t),c[a].whether[t]=!0}}});var t=r.filter(function(e){return e.source!==e.target}),e=r.filter(function(e){return e.source===e.target});return a.forEach(function(e){var n=i.edgeSource.eval(e),r=i.edgeTarget.eval(e);t.forEach(function(e){if(c[e.source]&&c[e.source].whether[n]&&c[e.target]&&c[e.target].whether[r]){var t=e.produce(c,o,a);e.reverse?(t.left=r,t.right=n):(t.left=n,t.right=r),u.push(t)}})}),e.forEach(function(e){if(c[e.source]){var t=e.produce(),n=e.listname||e.produce.listname||"nodes",r=e.wrap||e.produce.wrap||function(e){return e};t[n]=c[e.source].nodes.map(r),u.push(t)}}),u}},de.gap_y=function(e,t){return{axis:"y",gap:e,equality:!!t}},de.gap_x=function(e,t){return{axis:"x",gap:e,equality:!!t}},de.align_y=function(){return e("y")},de.align_x=function(){return e("x")},de.order_x=function(e,t){return{type:"ordering",axis:"x",gap:60,ordering:t}},de.order_y=function(e,t){return{type:"ordering",axis:"y",gap:60,ordering:t}},de.tree_positions=function(e,t,n,r,a,i,u){var c;function f(e,t){return(i(e)+i(t))/2}console.warn("dc_graph.tree_positions is deprecated; use the layout engine tree_layout instead"),(e||n)&&console.warn("dc_graph.tree_positions: rootf and treef are ignored"),i=ce.functor(i);var o=de.depth_first_traversal({nodeid:function(e){return e.cola.dcg_nodeKey},sourceid:function(e){return e.cola.dcg_edgeSource},targetid:function(e){return e.cola.dcg_edgeTarget},init:function(){c=r},row:function(e){return t(e.orig)},place:function(e,t,n){if(n.length){var r=n[n.length-1],o=(i(r)+i(e))/2;c=Math.max(c,r.left_x+o)}e.left_x=c,e.hit_ins=1,e.cola.y=t*u+a},sib:function(e,t,n){var r=f(t,n);e&&(r*=1.5),c+=r},pop:function(e){e.cola.x=(e.left_x+c)/2},skip:function(e,t){e.cola.x=(e.hit_ins*e.cola.x+c)/++e.hit_ins,e.hit_ins===t&&delete e.hit_ins},finish:function(e){e.forEach(function(e){for(var t,n=e.sort(function(e,t){return e.cola.x-t.cola.x}),r=null,o=null,a=0;a<n.length-1;++a){var i=n[a],u=n[a+1];if(r){if(t+=f(i,u),a<n.length-2&&u.cola.x<o+t)continue;var c,l;if(0<r&&--r,a<n.length-2){var s=u.cola.x-(o+t);c=n[r].cola.x+s/2,l=a+1}else c=Math.max(n[r].cola.x,o-f(n[r],n[r+1])-(t-u.cola.x+o)/2),l=n.length;for(var d=r+1;d<l;++d)c+=f(n[d-1],n[d]),n[d].cola.x=c;r=o=t=null}else u.cola.x-i.cola.x<f(i,u)&&(r=a,o=i.cola.x,t=f(i,u))}})}});return function(e,t,n){return o(t,n)}},de.tree_constraints=function(n,r,u,e){return console.warn("dc_graph.tree_constraints is deprecated - it never worked right and may not be a good idea"),function(o,e,t){var a=[],i=0;return de.depth_first_traversal({root:n,tree:r,place:function(e,t,n){if(n.length){var r=n[n.length-1];a.push({left:o.nodeKey.eval(r),right:o.nodeKey.eval(e),axis:"x",gap:i-r.foo_x,equality:!0})}e.foo_x=i},sib:function(){i+=u}})(o,e,t),a}},de.behavior=function(a,i){var t={},u=i.laterDraw?"transitionsStarted":"drawn";return t.parent=he(null).react(function(e){var r;if(e){var o=!0;(r=e).on(u+"."+a,function(e,t,n){i.add_behavior(r,e,t,n),o&&i.first?(i.first(r,e,t,n),o=!1):i.rest&&i.rest(r,e,t,n)})}else t.parent()&&(r=t.parent()).on(u+"."+a,function(e,t,n){i.remove_behavior(r,e,t,n),r.on(u+"."+a,null)});i.parent&&i.parent(e)}),t},de.tip=function(e){var i,u,c=(e=e||{}).namespace||"tip",l=null;function s(){(!ce.event.relatedTarget||d.selection().exclude&&d.selection().exclude(ce.event.target)||!(this.contains(ce.event.relatedTarget)||d.clickable()&&ce.event.relatedTarget.classList.contains("d3-tip")))&&(i&&(window.clearTimeout(i),i=null),d.clickable()?u=window.setTimeout(function(){l.hide()},d.hideDelay()):l.hide())}var d=de.behavior(c,{add_behavior:function(e,t,n,r){var o,a;o=e,l||(l=ce.tip().attr("class","d3-tip").html(function(e){return"<span>"+e+"</span>"}).direction(d.direction()),d.offset()&&l.offset(d.offset()),o.svg().call(l)),d.selection().select(e,t,n,r).on("mouseover."+c,(a="content",function(e){var t=this,n=function(){d[a]()(e,function(e){l.show.call(t,e,t),ce.select("div.d3-tip").selectAll("a.tip-link").on("click",function(){ce.event.preventDefault(),d.linkCallback()&&d.linkCallback()(this.id)})})};d.selection().exclude&&d.selection().exclude(ce.event.target)?s.call(this):(u&&window.clearTimeout(u),d.delay()?(window.clearTimeout(i),i=window.setTimeout(n,d.delay())):n())})).on("mouseout."+c,s),d.clickable()&&ce.select("div.d3-tip").on("mouseover."+c,function(){u&&window.clearTimeout(u)}).on("mouseout."+c,s)},remove_behavior:function(e,t,n,r){d.selection().select(e,t,n,r).on("mouseover."+c,null).on("mouseout."+c,null)},laterDraw:!0});return d.direction=he("n"),d.content=he(function(e,t){t(d.parent()?d.parent().nodeTitle.eval(e):"")}),d.selection=he(de.tip.select_node_and_edge()),d.showDelay=d.delay=he(0),d.hideDelay=he(200),d.offset=he(null),d.clickable=he(!1),d.linkCallback=he(null),d},de.tip.table=function(){var a=function(t,e){t=t.orig.value;var n=Object.keys(t).filter(ce.functor(a.filter())).filter(function(e){return t[e]}),r=ce.select(document.createElement("table")),o=r.selectAll("tr").data(n).enter().append("tr");o.append("td").text(function(e){return e}),o.append("td").text(function(e){return t[e]}),e(r.node().outerHTML)};return a.filter=he(!0),a},de.tip.select_node_and_edge=function(){return{select:function(e,t,n,r){var o=e.selectAll(".foo-this-does-not-exist");return o[0]=t[0].concat(r[0]),o},exclude:function(e){return a(e,"port")}}},de.tip.select_node=function(){return{select:function(e,t,n,r){return t},exclude:function(e){return a(e,"port")}}},de.tip.select_edge=function(){return{select:function(e,t,n,r){return n}}},de.tip.select_port=function(){return{select:function(e,t,n,r){return t.selectAll("g.port")}}},de.keyboard=function(){var t,n=ce.dispatch("keydown","keyup");function r(){n.keydown()}function o(){n.keyup()}var a=de.behavior("brush",{add_behavior:function(e){(t=e.svg().selectAll("a#dcgraph-keyboard").data([1])).enter().insert("a",":first-child").attr({id:"dcgraph-keyboard",href:"#"}),t.on("keydown.keyboard",r),t.on("keyup.keyboard",o),e.svg().on("mouseup.keyboard",function(){a.focus()})},remove_behavior:function(e){t.remove()}});return a.on=function(e,t){return 1===arguments.length?n.on(e):(n.on(e,t),this)},a.focus=function(){a.disableFocus()||t.node().focus()},a.disableFocus=he(!1),a},de.edit_text=function(e,t){var n=e.append("foreignObject").attr({height:"100%",width:"100%"});function r(){var e;switch(t.align){case"left":e=[t.box.x,t.box.y];break;default:case"center":e=[t.box.x+(t.box.width-o.node().offsetWidth)/2,t.box.y+(t.box.height-o.node().offsetHeight)/2]}n.attr("transform","translate("+e.join(" ")+")")}var o=n.append("xhtml:div"),a=t.text||"type on me";function i(){ce.event.stopPropagation()}function u(){t.cancel&&t.cancel(),o.on("blur.edittext",null),n.remove(),t.finally&&t.finally()}o.text(a).attr({contenteditable:!0,width:"auto"}).style({display:"inline-block","background-color":"white",padding:"2px"}),n.on("mousedown",i).on("mousemove",i).on("mouseup",i).on("dblclick",i),o.on("keydown.edittext",function(){13===ce.event.keyCode&&ce.event.preventDefault()}).on("keyup.edittext",function(){13===ce.event.keyCode?(t.accept&&t.accept(o.text()),o.on("blur.edittext",null),n.remove(),t.finally&&t.finally()):27===ce.event.keyCode&&u(),r()}).on("blur.edittext",u),r(),o.node().focus();var c=document.createRange();t.selectText?c.selectNodeContents(o.node()):(c.setStart(o.node(),1),c.setEnd(o.node(),1));var l=window.getSelection();l.removeAllRanges(),l.addRange(c)},de.brush=function(){var t,n=null,r=ce.dispatch("brushstart","brushmove","brushend");function o(){r.brushstart()}function a(){var e=n.extent();r.brushmove(e)}function i(){r.brushend(),t.call(n.clear())}function e(){t&&(t.remove(),t=null)}var u=de.behavior("brush",{add_behavior:function(){},remove_behavior:e});return u.on=function(e,t){return 1===arguments.length?r.on(e):(r.on(e,t),this)},u.activate=function(){var e;return e=u.parent(),n||(n=ce.svg.brush().x(e.x()).y(e.y()).on("brushstart",o).on("brush",a).on("brushend",i)),t||(t=e.svg().insert("g",":first-child").attr("class","brush").call(n)),this},u.deactivate=function(){return e(),this},u.isActive=function(){return!!t},u},de.select_things=function(a,i,u){var r,c=[],l=null,n=u.keysEqual?function(t){return function(e){return u.keysEqual(t,e)}}:function(t){return function(e){return t===e}};function s(e,t){return!!c.find(n(t))}function d(e){return e.shiftKey}function f(e){return x?e.metaKey:e.ctrlKey}function g(e,t){return s(0,t)?e:e.concat([t])}function h(e,t){return s(0,t)?e.filter(function(e){return e!=t}):e.concat([t])}var o=!1;function p(e,t){o!==t&&(e.svg().on("click."+i,t?function(e){ce.event.target===this&&a.set_changed([])}:null),o=t)}function y(){d(ce.event.sourceEvent)||f(ce.event.sourceEvent)?r=c.slice():(r=[],a.set_changed([]))}function v(e){var t,n=u.intersectRect(e);t=d(ce.event.sourceEvent)?n.reduce(g,r):f(ce.event.sourceEvent)?n.reduce(h,r):n,a.set_changed(t)}var m=de.behavior(i,{add_behavior:function(e,t,n){var r=m.noneIsAll()?function(e){return!c.length||s(0,u.key(e))}:function(e){return s(0,u.key(e))};if(u.applyStyles(r),u.clickables(e,t,n).on("mousedown."+i,function(e){l=e}),u.clickables(e,t,n).on("mouseup."+i,function(e){if(!(u.excludeClick&&u.excludeClick(ce.event.target)||l!==e)){var t,n=u.key(e);m.multipleSelect()&&(d(ce.event)?t=g(c,n):f(ce.event)&&(t=h(c,n))),t||(t=[n]),a.set_changed(t)}}),m.multipleSelect()?e.child("brush").activate():p(e,m.clickBackgroundClears()),m.autoCropSelection()){u.clickables(e,t,n).data().map(u.key);var o=c.filter(function(e){return s(0,e)});c.length!==o.length&&a.set_changed(o,!1)}},remove_behavior:function(e,t,n){u.clickables(e,t,n).on("click."+i,null),e.svg().on("click."+i,null),u.removeStyles()},parent:function(e){var n;if(a.on("set_changed."+i,e?(n=e,function(e,t){void 0===t&&(t=!0),c=e,t&&n.refresh()}):null),e){var t=e.child("brush");t||(t=de.brush(),e.child("brush",t)),t.on("brushstart."+i,y).on("brushmove."+i,v)}},laterDraw:u.laterDraw||!1});return m.multipleSelect=he(!0),m.clickBackgroundClears=he(!0,!1).react(function(e){!m.multipleSelect()&&m.parent()&&p(m.parent(),e)}),m.noneIsAll=he(!1),m.autoCropSelection=he(!0),m.thinginess=function(){return u},m},de.select_things_group=function(e,t){return window.chart_registry.create_type(t,function(){return ce.dispatch("set_changed")}),window.chart_registry.create_group(t,e)},de.select_nodes=function(t,e){e=e||{};var n=de.select_things_group(e.select_nodes_group||"select-nodes-group","select-nodes"),r={intersectRect:function(t){return o.parent().selectAllNodes().data().filter(function(e){return e&&t[0][0]<e.cola.x&&e.cola.x<t[1][0]&&t[0][1]<e.cola.y&&e.cola.y<t[1][1]}).map(this.key)},clickables:function(e,t,n){return t},excludeClick:function(e){return a(e,"port")},key:function(e){return o.parent().nodeKey.eval(e)},applyStyles:function(e){o.parent().cascade(50,!0,b(e,null,t))},removeStyles:function(){o.parent().cascade(50,!1,t)}},o=de.select_things(n,"select-nodes",r);return o},de.select_edges=function(t,e){e=e||{};var n=de.select_things_group(e.select_edges_group||"select-edges-group","select-edges"),r={intersectRect:function(t){return this.clickables().data().filter(function(e){return[{x:e.source.cola.x+e.sourcePort.pos.x,y:e.source.cola.y+e.sourcePort.pos.y},{x:e.target.cola.x+e.targetPort.pos.x,y:e.target.cola.y+e.targetPort.pos.y}].some(function(e){return t[0][0]<e.x&&e.x<t[1][0]&&t[0][1]<e.y&&e.y<t[1][1]})}).map(this.key)},clickables:function(){return o.parent().selectAllEdges(".edge-hover")},key:function(e){return o.parent().edgeKey.eval(e)},applyStyles:function(e){o.parent().cascade(50,!0,b(null,e,t))},removeStyles:function(){o.parent().cascade(50,!1,t)}},o=de.select_things(n,"select-edges",r);return o},de.select_ports=function(t,e){var n=(e=e||{}).portStyle||"symbols",r=de.select_things_group(e.select_ports_group||"select-ports-group","select-ports"),o={laterDraw:!0,intersectRect:null,clickables:function(){return a.parent().selectAllNodes("g.port")},key:function(e){return e.named?{node:a.parent().nodeKey.eval(e.node),name:e.name}:{edge:a.parent().edgeKey.eval(e.edges[0]),name:e.name}},applyStyles:function(e){a.parent().portStyle(n).cascade(50,!0,c(e,t))},removeStyles:function(){a.parent().portStyle(n).cascade(50,!1,t)},keysEqual:function(e,t){return e.name===t.name&&(e.node?e.node===t.node:e.edge===t.edge)}},a=de.select_things(r,"select-ports",o);return a},de.move_nodes=function(e){e=e||{};var i,u,c,n,l=de.select_things_group(e.select_nodes_group||"select-nodes-group","select-nodes"),s=de.fix_nodes_group("fix-nodes-group"),d=[],f=null;function g(n){d.forEach(function(e){var t=h.parent().getWholeNode(e);n(t,e)})}var h=de.behavior("move-nodes",{add_behavior:function(r,o,a){function e(){if(f){var e=de.event_coords(r),t=e[0]-f[0],n=e[1]-f[1];!u&&Math.hypot(t,n)>h.dragSize()&&(u=!0,i&&i.style("pointer-events","none")),u&&(g(function(e){e.cola.x=e.original_position[0]+t,e.cola.y=e.original_position[1]+n}),r.reposition(o,a))}}function t(){if(f){if(u){u=!1,i&&(i.style("pointer-events",null),i=null);var n=[];g(function(e,t){n.push({id:t,pos:{x:e.cola.x,y:e.cola.y}})}),s.request_fixes(n)}c&&c.activate(),f=null}}o.on("mousedown.move-nodes",function(e){if(!(n&&n.usePorts()&&n.usePorts().eventPort())){f=de.event_coords(r),i=ce.select(this);var t=r.nodeKey.eval(e);d.indexOf(t)<0&&l.set_changed([t]),g(function(e){e.original_position=[e.cola.x,e.cola.y]}),c&&c.deactivate()}}),o.on("mousemove.move-nodes",e).on("mouseup.move-nodes",t),r.svg().on("mousemove.move-nodes",e).on("mouseup.move-nodes",t)},remove_behavior:function(e,t,n){t.on("mousedown.move-nodes",null),t.on("mousemove.move-nodes",null),t.on("mouseup.move-nodes",null)},parent:function(e){l.on("set_changed.move-nodes",e?function(e,t){void 0===t&&(t=!0),d=e}:null),c=e.child("brush"),n=e.child("draw-graphs"),e.child("select-nodes")}});return h.dragSize=he(5),h},de.fix_nodes=function(e){e=e||{};var d,f,t=de.fix_nodes_group("fix-nodes-group"),i=e.fixedPosTag||"fixedPos",u=[],g={nodeid:function(e){return y.parent().nodeKey.eval(e)},sourceid:function(e){return y.parent().edgeSource.eval(e)},targetid:function(e){return y.parent().edgeTarget.eval(e)},get_fix:function(e){return y.parent().nodeFixed.eval(e)},fix_node:function(e,t){e[i]=t},unfix_node:function(e){e[i]=null},clear_fixes:function(){u={}},register_fix:function(e,t){u[e]=t}};function n(e){y.strategy().request_fixes(g,e),c(h()).then(function(){y.parent().redraw()})}function r(e,t,n){y.strategy().new_node(g,e,t,n)}function o(e,t,n){var r=d[t],o=d[n];y.strategy().new_edge(g,e,r,o)}function h(){var a=[];return f.forEach(function(e){var t=y.parent().nodeKey.eval(e),n=u[t],r=e.orig.value[i],o=!1;r?n&&n.x===r.x&&n.y===r.y||(o=!0):o=n,o&&a.push({n:e,fixed:n?{x:n.x,y:n.y}:null})}),a}function a(e,t){t?g.fix_node(e.orig.value,t):g.unfix_node(e.orig.value)}function c(e){var n=y.fixNode()||function(e,t){return Promise.resolve(t)},t=e.map(function(t){var e=y.parent().nodeKey.eval(t.n);return n(e,t.fixed).then(function(e){a(t.n,e)})});return Promise.all(t)}function p(e){e.forEach(function(e){a(e.n,e.fixed)})}function l(e,t,n,r,o,a,i){if(d=t,f=n,r,o,y.strategy().on_data){y.strategy().on_data(g,t,n,r,o,a,i);var u=h();p(u),y.reportOverridesAsynchronously()&&(c=u,l=y.fixNode()||function(e,t){return Promise.resolve(t)},s=c.map(function(e){var t=y.parent().nodeKey.eval(e.n);return l(t,e.fixed)}),Promise.all(s))}var c,l,s}var y={parent:he(null).react(function(e){t.on("request_fixes.fix-nodes",e?n:null).on("new_node.fix_nodes",e?r:null).on("new_edge.fix_nodes",e?o:null),e?e.on("data.fix-nodes",l):y.parent()&&y.parent().on("data.fix-nodes",null)}),fixNode:he(null),fixAllNodes:function(e){void 0===e&&(e=!0);var t=f.map(function(e){return{n:e,fixed:{x:e.cola.x,y:e.cola.y}}});return e?c(t):(p(t),Promise.resolve(void 0))},clearFixes:function(){y.strategy().clear_all_fixes&&y.strategy().clear_all_fixes(),g.clear_fixes()},strategy:he(de.fix_nodes.strategy.fix_last()),reportOverridesAsynchronously:he(!0)};return y},de.fix_nodes.strategy={},de.fix_nodes.strategy.fix_last=function(){return{request_fixes:function(t,e){t.clear_fixes(),e.forEach(function(e){t.register_fix(e.id,e.pos)})},new_node:function(e,t,n,r){e.fix_node(n,r)},new_edge:function(e,t,n,r){e.unfix_node(n.orig.value),e.unfix_node(r.orig.value)}}},de.fix_nodes.strategy.last_N_per_component=function(c){c=c||1;var l=0,s={};return{clear_all_fixes:function(){s={}},request_fixes:function(e,t){++l,t.forEach(function(e){s[e.id]={id:e.id,age:l,pos:e.pos}})},new_node:function(e,t,n,r){++l,s[t]={id:t,age:l,pos:r},e.fix_node(n,r)},new_edge:function(){},on_data:function(u,e,t,n,r,o,a){++l,t.forEach(function(e){var t=u.nodeid(e),n=u.get_fix(e);n&&!s[t]&&(s[t]={id:t,age:l,pos:n})});var i=[];de.undirected_dfs({nodeid:u.nodeid,sourceid:u.sourceid,targetid:u.targetid,comp:function(){i.push([])},node:function(e,t){i[e].push(t)}})(t,r),u.clear_fixes(),i.forEach(function(e,n){var r=e.reduce(function(e,t){if(t.last_component){var n=e[t.last_component]=e[t.last_component]||{total:0,fixed:0};n.total++,s[u.nodeid(t)]&&n.fixed++}return e},{}),t=Object.keys(r).reduce(function(e,t){return r[t].fixed&&e.push({compid:+t,total:r[t].total,fixed:r[t].fixed}),e},[]).sort(function(e,t){return t.total-e.total}),o=t.length&&t[0].compid,a=e.filter(function(e){return!e.last_component||e.last_component===o}).map(function(e){return s[u.nodeid(e)]}).filter(function(e){return e});a.length>c&&(a.sort(function(e,t){return t.age-e.age}),a=a.slice(0,c)),a.forEach(function(e){u.register_fix(e.id,e.pos)});var i=a.reduce(function(e,t){return e[t.id]=!0,e},{});e.forEach(function(e){var t=u.nodeid(e);i[t]||(s[t]=null),e.last_component=n+1})})}}},de.fix_nodes_group=function(e){return window.chart_registry.create_type("fix-nodes",function(){return ce.dispatch("request_fixes","new_node","new_edge")}),window.chart_registry.create_group("fix-nodes",e)},de.filter_selection=function(e,t){t=t||"select-nodes";var r=de.select_things_group(e||"select-nodes-group",t);var o={parent:he(null).react(function(e){var n;r.on("set_changed.filter-selection-"+t,e?(n=e,function(e){if(e.length){var t=ce.set(e);o.dimensionAccessor()(n).filterFunction(function(e){return t.has(e)})}else o.dimensionAccessor()(n).filter(null);n.redrawGroup()}):null)})};return o.dimensionAccessor=he(function(e){return e.nodeDimension()}),o},de.delete_things=function(t,n,r){r=r||"id";var o,a=x?"Backspace":"Delete",i=[];function u(e){i=e}function c(e){return e[r]}function l(e){if(!s.crossfilterAccessor())throw new Error("need crossfilterAccessor");if(!s.dimensionAccessor())throw new Error("need dimensionAccessor");if(0===(e=e||i).length)return Promise.resolve([]);var t=s.preDelete()?s.preDelete()(e):Promise.resolve(e);return s.onDelete()&&(t=t.then(s.onDelete())),t.then(function(t){if(t&&t.length){var e=s.crossfilterAccessor()(s.parent()),n=s.dimensionAccessor()(s.parent()),r=e.all().slice();r.length;n.filter(null),e.remove();var o=r.filter(function(e){return-1===t.indexOf(c(e))});r.length!==o.length+t.length&&console.warn("size after deletion is not previous size minus selection size",o.map(c),r.map(c),t),e.add(o),s.parent().redrawGroup()}return!0})}var s=de.behavior(n,{add_behavior:function(e){o.on("keyup."+n,function(){ce.event.code===a&&l()})},remove_behavior:function(e){},parent:function(e){t.on("set_changed."+n,u),e&&((o=e.child("keyboard"))||e.child("keyboard",o=de.keyboard()))}});return s.preDelete=he(null),s.onDelete=he(null),s.crossfilterAccessor=he(null),s.dimensionAccessor=he(null),s.deleteSelection=l,s},de.delete_nodes=function(e,t){t=t||{};var n=de.select_things_group(t.select_nodes_group||"select-nodes-group","select-nodes"),o=de.select_things_group(t.select_edges_group||"select-edges-group","select-edges"),a=de.delete_things(n,"delete-nodes",e);return a.preDelete(function(t){var n=a.parent(),r=n.child("delete-edges");return r?Promise.resolve(void 0).then(function(){var e=n.edgeGroup().all().filter(function(e){return-1!==t.indexOf(n.edgeSource()(e))||-1!==t.indexOf(n.edgeTarget()(e))}).map(n.edgeKey());return o.set_changed(e),r.deleteSelection().then(function(){return t})}):null}),a},de.label_things=function(o){o=o||{};var a,i,t=de.select_things_group(o.select_group,o.select_type),u=de.label_things_group(o.label_group,o.label_type),c=[];function l(){a.focus()}function r(e,t,n){var r=o.find_thing(c[0],e,t);r.empty()?console.error("couldn't find thing '"+c[0]+"'!"):1<r.size()?console.error("found too many things for '"+c[0]+"' ("+r.size()+")!"):u.edit_label(r,n)}var n=de.behavior(o.label_type,{add_behavior:function(e,t,n){a.on("keyup."+o.label_type,function(){if(c.length){if(1!==ce.event.key.length)return;r(t,n,{text:ce.event.key,selectText:!1})}}),i&&i.thinginess().clickables(e,t,n).on("dblclick."+o.label_type,function(){r(t,n,{selectText:!0})})},remove_behavior:function(e,t,n){},parent:function(e){var r;t.on("set_changed."+o.label_type,e?function(e){c=e}:null),u.on("edit_label."+o.label_type,e?(r=e,function(t,e){var n=o.thing_box(t);de.edit_text(r.g(),{text:e.text||o.thing_label(t)||o.default_label,align:o.align,box:n,selectText:e.selectText,accept:function(e){return o.accept(t,e)},finally:l})}):null),e&&((a=e.child("keyboard"))||e.child("keyboard",a=de.keyboard()),i=e.child(o.select_type))}});return n.editSelection=function(e){r(n.parent().selectAllNodes(),n.parent().selectAllEdges(),e)},n},de.label_things_group=function(e,t){return window.chart_registry.create_type(t,function(){return ce.dispatch("edit_label")}),window.chart_registry.create_group(t,e)},de.label_nodes=function(e){var n=(e=e||{}).labelTag||"label";e.select_group=e.select_group||"select-nodes-group",e.select_type=e.select_type||"select-nodes",e.label_group=e.label_group||"label-nodes-group",e.label_type=e.label_type||"label-nodes",e.default_label="node name",e.find_thing=function(t,e,n){return e.filter(function(e){return r.parent().nodeKey.eval(e)===t})},e.thing_box=function(e,t){var n=r.parent().content(r.parent().nodeContent.eval(e.datum())).textbox(e);return n.x+=e.datum().cola.x,n.y+=e.datum().cola.y,n},e.thing_label=function(e){return r.parent().nodeLabel.eval(e.datum())},e.accept=function(t,e){return(r.changeNodeLabel()?r.changeNodeLabel()(r.parent().nodeKey.eval(t.datum()),e):Promise.resolve(e)).then(function(e){t.datum().orig.value[n]=e,r.parent().redrawGroup()})};var r=de.label_things(e);return r.changeNodeLabel=he(null),r},de.label_edges=function(e){var n=(e=e||{}).labelTag||"label";e.select_group=e.select_group||"select-edges-group",e.select_type=e.select_type||"select-edges",e.label_group=e.label_group||"label-edges-group",e.label_type=e.label_type||"label-edges",e.default_label="edge name",e.find_thing=function(t,e,n){return n.filter(function(e){return r.parent().edgeKey.eval(e)===t})},e.thing_box=function(e,t){var n=e.datum().pos.new.path.points;return{x:(n[0].x+n[1].x)/2,y:(n[0].y+n[1].y)/2-10,width:0,height:20}},e.thing_label=function(e){return r.parent().edgeLabel.eval(e.datum())},e.accept=function(t,e){return(r.changeEdgeLabel()?r.changeEdgeLabel()(r.parent().edgeKey.eval(t.datum()),e):Promise.resolve(e)).then(function(e){t.datum().orig.value[n]=e,r.parent().redrawGroup()})};var r=de.label_things(e);return r.changeEdgeLabel=he(null),r},de.highlight_neighbors=function(a){function i(e){e.each(function(e){e.dcg_highlighted=!1})}return de.behavior("highlight-neighbors",{add_behavior:function(n,r,o){n.cascade(100,!0,b(null,function(e){return e.dcg_highlighted},a)),r.on("mouseover.highlight-neighbors",function(t){o.each(function(e){e.dcg_highlighted=e.source===t||e.target===t}),n.refresh(r,o)}).on("mouseout.highlight-neighbors",function(e){i(o),n.refresh(r,o)})},remove_behavior:function(e,t,n){var r,o;r=e,o=n,t.on("mouseover.highlight-neighbors",null).on("mouseout.highlight-neighbors",null),i(o),r.cascade(100,!1,a)}})},de.register_highlight_paths_group=function(e){return window.chart_registry.create_type("highlight-paths",function(){return ce.dispatch("paths_changed","hover_changed","select_changed")}),window.chart_registry.create_group("highlight-paths",e)},de.highlight_paths=function(o,a,i,e){var u=de.register_highlight_paths_group(e||"highlight-paths-group");o=o||{},a=a||{},i=i||{};var t,c={},l={},s=null,d=null;function n(){x.doRedraw()?x.parent().relayout().redraw():x.parent().refresh()}function r(e,t){s=d=null,0===Object.keys(c).length&&0===Object.keys(e).length&&0===Object.keys(l).length&&0===Object.keys(t).length||(c=e,l=t,n())}function f(e){e!==d&&(d=e,n())}function g(e){e!==s&&(s=e,n())}function h(t){return function(e){return 0<=t.indexOf(e)}}function p(e){var t=h(e);return function(e){return!t(e)}}function y(e,t){return!(!e||!t)&&e.some(h(t))}function v(e,t){return e?t?t.every(h(e))?e.filter(p(t)):e.concat(t.filter(p(e))):e:t}function m(e,t,n,r){t.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),r.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),c={},l={},e.cascade(200,!1,o).cascade(300,!1,i).cascade(400,!1,a)}var x=de.behavior("highlight-paths",{add_behavior:function(t,e,n,r){t.cascade(200,!0,b(function(e){return!!c[t.nodeKey.eval(e)]},function(e){return!!l[t.edgeKey.eval(e)]},o)).cascade(300,!0,b(function(e){return y(c[t.nodeKey.eval(e)],s)},function(e){return y(l[t.edgeKey.eval(e)],s)},i)).cascade(400,!0,b(function(e){return y(c[t.nodeKey.eval(e)],d)},function(e){return y(l[t.edgeKey.eval(e)],d)},a)),e.on("mouseover.highlight-paths",function(e){u.hover_changed(c[t.nodeKey.eval(e)]||null)}).on("mouseout.highlight-paths",function(e){u.hover_changed(null)}).on("click.highlight-paths",function(e){u.select_changed(v(s,c[t.nodeKey.eval(e)]))}),r.on("mouseover.highlight-paths",function(e){u.hover_changed(l[t.edgeKey.eval(e)]||null)}).on("mouseout.highlight-paths",function(e){u.hover_changed(null)}).on("click.highlight-paths",function(e){u.select_changed(v(s,l[t.nodeKey.eval(e)]))})},remove_behavior:function(e,t,n,r){return m(e,t,0,r),this},parent:function(e){e&&(t=e.anchorName()),u.on("paths_changed.highlight"+t,e?r:null),u.on("hover_changed.highlight"+t,e?f:null),u.on("select_changed.highlight"+t,e?g:null)}});return x.doRedraw=he(!1),x},de.draw_spline_paths=function(i,y,u,e){var c=de.register_highlight_paths_group(e||"highlight-paths-group");y=y||{},u=u||{};var t,l=null,s=null,d=null;function n(e,t,n){s.selectAll(".spline-edge").remove(),s.selectAll(".spline-edge-hover").remove(),l=n;var r=h.parent().layoutEngine(),o=n.filter(f);if(o.length){var a=o.map(function(e){return i.elementList.eval(e).filter(function(e){return"node"===i.elementType.eval(e)}).map(function(e){return i.nodeKey.eval(e)})});r.paths(a)}else r.paths(null),d&&r.restorePositions(d);h.parent().redraw()}function f(e){return i.elementList.eval(e).every(function(e){return"node"!==i.elementType.eval(e)||h.parent().getWholeNode(i.nodeKey.eval(e))})}function g(e,t){t=t||.6;var n,r,o=(n=e,r=[],i.elementList.eval(n).forEach(function(e){var t,n;switch(i.elementType.eval(e)){case"node":t=i.nodeKey.eval(e),null!==(n=h.parent().getWholeNode(t))&&r.push({x:n.cola.x,y:n.cola.y})}}),r);return y.insertDummyNodes&&(o=function(e){for(var t,n,r=[],o=0;o<e.length;o++)if(0<=o-1&&o+1<e.length)if(e[o-1].x===e[o+1].x&&e[o-1].y===e[o+1].y){var a=e[o-1].x,i=e[o-1].y,u=a-(d=e[o].x),c=(g=i-(f=e[o].y))/Math.sqrt(u*u+g*g),l=-u/Math.sqrt(u*u+g*g),s={x:null,y:null};(h={x:null,y:null}).x=(a+d)/2+(p=10)*c,h.y=(i+f)/2+p*l,s.x=(a+d)/2-p*c,s.y=(i+f)/2-p*l,r.push(h),r.push(e[o]),r.push(s)}else if(t=e[o-1],n=e[o+1],Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))<y.nearNodesDistance){var d,f,g,h,p;a=e[o-1].x,i=e[o-1].y,u=a-(d=e[o].x),c=(g=i-(f=e[o].y))/Math.sqrt(u*u+g*g),l=-u/Math.sqrt(u*u+g*g),(h={x:null,y:null}).x=(a+d)/2+(p=10)*c,h.y=(i+f)/2+p*l,a=e[o].x,i=e[o].y,u=a-(d=e[o+1].x),c=(g=i-(f=e[o+1].y))/Math.sqrt(u*u+g*g),l=-u/Math.sqrt(u*u+g*g),(s={x:null,y:null}).x=(a+d)/2+p*c,s.y=(i+f)/2+p*l,r.push(h),r.push(e[o]),r.push(s)}else r.push(e[o]);else r.push(e[o]);return r}(o)),ce.svg.line().interpolate("cardinal").x(function(e){return e.x}).y(function(e){return e.y}).tension(t)(o)}c.on("hover_changed.draw-spline-paths",function(e){!function(e){if(null===e)ce.selectAll(".spline-edge").attr("stroke","black");else for(var t=0;t<e.length;t++){var n=l.indexOf(e[t]);ce.select("#spline-path-"+n).attr("stroke",u.edgeStroke).each(function(){this.parentNode.appendChild(this)})}}(e)});var h=de.behavior("draw-spline-paths",{laterDraw:!0,add_behavior:function(e,t,n,r){var o,a;null===s&&(s=h.parent().select("g.draw").selectAll("g.spline-layer").data([0])).enter().append("g").attr("class","spline-layer"),a=y,null!==(o=l)?(s.selectAll(".spline-edge").data(o).enter().append("svg:path").attr("class","spline-edge").attr("id",function(e,t){return"spline-path-"+t}).attr("d",function(e){return g(e,a.lineTension)}).attr("stroke",a.edgeStroke||"black").attr("stroke-width",a.edgeStrokeWidth||1).attr("opacity",a.edgeOpacity||1).attr("fill","none"),s.selectAll(".spline-edge-hover").data(o).enter().append("svg:path").attr("class","spline-edge-hover").attr("d",function(e){return g(e)}).attr("opacity",0).attr("stroke","green").attr("stroke-width",u.edgeStrokeWidth||5).attr("fill","none").on("mouseover",function(e,t){c.hover_changed([o[t]])}).on("mouseout",function(e,t){c.hover_changed(null)}).on("click",function(e,t){c.select_changed([o[t]])})):d=h.parent().layoutEngine().savePositions()},remove_behavior:function(e,t,n,r){return this},parent:function(e){e&&(t=e.anchorName()),c.on("paths_changed.spline-"+t,e?n:null)}});return h},de.expand_collapse=function(c,r,o,l){if(2<(l=l||["both"]).length)throw new Error("there are only two directions to expand in");function s(t,e,n,r){var o;switch(n){case"out":o=function(e){return t.edgeSource.eval(e)===r};break;case"in":o=function(e){return t.edgeTarget.eval(e)===r};break;case"both":o=function(e){return t.edgeSource.eval(e)===r||t.edgeTarget.eval(e)===r}}return e.filter(o).size()}function d(u,e,t){var n=e.selectAll("g.spikes").data(function(e){return!e.dcg_expand_selected||e.dcg_expanded&&e.dcg_expanded[e.dcg_expand_selected.dir]?[]:[e]});n.exit().remove(),n.enter().insert("g",":first-child").classed("spikes",!0);var r=n.selectAll("rect.spike").data(function(e){u.nodeKey.eval(e);for(var t=e.dcg_expand_selected.dir,n=e.dcg_expand_selected.n,r=function(e,t,n){if("both"===t)return function(e){return Math.PI*(2*e/n-.5)};var r,o=(n-1)*Math.PI/n;switch(e){case"LR":r=0;break;case"TB":r=Math.PI/2;break;case"RL":r=Math.PI;break;case"BT":r=-Math.PI/2}return"in"===t&&(r+=Math.PI),function(e){return r+o*((1<n?e/(n-1):0)-.5)}}(u.layoutEngine().rankdir(),t,n),o=Array(n),a=0;a<n;++a){var i=r(a);o[a]={a:180*i/Math.PI,x:Math.cos(i)*e.dcg_rx*.9,y:Math.sin(i)*e.dcg_ry*.9}}return o});r.enter().append("rect").classed("spike",!0).attr({width:25,height:3,fill:"url(#spike-gradient)",rx:1,ry:1,x:0,y:0}),r.attr("transform",function(e){return"translate("+e.x+","+e.y+") rotate("+e.a+")"}),r.exit().remove()}function f(e,t,n){t.each(function(e){e.dcg_expand_selected=null}),d(e,t)}function g(e,t,n,r){if(1===n.length)return n[0];var o=e.root().node().getBoundingClientRect(),a=e.invertCoord([t.clientX-o.left,t.clientY-o.top]),i=a[0],u=a[1];switch(e.layoutEngine().rankdir()){case"TB":return u>r.cola.y?"out":"in";case"BT":return u<r.cola.y?"out":"in";case"LR":return i>r.cola.x?"out":"in";case"RL":return i<r.cola.x?"out":"in"}throw new Error("unknown rankdir "+e.layoutEngine().rankdir())}return de.behavior("expand-collapse",{add_behavior:function(a,i,u){function e(n){var r=g(a,ce.event,l,n),o=a.nodeKey.eval(n);Promise.resolve(c(o,r)).then(function(e){var t={dir:r,n:Math.max(0,e-s(a,u,r,o))};i.each(function(e){e.dcg_expand_selected=e===n?t:null}),d(a,i)})}function t(t){var n=ce.event;function e(){var e=g(a,n,l,t);t.dcg_expanded=t.dcg_expanded||{},t.dcg_expanded[e]?(o(a.nodeKey.eval(t),function(e,t,n,r){return 1===s(e,t,r,n)}.bind(null,a,u,e),e),t.dcg_expanded[e]=!1):(r(a.nodeKey.eval(t),e,"dblclick"===n.type),t.dcg_expanded[e]=!0),d(a,i),t.dcg_dblclk_timeout=null}return console.log(n.type),e()}i.on("mouseover.expand-collapse",e).on("mousemove.expand-collapse",e).on("mouseout.expand-collapse",function(e){f(a,i)}).on("click",t).on("dblclick",t)},first:function(e){var t=e.addOrRemoveDef("spike-gradient",!0,"linearGradient");t.attr({x1:"0%",y1:"0%",x2:"100%",y2:"0%",spreadMethod:"pad"}),t.selectAll("stop").data([[0,"black",1],[100,"black","0"]]).enter().append("stop").attr({offset:function(e){return e[0]+"%"},"stop-color":function(e){return e[1]},"stop-opacity":function(e){return e[2]}})},remove_behavior:function(e,t,n){t.on("mouseover.expand-collapse",null).on("mouseout.expand-collapse",null),f(e,t)}})},de.draw_graphs=function(e){var i=de.select_things_group(e.select_nodes_group||"select-nodes-group","select-nodes"),u=de.select_things_group(e.select_edges_group||"select-edges-group","select-edges"),c=(de.label_things_group("label-nodes-group","label-nodes"),de.label_things_group("label-edges-group","label-edges"),de.fix_nodes_group("fix-nodes-group")),a=e.idTag||"id",l=e.edgeIdTag||a,s=e.sourceTag||"source",d=e.targetTag||"target",f=e.labelTag||"label",g=e.edgeLabelTag||f,h=null,p=null,y=null,v=[];function m(){var e=v.filter(function(e){return e.source&&e.target}),t=y.selectAll("line.hint-edge").data(e);t.exit().remove(),t.enter().append("line").attr("class","hint-edge").style({fill:"none",stroke:"black","pointer-events":"none"}),t.attr({x1:function(e){return e.source.x},y1:function(e){return e.source.y},x2:function(e){return e.target.x},y2:function(e){return e.target.y}})}function x(){v=[],h=p=null,m()}function _(t,e,n){if(!b.nodeCrossfilter())throw new Error("need nodeCrossfilter");var r,o=b.addNode()||k;n?r=n:((r={})[a]=w(),r[f]=""),e&&c.new_node(r[a],r,{x:e[0],y:e[1]}),o(r).then(function(e){e&&(b.nodeCrossfilter().add([e]),t.redrawGroup(),i.set_changed([e[a]]))})}var b=de.behavior("highlight-paths",{add_behavior:function(o,e,t,n){var r=o.child("select-nodes");r&&b.clickCreatesNodes()&&r.clickBackgroundClears(!1),e.on("mousedown.draw-graphs",function(e){if(ce.event.stopPropagation(),b.dragCreatesEdges()){if(b.usePorts()){var t;if(!(t="object"==typeof b.usePorts()&&b.usePorts().eventPort?b.usePorts().eventPort():o.getPort(o.nodeKey.eval(e),null,"out")||o.getPort(o.nodeKey.eval(e),null,"in")))return;h={node:e,port:t},v=[{source:{x:e.cola.x+t.pos.x,y:e.cola.y+t.pos.y}}]}else v=[{source:{x:(h={node:e}).node.cola.x,y:h.node.cola.y}}];b.conduct().startDragEdge&&(b.conduct().startDragEdge(h)||x())}}).on("mousemove.draw-graphs",function(e){if(ce.event.stopPropagation(),h){var t=p;if(e===h.node)p=null,v[0].target=null;else if(b.usePorts()){var n;n="object"==typeof b.usePorts()&&b.usePorts().eventPort?b.usePorts().eventPort():o.getPort(o.nodeKey.eval(e),null,"in")||o.getPort(o.nodeKey.eval(e),null,"out"),p=n?{node:e,port:n}:null}else p&&e===p.node||(p={node:e});if(b.conduct().changeDragTarget)(b.usePorts()?(t&&t.port)!==(p&&p.port):(t&&t.node)!==(p&&p.node))&&!b.conduct().changeDragTarget(h,p)&&(p=null);if(p)p.port?v[0].target={x:e.cola.x+n.pos.x,y:e.cola.y+n.pos.y}:v[0].target={x:e.cola.x,y:e.cola.y};else{var r=de.event_coords(o);v[0].target={x:r[0],y:r[1]}}m()}}).on("mouseup.draw-graphs",function(e){if(h&&p){var t;t=b.conduct().finishDragEdge?b.conduct().finishDragEdge(h,p):Promise.resolve(!0);var n=h,r=p;t.then(function(e){e&&function(t,e,n){if(!b.edgeCrossfilter())throw new Error("need edgeCrossfilter");var r,o={},a=b.addEdge()||k;o[l]=w(),o[g]="",b.conduct().detectReversedEdge&&b.conduct().detectReversedEdge(o,e.port,n.port)?(o[s]=n.node.orig.key,o[d]=e.node.orig.key,r=e,e=n,n=r):(o[s]=e.node.orig.key,o[d]=n.node.orig.key),a(o,e.port,n.port).then(function(e){e&&(c.new_edge(o[l],e[s],e[d]),b.edgeCrossfilter().add([e]),i.set_changed([],!1),u.set_changed([e[l]],!1),t.redrawGroup())})}(o,n,r)})}else h&&b.conduct().cancelDragEdge&&b.conduct().cancelDragEdge(h);x()}),o.svg().on("mousedown.draw-graphs",function(){h=null}).on("mousemove.draw-graphs",function(){if(h){var e=de.event_coords(o);b.conduct().dragCanvas&&b.conduct().dragCanvas(h,e),b.conduct().changeDragTarget&&p&&b.conduct().changeDragTarget(h,null),p=null,v[0].target={x:e[0],y:e[1]},m()}}).on("mouseup.draw-graphs",function(){h?(b.conduct().cancelDragEdge&&b.conduct().cancelDragEdge(h),x()):ce.event.target===this&&b.clickCreatesNodes()&&_(o,de.event_coords(o))}),y||(y=o.g().append("g").attr("class","draw-graphs"))},remove_behavior:function(e,t,n,r){t.on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null),e.svg().on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null)}});return b.nodeCrossfilter=he(e.nodeCrossfilter),b.edgeCrossfilter=he(e.edgeCrossfilter),b.usePorts=he(null),b.clickCreatesNodes=he(!0),b.dragCreatesEdges=he(!0),b.conduct=he({}),b.addNode=he(null),b.addEdge=he(null),b.createNode=function(e,t){_(b.parent(),e,t)},b},de.match_ports=function(n,a){var u,c,i;function l(e,t){return e.map(function(e){return e.state=t,n.portNodeKey.eval(e)})}function r(e){var t=l(i,"small");e.port.state="small",t.push(n.portNodeKey.eval(e.port)),a.animateNodes(t)}function s(t,n){return(e.allowParallel()||!c.some(function(e){return 0<=t.edges.indexOf(e)&&0<=n.edges.indexOf(e)}))&&e.isValid()(t,n)}n.on("data.match-ports",function(e,t,n,r,o,a,i){a,u=i,c=o});var e={isValid:he(function(e,t){return t!==e&&t.name===e.name}),allowParallel:he(!1),hoverPort:function(e){if(e){if((i=u.filter(s.bind(null,e))).length)return l(i,"shimmer-medium")}else if(i)return l(i,"small");return null},startDragEdge:function(e){var t=l(i=u.filter(s.bind(null,e.port)),"shimmer");return i.length&&(a.enableHover(!1),e.port.state="large",t.push(n.portNodeKey.eval(e.port)),a.animateNodes(t)),console.log("valid targets",t),0!==i.length},changeDragTarget:function(e,t){var n,r,o=t&&s(e.port,t.port);return o?(n=l(i,"small"),t.port.state="large"):(n=l(i,"small"),r=a.animateNodes(n),n=l(i,"shimmer")),a.animateNodes(n,r),o},finishDragEdge:function(e,t){return a.enableHover(!0),r(e),Promise.resolve(s(e.port,t.port))},cancelDragEdge:function(e){return a.enableHover(!0),r(e),!0}};return e},de.match_opposites=function(a,e,i){var u,c,l;function s(e){return{x:e.node.cola.x+e.pos.x,y:e.node.cola.y+e.pos.y}}function r(t,n){return(d.allowParallel()||!c.some(function(e){return 0<=t.edges.indexOf(e)&&0<=n.edges.indexOf(e)}))&&d.isValid()(t,n)}function o(e,t){t.forEach(function(e){e.edges.forEach(function(e){e.deleting=0})}),e&&e.port.edges.forEach(function(e){e.deleting=0})}i=Object.assign({multiplier:2,ease:ce.ease("cubic")},i),a.cascade(100,!0,f(function(e){return i.ease(e.deleting||0)},e,t)),a.on("data.match-opposites",function(e,t,n,r,o,a,i){a,u=i,c=o});var d={isValid:he(function(e,t){return"in"===a.portName.eval(e)^"in"===a.portName.eval(t)}),allowParallel:he(!1),hoverPort:function(e){},startDragEdge:function(e){return l=u.filter(r.bind(null,e.port)),console.log("valid targets",l.map(a.portNodeKey.eval)),0!==l.length},dragCanvas:function(e,n){var t=l.map(function(e){var t=s(e);return{distance:Math.hypot(n[0]-t.x,n[1]-t.y),port:e}}).sort(function(e,t){return e.distance-t.distance}),r=s(t[0].port),o=s(e.port);t.forEach(function(t){t.port.edges.forEach(function(e){e.deleting=1-i.multiplier*t.distance/Math.hypot(r.x-o.x,r.y-o.y)})}),e.port.edges.forEach(function(e){e.deleting=1-i.multiplier*t[0].distance/Math.hypot(r.x-o.x,r.y-o.y)}),a.refresh()},changeDragTarget:function(e,t){var n=t&&r(e.port,t.port);return n&&(t.port.edges.forEach(function(e){e.deleting=1}),e.port.edges.forEach(function(e){e.deleting=1}),o(null,l.filter(function(e){return e!==t.port})),a.refresh()),n},finishDragEdge:function(e,t){if(r(e.port,t.port)){if(o(null,l.filter(function(e){return e!==t.port})),i.delete_edges){var n=e.port.edges.map(a.edgeKey.eval).concat(t.port.edges.map(a.edgeKey.eval));return i.delete_edges.deleteSelection(n)}return Promise.resolve(!0)}return o(e,l),Promise.resolve(!1)},cancelDragEdge:function(e){return o(e,l),!0},detectReversedEdge:function(e,t,n){return"in"===a.portName.eval(t)}};return d},de.wildcard_ports=function(e){var a=e.diagram,r=e.get_type||function(e){return e.orig.value.type},c=e.set_type||function(e,t){e.orig.value.type=t.orig.value.type},i=e.get_name||function(e){return e.orig.value.name},l=e.is_wild||function(e){return e.orig.value.wild},s=e.update_ports||function(){},u=e.get_linked||function(){return[]};function d(e,t){if(!a)return[];var n=a.nodeKey.eval(e),r=i(t),o=(u(e)||[]).find(function(e){return e.includes(r)});return o?o.filter(function(e){return e!==r}).map(function(e){return a.getPort(n,null,e)}):[]}function f(e){return e.every(function(e){return 0===e.edges.length})}return{isValid:function(e,t){return null===r(e)^null===r(t)||null!==r(e)&&r(e)===r(t)},copyLinked:function(e,t){d(e,t).forEach(function(e){c(e,t)})},copyType:function(e,t,n){return null===r(t)?(c(t,n),this.copyLinked(t.node,t),s()):null===r(n)&&(c(n,t),this.copyLinked(n.node,n),s()),Promise.resolve(e)},resetTypes:function(e){var u=a;return 2===arguments.length&&(u=e,e=arguments[1]),e.forEach(function(e){var t=u.getWholeEdge(e),n=u.edgeSourcePortName.eval(t),r=u.edgeTargetPortName.eval(t),o=!1,a=u.getPort(u.nodeKey.eval(t.source),null,n),i=d(t.source,a);l(a)&&1===a.edges.length&&f(i)&&(c(a,null),i.forEach(function(e){c(e,null),o=!0})),a=u.getPort(u.nodeKey.eval(t.target),null,r),i=d(t.target,a),l(a)&&1===a.edges.length&&f(i)&&(c(a,null),i.forEach(function(e){c(e,null),o=!0})),o&&s()}),Promise.resolve(e)}}},de.symbol_port_style=function(){var s,d,o,f={};function g(e){return e.named?e.name:f.parent().edgeKey.eval(e.edges[0])}function h(e){var t=f.color.eval(e);return t?f.colorScale()?f.colorScale()(t):t:"none"}function p(e){var t=Math.hypot(e.pos.x,e.pos.y),n=e.pos.x/t,r=e.pos.y/t,o=f.displacement.eval(e);return"translate("+(e.pos.x+o*n)+","+(e.pos.y+o*r)+")"}function y(e){f.symbolScale()||f.symbolScale(ce.scale.ordinal().range(ce.shuffle(f.content().enum())));var t=f.symbol.eval(e);return t&&(f.symbolScale()?f.symbolScale()(t):t)}function v(e){return e.vec[0]<0}function m(e){switch(e.state){case"large":return f.largeRadius.eval(e);case"medium":return f.mediumRadius.eval(e);case"small":default:return f.smallRadius.eval(e)}}function x(e){return/-medium$/.test(e.state)?f.mediumRadius.eval(e):f.largeRadius.eval(e)}function _(e){var t,n;return f.outlineFill.eval(e)?(t=f.outlineFillScale()||ge,n=f.outlineFill.eval(e)):(t=f.parent().nodeFillScale()||ge,n=f.parent().nodeFill.eval(e.node)),"none"===n?"none":t(n)}function b(e){return f.outlineStroke.eval(e)||f.parent().nodeStroke.eval(e.node)}function w(e){var t=f.outlineStrokeWidth.eval(e);return"number"==typeof t?t:f.parent().nodeStrokeWidth.eval(e.node)}return f.symbolScale=he(null),f.colorScale=he(ce.scale.ordinal().range(ce.shuffle(["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]))),f.symbol=f.portSymbol=he(g,!1),f.color=f.portColor=he(g,!1),f.outline=he(de.symbol_port_style.outline.circle()),f.content=he(de.symbol_port_style.content.d3symbol()),f.smallRadius=f.portRadius=he(7),f.mediumRadius=f.portHoverNodeRadius=he(10),f.largeRadius=f.portHoverPortRadius=he(14),f.displacement=f.portDisplacement=he(2),f.outlineFillScale=f.portBackgroundScale=he(null),f.outlineFill=f.portBackgroundFill=he(null),f.outlineStroke=f.portBackgroundStroke=he(null),f.outlineStrokeWidth=f.portBackgroundStrokeWidth=he(null),f.padding=f.portPadding=he(2),f.label=f.portLabel=f.portText=he(function(e){return e.name}),f.portLabelPadding=he({x:5,y:5}),f.cascade=me(f),f.animateNodes=function(e,t){var n=ce.set(e),r=d.filter(function(e){return n.has(f.parent().nodeKey.eval(e))}),o=f.parent().selectNodePortsOfStyle(r,f.parent().portStyle.nameOf(this)),a=o.filter(function(e){return/^shimmer/.test(e.state)}),i=o.filter(function(e){return!/^shimmer/.test(e.state)});function u(){var e=a.transition().duration(1e3).ease("bounce");e.selectAll(".port-outline").call(f.outline().draw(function(e){return x(e)+f.portPadding.eval(e)})),e.selectAll(".port-symbol").call(f.content().draw(y,x));var t=e.transition().duration(1e3).ease("sin");t.selectAll(".port-outline").call(f.outline().draw(function(e){return f.smallRadius.eval(e)+f.portPadding.eval(e)})),t.selectAll(".port-symbol").call(f.content().draw(y,f.smallRadius.eval)),t.each("end",u)}a.size()&&(t?t.each("end",u):u());var c=i.transition().duration(250);function l(e){return"large"===e.state||"medium"===e.state}return c.selectAll(".port-outline").call(f.outline().draw(function(e){return m(e)+f.portPadding.eval(e)})),c.selectAll(".port-symbol").call(f.content().draw(y,m)),c.selectAll("text.port-label").attr({opacity:function(e){return l(e)?1:0},"pointer-events":function(e){return l(e)?"auto":"none"}}),c.selectAll("rect.port-label-background").attr("opacity",function(e){return l(e)?1:0}),d.filter(function(e){var t=s[f.parent().nodeKey.eval(e)];return t&&t.some(l)}).each(function(){this.parentNode.appendChild(this)}),o.filter(function(e){return"small"!==e.state}).each(function(){this.parentNode.appendChild(this)}),c},f.eventPort=function(){var e=ce.select(ce.event.target.parentNode);return"g"===ce.event.target.parentNode.tagName&&e.classed("port")?e.datum():null},f.drawPorts=function(e,t,n){s=t,d=n;var r=e.data(function(e){return t[f.parent().nodeKey.eval(e)]||[]},g);r.exit().remove();var o=r.enter().append("g").attr({class:"port",transform:p});r.transition("port-position").duration(f.parent().stagedDuration()).delay(f.parent().stagedDelay(!1)).attr({transform:p});var a=r.selectAll(".port-outline").data(function(e){return"none"!==_(e)?[e]:[]});a.exit().remove();var i=a.enter().append(f.outline().tag()).attr({class:"port-outline",fill:_,"stroke-width":w,stroke:b});f.outline().init&&i.call(f.outline().init),i.call(f.outline().draw(function(e){return f.smallRadius.eval(e)+f.portPadding.eval(e)})),a.attr({fill:_,"stroke-width":w,stroke:b}),a.transition().duration(f.parent().stagedDuration()).delay(f.parent().stagedDelay(!1)).call(f.outline().draw(function(e){return f.smallRadius.eval(e)+f.portPadding.eval(e)}));o.append(f.content().tag()).attr("class","port-symbol").call(f.content().draw(y,f.smallRadius.eval));var u=r.select(".port-symbol");u.attr("fill",h),u.transition().duration(f.parent().stagedDuration()).delay(f.parent().stagedDelay(!1)).call(f.content().draw(y,f.smallRadius.eval));var c=r.selectAll("text.port-label").data(function(e){return f.portLabel.eval(e)?[e]:[]});c.exit().remove();var l=c.enter();return l.append("rect").attr({class:"port-label-background","pointer-events":"none"}),l.append("text").attr({class:"port-label","dominant-baseline":"middle","pointer-events":"none",cursor:"default",opacity:0}),c.each(function(e){e.offset=(v(e)?-1:1)*(f.largeRadius.eval(e)+f.portPadding.eval(e))}).attr({"text-anchor":function(e){return v(e)?"end":"start"},transform:function(e){return"translate("+e.offset+",0)"}}).text(f.portLabel.eval).each(function(e){e.bbox=ve(this)}),r.selectAll("rect.port-label-background").attr({x:function(e){return(e.offset<0?e.offset-e.bbox.width:e.offset)-f.portLabelPadding.eval(e).x},y:function(e){return-e.bbox.height/2-f.portLabelPadding.eval(e).y},width:function(e){return e.bbox.width+2*f.portLabelPadding.eval(e).x},height:function(e){return e.bbox.height+2*f.portLabelPadding.eval(e).y},fill:"white",opacity:0}),f.enableHover(!0),f},f.enableHover=function(e){if(!o&&f.parent()){var t=f.parent().child("draw-graphs");t&&(o=t.conduct())}var n="grow-ports-"+f.parent().portStyle.nameOf(this);return e?(d.on("mouseover."+n,function(e){var t=f.parent().nodeKey.eval(e),n=f.eventPort();s[t]&&s[t].forEach(function(e){e.state=e===n?"large":n?"small":"medium"});var r=o&&o.hoverPort(n)||[];r.push(t),f.animateNodes(r)}),d.on("mouseout."+n,function(e){var t=f.parent().nodeKey.eval(e);s[t]&&s[t].forEach(function(e){e.state="small"});var n=o&&o.hoverPort(null)||[];n.push(t),f.animateNodes(n)})):(d.on("mouseover."+n,null),d.on("mouseout."+n,null)),f},f.parent=he(null),f},de.symbol_port_style.outline={},de.symbol_port_style.outline.circle=function(){return{tag:function(){return"circle"},draw:function(t){return function(e){e.attr("r",function(e){return t(e)})}}}},de.symbol_port_style.outline.square=function(){return{tag:function(){return"rect"},init:function(e){},draw:function(t){return function(e){e.attr({x:function(e){return-t(e)},y:function(e){return-t(e)},width:function(e){return 2*t(e)},height:function(e){return 2*t(e)}})}}}},de.symbol_port_style.outline.arrow=function(){var r=.75-Math.PI/8,o={tag:function(){return"path"},init:function(e){},draw:function(n){return function(e){e.attr("d",function(e){var t=n(e);return!o.outie()||o.outie()(e.orig)?"M"+-r*t+","+-t+" h"+t+" l"+t+","+t+" l"+-t+","+t+" h"+-t+" a"+t+","+t+" 0 1,1 0,"+-2*t:"M"+-(2-r)*t+","+-t+" h"+2*t+" a"+t+","+t+" 0 1,1 0,"+2*t+" h"+-2*t+" l"+t+","+-t+" l"+-t+","+-t})}},outie:he(null)};return o},de.symbol_port_style.content={},de.symbol_port_style.content.d3symbol=function(){return{tag:function(){return"path"},enum:function(){return ce.svg.symbolTypes},draw:function(r,o){return function(e){e.attr("d",function(e){var t=r(e),n=o(e);return ce.svg.symbol().type(t).size(n*n)()}),e.attr("transform",function(e){switch(r(e)){case"triangle-up":return"translate(0, -1)";case"triangle-down":return"translate(0, 1)";default:return null}})}}}},de.symbol_port_style.content.letter=function(){return{tag:function(){return"text"},enum:function(){return ce.range(65,91).map(String.fromCharCode)},draw:function(t,n){return function(e){e.text(t).attr({"dominant-baseline":"middle","text-anchor":"middle"}),e.each(function(e){e.symbol_size||(e.symbol_size=ve(this))}),e.attr("transform",function(e){return"scale("+2*n(e)/e.symbol_size.height+") translate("+[0,2].join(",")+")"})}}}},de.load_graph=function(){function e(e){return e?e.replace(/\?.*/,""):null}var t,n,r;if(t=arguments[0],3===arguments.length)n=arguments[1],r=arguments[2];else{if(2!==arguments.length)throw new Error("need two or three arguments");r=arguments[1]}n?queue().defer(ce.json,t).defer(ce.json,n).await(function(e,t,n){e?r(e,null):r(null,{nodes:t.results,edges:n.results})}):/\.json$/.test(e(t))?ce.json(t,r):/\.gv|\.dot$/.test(e(t))?ce.text(t,function(e,t,n){if(t)e(t,null);else{var r,o;if(graphlibDot.parse){var a=graphlibDot.parse(n),i=a.nodes();r=new Array(i.length),i.forEach(function(e,t){var n=r[t]=a._nodes[i[t]];n.id=t,n.name=e});var u=a.edges();o=[],u.forEach(function(e){var t=a._edges[e];o.push({source:a._nodes[t.u].id,target:a._nodes[t.v].id,sourcename:t.u,targetname:t.v})})}else a=graphlibDot.read(n),i=a.nodes(),r=new Array(i.length),i.forEach(function(e,t){var n=r[t]=a._nodes[i[t]];n.id=t,n.name=e}),o=[],a.edges().forEach(function(e){o.push({source:a._nodes[e.v].id,target:a._nodes[e.w].id,sourcename:e.v,targetname:e.w})});e(null,{nodes:r,links:o})}}.bind(null,r)):/\.psv$/.test(e(t))?ce.dsv("|","text/plain")(t,p.bind(null,r)):/\.csv$/.test(e(t))&&ce.csv(t,p.bind(null,r))},de.munge_graph=function(t,e,n,r){var o,a,i=e||"name",u=n||"sourcename",c=r||"targetname";if(!E(t)){var l=["database","response"],s=l.findIndex(function(e){return t[e]&&E(t[e])});if(s<0)throw new Error("couldn't find the data!");t=t[l[s]]}function d(t,e){return e.filter(function(e){return!!t[e]})}a=t.edges||t.links,o=t.nodes||t.vertices;var f=a[0];if(void 0===f[u]){var g=n?[n]:["source_ecomp_uid","node1","source","tail"],h=r?[r]:["target_ecomp_uid","node2","target","head"],p=["edge"];if(f.node0&&f.node1)u="node0",c="node1";else{var y=d(f,g);if(!y.length){if((s=p.findIndex(function(e){return f[e]&&d(f[e],g).length}))<0)throw n?new Error("sourceattr "+u+" didn't work"):new Error("didn't find any source attr");a=a.map(function(e){return e[p[s]]}),y=d(f=a[0],g)}if(1<y.length&&console.warn("found more than one possible source attr",y),u=y[0],!(y=d(f,h)).length)throw r&&!f[r]?new Error("targetattr "+c+" didn't work"):new Error("didn't find any target attr");1<y.length&&console.warn("found more than one possible target attr",y),c=y[0]}}var v=o[0];if(void 0===v[i]){var m=e?[e]:["ecomp_uid","id","_id"],x=["vertex"];if(!(y=d(v,m)).length){if((s=x.findIndex(function(e){return v[e]&&d(v[e],m).length}))<0)throw e?new Error("nodekeyattr "+i+" didn't work"):new Error("couldn't find the node data");o=o.map(function(e){return e[x[s]]}),y=d(v=o[0],m)}1<y.length&&console.warn("found more than one possible node key attr",y),i=y[0]}return{nodes:o,edges:a,nodekeyattr:i,sourceattr:u,targetattr:c}},de.flat_group=function(){var o=function(e,t){return t},a=function(){return null},i=function(){return null};function n(e,t){var n,r=e.dimension(t);return{crossfilter:e,dimension:r,group:(n=r.group().reduce(o,a,i),{all:function(){return n.all().filter(function(e){return null!==e.value})}})}}return{make:function(e,t){return n(le(e),t)},another:function(e,t){return n(e,t)}}}();var y=function(e,i,u,c,l,s){if(l=l||0,i.length>(u.valuesByAttr?1:0)){var d=i.shift(),f=[],g=[],t=e.map(function(e){var t,n=e[u.nestKey],r=u.nestKeysUnique?n:w();if(r&&(u.ancestorKeys?(s=s||{},d&&(s[d]=n),t=Object.assign({},s)):t={},t[u.nodeKey]=r,u.label&&u.labelFun&&(t[u.label]=u.labelFun(n,d,e)),u.level&&(t[u.level]=l+1),f.push(t),c)){var o={};o[u.edgeSource]=c,o[u.edgeTarget]=r,g.push(o)}var a=u.valuesByAttr?e[i[0]]:e.values;return y(a,i.slice(0),u,r,l+1,Object.assign({},s))});return{nodes:Array.prototype.concat.apply(f,t.map(se.pluck("nodes"))),edges:Array.prototype.concat.apply(g,t.map(se.pluck("edges")))}}return{nodes:e.map(function(e){return e=Object.assign({},e),u.level&&(e[u.level]=l+1),e}),edges:e.map(function(e){var t={};return t[u.edgeSource]=c,t[u.edgeTarget]=e[u.nodeKey],t})}};return de.convert_tree=function(e,t,n){return n=Object.assign({nodeKey:"key",edgeKey:"key",edgeSource:"sourcename",edgeTarget:"targetname",nestKey:"key"},n),Array.isArray(e)?y(e,t,n,n.root,0,n.inherit):(t=[""].concat(t),y([e],t,n,n.root,0,n.inherit))},de.convert_nest=function(e,t,n,r,o,a,i){return de.convert_tree(e,t,{nodeKey:n,edgeSource:r,edgeTarget:o,root:a,inherit:i,ancestorKeys:!0,label:"name",labelFun:function(e,t,n){return t+":"+e},level:"_level"})},de.convert_adjacency_list=function(e,r,o){var t=Array.prototype.concat.apply([],e.map(function(n){return n[r.adjacencies].map(function(e){var t={};return o.edgeKey&&(t[o.edgeKey]=w()),t[o.edgeSource]=n[r.nodeKey],t[o.edgeTarget]=r.targetKey?e[r.targetKey]:e,o.adjacency&&(t[o.adjacency]=e),t})}));return{nodes:e,edges:t}},de.path_reader=function(e){var a,i,u,c=de.register_highlight_paths_group(e||"highlight-paths-group");function l(r,o,a){s.elementList.eval(r).forEach(function(e){var t,n;switch(s.elementType.eval(e)){case"node":t=s.nodeKey.eval(e),n=o[t]=o[t]||[];break;case"edge":t=s.edgeSource.eval(e)+"-"+s.edgeTarget.eval(e),n=a[t]=a[t]||[]}n.push(r)})}var s={pathList:he(ge,!1),timeRange:he(null,!1),elementList:he(ge,!1),elementType:he(null,!1),nodeKey:he(null,!1),edgeSource:he(null,!1),edgeTarget:he(null,!1),clear:function(){c.paths_changed({},{},[])},data:function(e){var t,n={},r={},o=[];s.pathList.eval(e).forEach(function(e){if(e._range=s.timeRange.eval(e)){if(!1===t)throw new Error("can't have a mix of ranged and non-ranged paths");t=!0}else{if(!0===t)throw new Error("can't have a mix of ranged and non-ranged paths");t=!1,l(e,n,r)}o.push(e)}),t?(a=o.map(function(e){var t=[e._range[0].getTime(),e._range[1].getTime()];return t.path=e,t}),i=lysenkoIntervalTree(a),u&&this.setTime(u)):(i=a=null,c.paths_changed(n,r,o))},getIntervals:function(){return a},setTime:function(e){if(e&&i){var t=[],n={},r={};i.queryPoint(e.getTime(),function(e){t.push(e.path),l(e.path,n,r)}),c.paths_changed(n,r,t)}u=e}};return s},de.path_selector=function(e,r,t,n){var o=de.register_highlight_paths_group(t||"highlight-paths-group"),a=ce.select(e),i=[],u=null,c=null;function l(t){return function(e){return!!t&&0<=t.indexOf(e)}}function s(e){var t=l(e);return function(e){return!t(e)}}function d(e){var t=a.selectAll("span.path-selector").data(e);t.enter().append("span").attr("class","path-selector").style({"border-width":"1px","border-style":"solid","border-color":"grey","border-radius":"4px",display:"inline-block",padding:"4px",cursor:"pointer",margin:"5px"}),t.exit().transition(1e3).attr("opacity",0).remove(),t.text(function(e,t){return"path "+(t+1)+" ("+r.elementList.eval(e).length+")"}).on("mouseover",function(e){o.hover_changed([e])}).on("mouseout",function(e){o.hover_changed(null)}).on("click",function(e){var t,n;o.select_changed((n=[e],(t=c)?n?n.every(l(t))?t.filter(s(n)):t.concat(n.filter(s(t))):t:n))});var n=a.selectAll("span.no-paths").data(0===e.length?[0]:[]);n.exit().remove(),n.enter().append("span").attr("class","no-paths"),n.classed("error",!!h.error_text()).text(h.error_text()||(h.queried()?h.zero_text():h.default_text()))}function f(){var n=l(u);a.selectAll("span.path-selector").style({"border-color":function(e,t){return n(e)?"#e41a1c":"grey"},"border-width":function(e,t){return(n(e)?2:1)+"px"},padding:function(e,t){return(n(e)?3:4)+"px"}})}function g(){var n=l(c);a.selectAll("span.path-selector").style({"background-color":function(e,t){return n(e)?"#1c1ae6":"white"},color:function(e,t){return n(e)?"white":"black"}})}o.on("paths_changed.selector",function(e,t,n){u=c=null,i=n,h.redraw()}).on("hover_changed.selector",function(e){u=e,f()}).on("select_changed.selector",function(e){c=e,g()});var h={default_text:he("Nothing here"),zero_text:he("No paths"),error_text:he(null),queried:he(!1),redraw:function(){d(i),f(),g()},render:function(){return this.redraw(),this}};return se.registerChart(h,n),h},de.node_name=function(e){if(e<26)return String.fromCharCode(97+e);if(e<52)return String.fromCharCode(65+e-26);if(e<2704)return de.node_name(Math.floor(e/52))+de.node_name(e%52);throw new Error("no, that's too large")},de.node_object=function(e,t){return t=t||{},_.extend({id:e,name:de.node_name(e)},t)},de.edge_object=function(e,t,n,r){return r=r||{},_.extend({source:t,target:n,sourcename:e(t),targetname:e(n)},r)},de.generate=function(e,t,n,r){var o,a,i,u,c=n.nodePrefix||"",l=function(e){return o[e].name},s=t[0],d=n.linkLength||30;switch(e){case"clique":case"cliquestf":for(o=new Array(s),a=[],i=0;i<s;++i)for(o[i]=de.node_object(i,{circle:"A",name:c+de.node_name(i)}),u=0;u<i;++u)a.push(de.edge_object(l,i,u,{notLayout:!0,undirected:!0}));if("cliquestf"===e)for(i=0;i<s;++i)o[i+s]=de.node_object(i+s),o[i+2*s]=de.node_object(i+2*s),a.push(de.edge_object(l,i,i+s,{undirected:!0})),a.push(de.edge_object(l,i,i+2*s,{undirected:!0}));break;case"wheel":for(o=new Array(s),i=0;i<s;++i)o[i]=de.node_object(i,{name:c+de.node_name(i)});var f=(a=de.wheel_edges(l,_.range(s),s*d/2))[0].distance;for(i=0;i<t[1];++i)for(u=0;u<s;++u){var g,h=u,p=(u+1)%s;i%2==1&&(g=h,h=p,p=g),a.push(de.edge_object(l,h,p,{distance:f,par:i+2}))}break;default:throw new Error("unknown generation type "+e)}r(null,{nodes:o,links:a})},de.wheel_edges=function(e,t,n){for(var r=t.length,o=[],a=Math.floor(r/2),i=2*n*Math.sin(Math.PI/r),u=2*n*Math.sin(a*Math.PI/r),c=0;c<r;++c)o.push(de.edge_object(e,t[c],t[(c+1)%r],{distance:i}));for(c=0;c<r/2;++c)o.push(de.edge_object(e,t[c],t[(c+a)%r],{distance:u})),r%2&&c!=Math.floor(r/2)&&o.push(de.edge_object(e,t[c],t[(c+r-a)%r],{distance:u}));return o},de.random_graph=function(a){a=Object.assign({ncolors:5,ndashes:4,nodeKey:"key",edgeKey:"key",sourceKey:"sourcename",targetKey:"targetname",colorTag:"color",dashTag:"dash",nodeKeyGen:function(e){return"n"+e},edgeKeyGen:function(e){return"e"+e},newComponentProb:.1,newNodeProb:.9,removeEdgeProb:.75,log:!1},a),isNaN(a.newNodeProb)&&(a.newNodeProb=.9),a.newNodProb<=0&&(a.newNodeProb=.1);var i=[],u=[];function c(){var e={};return e[a.nodeKey]=a.nodeKeyGen(i.length),e[a.colorTag]=Math.floor(Math.random()*a.ncolors),i.push(e),e}function l(){return i[Math.floor(Math.random()*i.length)]}return{nodes:function(){return i},edges:function(){return u},generate:function(e){for(;0<e--;){var t,n,r=Math.random();if(t=!i.length||r<a.newComponentProb?c():l(),n=r<a.newNodeProb?c():l(),t&&n){var o={};o[a.edgeKey]=a.edgeKeyGen(u.length),o[a.sourceKey]=t[a.nodeKey],o[a.targetKey]=n[a.nodeKey],o[a.dashTag]=Math.floor(Math.random()*a.ndashes),a.log&&console.log(t[a.nodeKey]+" -> "+n[a.nodeKey]),u.push(o)}}},remove:function(e){for(;0<e--;){if(Math.random()<a.removeEdgeProb)u.splice(Math.floor(Math.random()*u.length),1);else{var n=i[Math.floor(Math.random()*i.length)],r=[];u.forEach(function(e,t){e[a.sourceKey]!==n[a.nodeKey]&&e[a.targetKey]!==n[a.nodeKey]||r.push(t)}),r.reverse().forEach(function(e){u.splice(e,1)})}}}}},de.line_breaks=function(e,u){var c=new RegExp(e,"g");return function(e){for(var t,n,r=e.key,o="",a=[],i=0;n=(t=c.exec(r))?r.slice(i,c.lastIndex):r.slice(i),o.length+n.length>u&&0<o.length&&(a.push(o),o=""),o+=n,i=c.lastIndex,null!==t;);return a.push(o),a}},de.build_type_graph=function(e,t,n,i,u,c){var l={},r={},s={};return e.forEach(function(e){l[n(e)]=e;var t=i(e);r[t]||(r[t]={type:t})}),t.forEach(function(e){var t,n,r=u(e),o=c(e);if(!(t=l[r]))throw new Error("source key "+r+" not found!");if(!(n=l[o]))throw new Error("target key "+o+" not found!");var a=i(t)+"/"+i(n);s[a]||(s[a]={type:a,source:i(t),target:i(n)})}),{nodes:Object.keys(r).map(function(e){return r[e]}),edges:Object.keys(s).map(function(e){return s[e]})}},de.d3=ce,de.crossfilter=le,de.dc=se,de}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],e);else if("object"==typeof module&&module.exports){var t=require("d3"),n=require("crossfilter");"function"!=typeof n&&(n=n.crossfilter);var r=require("dc");module.exports=e(t,n,r)}else this.dc_graph=e(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map