/*!
 *  dc.graph 0.6.0-alpha.2
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015-2016 AT&T Intellectual Property & the dc.graph.js Developers
 *  https://github.com/dc-js/dc.graph.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 */

!function(){function a(a,b,c){"use strict";function d(a){return a.orig}function e(a){return a}function f(){var a={},b=function(b,c){return 1===arguments.length?a[b]:a[b]===c?this:(a[b]&&a[b].parent(null),a[b]=c,c&&c.parent(this),this)};return b.enum=function(){return Object.keys(a)},b}function g(a,b){var c=T(b),d=function(){return arguments.length?(console.warn(a),c.apply(T,arguments),this):c()};return["cascade","_eval","eval","react"].forEach(function(a){d[a]=c[a]}),d}function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function i(a,b){return function(c,d){return a(c)?b(c):d()}}function j(b,c){return function(d,e){return a.interpolate(e(d),c(d))(b(d))}}function k(a,b,c){var d={};for(var e in b)d[e]=c(a,p(b[e]));return d}function l(a,b){return k(a,b,i)}function m(a,b,c){var d={},e={},f=[];for(var g in c)/^node/.test(g)?d[g]=c[g]:/^edge/.test(g)?e[g]=c[g]:f.push(g);f.length&&console.error('only know how to deal with properties that start with "node" or "edge"',f);var h=a?l(a,d):{};return b&&Object.assign(h,l(b,e)),h}function n(a){return function(b,c,d){for(var e in d){if(!a[e])throw new Error("unknown attribute "+e);a[e].cascade(b,c?d[e]:null)}return a}}function o(a,b){return function(){return a(b.apply(null,arguments))}}function p(a){return S.functor_wrap(a,d)}function q(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function r(a,b,c){for(var d=["M",a[0].x,",",a[0].y],e=b,f=!1,g=1;g<a.length;++g)(isNaN(a[g].x)||isNaN(a[g].y))&&(f=!0),d.push(e===b?U[b]:" ",a[g].x,",",a[g].y),0===--e&&(e=b);return e!=b&&console.log("warning: pts.length didn't match bezian degree",a,b),c&&d.push("Z"),d.join("")}function s(a){return Promise.resolve(a)}function t(b,c){return!!a.select(b).classed(c)||b.parentElement&&t(b.parentElement,c)}function u(a,b,c,d,e,f,g){function h(b){var c=d(b);a[c]||f(c,a[c]={},b);var g=a[c];return e(g,b),i[c]=!0,g}f||(f=function(a,b){}),g||(g=function(a){});var i={},j=b.map(h);c&&c.forEach(function(b){a[b]||(f(b,a[b]={},null),e(a[b],null)),i[b]||(j.push(a[b]),i[b]=!0)});for(var k in a)i[k]||(g(k,a[k]),delete a[k]);return j}function v(a,b,c,d){var e=Math.tan(Math.atan2(d,c));e*=e;var f={x:a*b/Math.sqrt(b*b+a*a*e),y:a*b/Math.sqrt(a*a+b*b/e)};return c<0&&(f.x=-f.x),d<0&&(f.y=-f.y),f}function w(a,b,c){return a-X<=b&&b<=c+X}function x(a,b,c,d,e,f,g,h){var i=((a*d-b*c)*(e-g)-(a-c)*(e*h-f*g))/((a-c)*(f-h)-(b-d)*(e-g)),j=((a*d-b*c)*(f-h)-(b-d)*(e*h-f*g))/((a-c)*(f-h)-(b-d)*(e-g));if(isNaN(i)||isNaN(j))return!1;if(a>=c){if(!w(c,i,a))return!1}else if(!w(a,i,c))return!1;if(b>=d){if(!w(d,j,b))return!1}else if(!w(b,j,d))return!1;if(e>=g){if(!w(g,i,e))return!1}else if(!w(e,i,g))return!1;if(f>=h){if(!w(h,j,f))return!1}else if(!w(f,j,h))return!1;return{x:i,y:j}}function y(a,b,c,d,e){for(var f=0;f<a.length;++f){var g=f===a.length-1?0:f+1,h=x(a[f].x,a[f].y,a[g].x,a[g].y,b,c,d,e);if(h)return h}return null}function z(a,b){"string"==typeof b&&(b={shape:b});var c=b.shape,d=Object.assign({},b);if(delete d.shape,"random"===c){var e=S.available_shapes();c=e[Math.floor(Math.random()*e.length)]}else if(a.shape.enum().indexOf(c)!==-1)return a.shape(c).elaborate({shape:c},d);S.shape_presets[c]||(console.warn("unknown shape ",c),c="rectangle");var f=S.shape_presets[c].preset(d);return f.shape=S.shape_presets[c].generator,a.shape(f.shape).elaborate(f,d)}function A(a){return function(b){var c=a.nodeShape.eval(b)||Y;b.dcg_shape=z(a,c),b.dcg_shape.abstract=c}}function B(a){return function(b){var c=a.nodeShape.eval(b)||Y,d=b.dcg_shape.abstract;return c.shape!==d.shape||"polygon"===c.shape&&(c.shape.sides!==d.sides||c.shape.skew!==d.skew||c.shape.distortion!==d.distortion||c.shape.rotation!==d.rotation)}}function C(a,b){return function(c){c.each(function(c){var d=null;if((!a.useTextSize||a.useTextSize(c.dcg_shape))&&b.nodeFitLabel.eval(c)){d=this.getBBox(),d={x:d.x,y:d.y,width:d.width,height:d.height};var e,f=b.nodeContent.eval(c);if(f&&b.content(f).padding)e=b.content(f).padding(c);else{var g=b.nodeLabelPadding.eval(c);e={x:2*g.x,y:2*g.y}}d.width+=e.x,d.height+=e.y,c.bbox=d}var h,i=0;a.useRadius&&!a.useRadius(c.dcg_shape)||(i=b.nodeRadius.eval(c)),h=d&&d.width&&d.height||a.useTextSize&&!a.useTextSize(c.dcg_shape)?a.calc_radii(c,i,d):{rx:i,ry:i},c.dcg_rx=h.rx,c.dcg_ry=h.ry;var j=2*h.rx,k=2*h.ry;if(j<k&&(j=k),!a.usePaddingAndStroke||a.usePaddingAndStroke(c.dcg_shape)){var l=b.nodePadding.eval(c)+b.nodeStrokeWidth.eval(c);j+=l,k+=l}c.cola.width=j,c.cola.height=k})}}function D(a){return{rx:function(a){return a.dcg_rx},ry:function(a){return a.dcg_ry}}}function E(b,c){return{d:function(b){var c=b.dcg_rx,d=b.dcg_ry,e=b.dcg_shape,f=e.sides||4,g=e.skew||0,h=e.distortion||0,i=e.rotation||0,j=f%2?0:.5,k=[];i=i/360+.25;for(var l=0;l<f;++l){var m=-((l+j)/f+i)*Math.PI*2;k.push({x:Math.cos(m),y:Math.sin(m)})}var n=a.extent(k,function(a){return a.y});return e.regular?c=d=Math.max(c,d):c<d&&!e.squeeze?c=d:d/=Math.min(-n[0],n[1]),b.dcg_points=k.map(function(a){var b=c*a.x,e=d*a.y;return b*=1+h*((d-e)/d-1),b-=g*e/2,{x:b,y:e}}),r(b.dcg_points,1,!0)}}}function F(a,b,c){var d=100;if(a(b).val>=0)throw new Error("f(a) must be less than 0");if(a(c).val<=0)throw new Error("f(b) must be greater than 0");for(;;){if(!--d)throw new Error("patience ran out");var e=(b+c)/2,f=a(e),g=f.val;if(Math.abs(g)<.5)return f;g>0?c=e:b=e}}function G(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o;if(g){var p,q,r=function(b,c){return a.shape(b.dcg_shape.shape).intersect_vec(b,1e3*Math.cos(c),1e3*Math.sin(c))},s=function(a,b,c){return function(d){var e=r(a,d);return e?{port:e,val:Math.hypot(e.x-b.x,e.y-b.y)-c,ang:d}:{port:{x:0,y:0},val:0,ang:d}}},t=Math.atan2(g.sourcePort.y,g.sourcePort.x),u=Math.atan2(g.targetPort.y,g.targetPort.x);try{p=F(s(b.source,g.sourcePort,i),t,t+2*h*i/j)}catch(a){p={ang:t,port:g.sourcePort}}try{q=F(s(b.target,g.targetPort,i),u,u-2*h*i/j)}catch(a){q={ang:u,port:g.targetPort}}l=p.port,m=q.port;var v=Math.hypot(l.x,l.y),w=Math.hypot(m.x,m.y),x=v+j/2,y=w+k/2,z=c+x*Math.cos(p.ang),A=d+x*Math.sin(p.ang),B=e+y*Math.cos(q.ang),C=f+y*Math.sin(q.ang);n=[{x:c+l.x,y:d+l.y},{x:z,y:A},{x:B,y:C},{x:e+m.x,y:f+m.y}],o=3}else l=b.sourcePort.pos,m=b.targetPort.pos,console.assert(l),console.assert(m),n=[{x:c+l.x,y:d+l.y},{x:e+m.x,y:f+m.y}],o=1;return{sourcePort:l,targetPort:m,points:n,bezDegree:o}}function H(a,b){for(var c=[],d=1;d<a.length;d++){var e=a[d-1],f=a[d];c.push({x:e.x+(f.x-e.x)*b,y:e.y+(f.y-e.y)*b})}return c}function I(a,b){for(var c=[a],d=1;d<a.length;d++)c.push(H(c[c.length-1],b));return c}function J(a,b){var c=I(a,b);return c[c.length-1][0]}function K(a){if(!Z[a]){var b=Z[a]={worker:new Worker(V()+"dc.graph."+a+".worker.js"),layouts:{}};b.worker.onmessage=function(a){var c=a.data.layoutId;if(!b.layouts[c])throw new Error('layoutId "'+c+'" unknown!');b.layouts[c].dispatch()[a.data.response].apply(null,a.data.args)}}return Z[a]}function L(a,b,c){return a||b?(a&&(a=a.replace(/\//g,"%2F")),b&&(b=b.replace(/\//g,"%2F")),(a?"node/"+a:"edge/"+b)+"/"+c):null}function M(a){var b=a.split("/");return console.assert(3===b.length),b=b.map(function(a){return a.replace(/%2F/g,"/")}),"node"===b[0]?{nodeKey:b[1],name:b[2]}:{edgeKey:b[1],name:b[2]}}function N(a,b,c){if(!c.vec)throw console.assert(!c.edges.length),new Error("port has not been placed, maybe install place_ports? "+c.name);c.pos=a.shape(b.dcg_shape.shape).intersect_vec(b,1e3*c.vec[0],1e3*c.vec[1])}function O(a){var b=function(){return{type:"alignment",axis:a}};return b.listname="offsets",b.wrap=function(a){return{node:a,offset:0}},b}function P(a,b,c){if(b)return void a(b,null);var d,e;if(graphlibDot.parse){var f=graphlibDot.parse(c),g=f.nodes();d=new Array(g.length),g.forEach(function(a,b){var c=d[b]=f._nodes[g[b]];c.id=b,c.name=a});var h=f.edges();e=[],h.forEach(function(a){var b=f._edges[a];e.push({source:f._nodes[b.u].id,target:f._nodes[b.v].id,sourcename:b.u,targetname:b.v})})}else f=graphlibDot.read(c),g=f.nodes(),d=new Array(g.length),g.forEach(function(a,b){var c=d[b]=f._nodes[g[b]];c.id=b,c.name=a}),e=[],f.edges().forEach(function(a){e.push({source:f._nodes[a.v].id,target:f._nodes[a.w].id,sourcename:a.v,targetname:a.w})});var i={nodes:d,links:e};a(null,i)}function Q(b,c,d){if(c)return void b(c,null);var e=Object.keys(d[0]),f=e[0],g=e[1],h=a.set(d.map(function(a){return a[f]}));d.forEach(function(a){h.add(a[g])}),h=h.values().map(function(a){return{name:a}}),b(null,{nodes:h,links:d.map(function(a,b){return{key:b,sourcename:a[f],targetname:a[g]}})})}function R(a){return(a.nodes||a.vertices)&&(a.edges||a.links)}var S={version:"0.6.0-alpha.2",constants:{CHART_CLASS:"dc-graph"}},T=function(a,b){void 0===b?b=d:b===!1&&(b=e);var c=a,f=null,g=[],h=function(a){return arguments.length?(f&&f(a),c=a,this):c};return h.cascade=function(a,b){for(var c=0;c<g.length;++c){if(g[c].n===a)return b?g[c].f=b:delete g[c],h;if(g[c].n>a)return g.splice(c,0,{n:a,f:b}),h}return g.push({n:a,f:b}),h},h._eval=function(a,c){if(0!==c&&g.length){var d=g[c-1];return d.f(a,function(){return h._eval(a,c-1)})}return S.functor_wrap(h(),b)(a)},h.eval=function(a){return h._eval(a,g.length)},h.react=function(a){return arguments.length?(f=a,this):f},h};"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(a,b){if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(null!=e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(c[f]=e[f])}return c},writable:!0,configurable:!0}),S.functor_wrap=function(a,b){return"function"==typeof a?b?function(c){return a(b(c))}:a:function(){return a}};var U={1:"L",2:"Q",3:"C"};Math.hypot=Math.hypot||function(){for(var a=0,b=arguments.length,c=0;c<b;c++){if(arguments[c]===1/0||arguments[c]===-(1/0))return 1/0;a+=arguments[c]*arguments[c]}return Math.sqrt(a)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a){if(null==this)throw new TypeError('"this" is null or not defined');var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var d=arguments[1],e=0;e<c;){var f=b[e];if(a.call(d,f,e,b))return f;e++}}});var V=function(){var a;return function(){if(void 0===a){a=null;var b="dc.graph.js",c=document.getElementsByTagName("script");if(c&&c.length>0)for(var d in c)if(c[d].src&&c[d].src.match(new RegExp(b+"$"))){a=c[d].src.replace(new RegExp("(.*)"+b+"$"),"$1");break}}return a}}();S.event_coords=function(b){var c=b.root().node().getBoundingClientRect();return b.invertCoord([a.event.clientX-c.left,a.event.clientY-c.top])};var W=navigator.platform.toUpperCase().indexOf("MAC")!==-1;S.depth_first_traversal=function(a){return function(b,c){function d(b,c){var e=a.nodeid(b);return j[e]?void(a.skip&&a.skip(b,f[e])):(i[c]||(i[c]=[]),a.place&&a.place(b,c,i[c]),i[c].push(b),j[e]=!0,g[e]&&g[e].forEach(function(b,f){var i=h[a.targetid(b)];f&&a.sib&&a.sib(!1,h[a.targetid(g[e][f-1])],i),a.push&&a.push(),d(i,c+1)}),void(a.pop&&a.pop(b)))}a.init&&a.init(),a.tree&&(c=c.filter(function(b){return a.tree(b)}));var e,f={},g=c.reduce(function(b,c){var d=a.sourceid(c),e=a.targetid(c);return b[d]||(b[d]=[]),b[d].push(c),f[e]=(f[e]||0)+1,b},{}),h=b.reduce(function(b,c){var d=a.nodeid(c);return b[d]=c,b},{}),i=[],j={};a.root?e=b.filter(function(b){return a.root(b)}):(e=b.filter(function(b){return!f[a.nodeid(b)]}),b.length&&!e.length&&(e=[b[0]])),e.forEach(function(b,c){c&&a.sib&&a.sib(!0,e[c-1],b),a.push&&a.push(),d(b,a.row&&a.row(b)||0)}),a.finish(i)}},S.undirected_dfs=function(a){return function(b,c){function d(b){var c=a.nodeid(b);a.node(h,b),g[c]=!0,e[c]&&e[c].forEach(function(a){g[a]||d(f[a])})}var e=c.reduce(function(b,c){var d=a.sourceid(c),e=a.targetid(c);return b[d]||(b[d]=[]),b[e]||(b[e]=[]),b[d].push(e),b[e].push(d),b},{}),f=b.reduce(function(b,c){var d=a.nodeid(c);return b[d]=c,b},{}),g={},h=0;b.forEach(function(b){g[a.nodeid(b)]||(a.comp&&a.comp(h),d(b),++h)})}};var X=1e-7;S.shape_presets={egg:{generator:"polygon",preset:function(){return{sides:100,distortion:-.25}}},triangle:{generator:"polygon",preset:function(){return{sides:3}}},rectangle:{generator:"polygon",preset:function(){return{sides:4}}},diamond:{generator:"polygon",preset:function(){return{sides:4,rotation:45}}},trapezium:{generator:"polygon",preset:function(){return{sides:4,distortion:-.5}}},parallelogram:{generator:"polygon",preset:function(){return{sides:4,skew:.5}}},pentagon:{generator:"polygon",preset:function(){return{sides:5}}},hexagon:{generator:"polygon",preset:function(){return{sides:6}}},septagon:{generator:"polygon",preset:function(){return{sides:7}}},octagon:{generator:"polygon",preset:function(){return{sides:8}}},invtriangle:{generator:"polygon",preset:function(){return{sides:3,rotation:180}}},invtrapezium:{generator:"polygon",preset:function(){return{sides:4,distortion:.5}}},square:{generator:"polygon",preset:function(){return{sides:4,regular:!0}}},plain:{generator:"rounded-rect",preset:function(){return{noshape:!0}}}},S.available_shapes=function(){var a=Object.keys(dc_graph_shapes_);return a.slice(0,a.length-1)};var Y={shape:"ellipse"};S.no_shape=function(){var a={parent:T(null),elaborate:function(a,b){return Object.assign(a,b)},useTextSize:function(){return!1},useRadius:function(){return!1},usePaddingAndStroke:function(){return!1},intersect_vec:function(a,b,c){return{x:0,y:0}},calc_radii:function(a,b,c){return{rx:0,ry:0}},create:function(a){},replace:function(a){},update:function(a){}};return a},S.ellipse_shape=function(){var a={parent:T(null),elaborate:function(a,b){return Object.assign(a,b)},intersect_vec:function(a,b,c){return v(a.dcg_rx,a.dcg_ry,b,c)},calc_radii:function(a,b,c){b=Math.max(b,c.height/2+5);var d=c.width/2,e=c.height/2/b;return d/=Math.sqrt(1-e*e),d=Math.max(d,b),{rx:d,ry:b}},create:function(a){a.append("ellipse").attr("class","node-shape")},replace:function(a){a.select("ellipse.node-shape").remove(),a.insert("ellipse",":first-child").attr("class","node-shape")},update:function(b){b.select("ellipse.node-shape").attr(D(a.parent()))}};return a},S.polygon_shape=function(){var a={parent:T(null),elaborate:function(a,b){return Object.assign(a,b)},intersect_vec:function(a,b,c){return y(a.dcg_points,0,0,b,c)},calc_radii:function(a,b,c){b=Math.max(b,c.height/2+5);var d=c.width/2;return d=d*Math.sqrt(2)/Math.cos(Math.PI/(a.dcg_shape.sides||4)),{rx:d,ry:b}},create:function(a){a.append("path").attr("class","node-shape")},replace:function(a){a.select("path.node-shape").remove(),a.insert("path",":first-child").attr("class","node-shape")},update:function(b){b.select("path.node-shape").attr(E(a.parent()))}};return a},S.rounded_rectangle_shape=function(){var a={parent:T(null),elaborate:function(a,b){return a=Object.assign({rx:10,ry:10},a),Object.assign(a,b)},intersect_vec:function(a,b,c){var d=[{x:a.dcg_rx,y:a.dcg_ry},{x:a.dcg_rx,y:-a.dcg_ry},{x:-a.dcg_rx,y:-a.dcg_ry},{x:-a.dcg_rx,y:a.dcg_ry}];return y(d,0,0,b,c)},useRadius:function(a){return!a.noshape},calc_radii:function(a,b,c){var d=c.height/2;return a.dcg_shape.noshape||(d+=5),{rx:c.width/2,ry:Math.max(b,d)}},create:function(a){a.filter(function(a){return!a.dcg_shape.noshape}).append("rect").attr("class","node-shape")},replace:function(a){a.select("rect.node-shape").remove(),a.filter(function(a){return!a.dcg_shape.noshape}).insert("rect",":first-child").attr("class","node-shape")},update:function(a){a.select("rect.node-shape").attr({x:function(a){return-a.dcg_rx},y:function(a){return-a.dcg_ry},width:function(a){return 2*a.dcg_rx},height:function(a){return 2*a.dcg_ry},rx:function(a){return a.dcg_shape.rx+"px"},ry:function(a){return a.dcg_shape.ry+"px"}})}};return a},S.text_contents=function(){var a={parent:T(null),update:function(b){var c=b.selectAll("text.node-label").data(function(a){return[a]});c.enter().append("text").attr("class","node-label");var d=c.selectAll("tspan").data(function(b){var c=a.parent().nodeLabel.eval(b);if(!c)return[];"string"==typeof c&&(c=[c]);var d=c.length%2?.3-(c.length-1)/2:1-c.length/2;return c.map(function(a,c){return{node:b,line:a,yofs:(0==c?d:1)+"em"}})});d.enter().append("tspan"),d.attr({"text-anchor":"start",x:0}).text(function(a){return a.line}),c.each(function(a){a.xofs=0}).filter(function(b){return"center"!==a.parent().nodeLabelAlignment.eval(b)}).each(function(b){var c=this.getBBox();switch(b.bbox={x:c.x,y:c.y,width:c.width,height:c.height},a.parent().nodeLabelAlignment.eval(b)){case"left":b.xofs=-b.bbox.width/2;break;case"right":b.xofs=b.bbox.width/2}}).selectAll("tspan"),d.attr({"text-anchor":function(b){switch(a.parent().nodeLabelAlignment.eval(b.node)){case"left":return"start";case"center":return"middle";case"right":return"end"}return null},x:function(a){return a.node.xofs},dy:function(a){return a.yofs}}),d.exit().remove(),c.attr("fill",a.parent().nodeLabelFill.eval)},textbox:function(a){var b=this.select(a).node().getBBox();return{x:b.x,y:b.y,width:b.width,height:b.height}},select:function(a){return a.select("text.node-label")}};return a},S.with_icon_contents=function(b,c,d){var e={parent:T(null).react(function(a){b.parent(a)}),padding:function(a){var b=e.parent().nodeLabelPadding.eval(a);return{x:3*b.x,y:3*b.y}},update:function(f){var g=f.selectAll("g.with-icon").data(function(a){return[a]}),h=g.enter();h.append("g").attr("class","with-icon").append("image").attr({class:"icon",width:c+"px",height:d+"px"}),g.call(b.update),b.select(g).attr("transform","translate("+c/2+")"),g.selectAll("image.icon").attr({href:e.parent().nodeIcon.eval,x:function(d){var f=c+b.textbox(a.select(this.parentNode)).width;return-f/2-e.parent().nodeLabelPadding.eval(d).x},y:-d/2})},textbox:function(a){var d=b.textbox(a);return d.x+=c/2,d},select:function(a){return a.select("g.with-icon")}};return e},S.diagram=function(h,i){function j(a){return function(b){ka.layoutEngine()||ka.layoutAlgorithm("cola",!0);var c=ka.layoutEngine();if(c.getEngine&&(c=c.getEngine()),c[a]){if(console.warn("property is deprecated, call on layout engine instead: dc_graph.diagram.%c"+a,"font-weight: bold"),!arguments.length)return c[a]();c[a](b)}else if(console.warn("property is deprecated, and is not supported for Warning: dc_graph.diagram.<b>"+a+'</b> is deprecated, and it is not supported for the "'+c.layoutAlgorithm()+'" layout algorithm: ignored.'),!arguments.length)return null;return this}}function k(){ka.layoutEngine()||ka.layoutAlgorithm("cola",!0),ka.layoutEngine().init({width:ka.width(),height:ka.height()})}function l(a){return!!a.source&&!!a.target}function m(a){var b=Math.hypot(a[0],a[1]);return[a[0]/b,a[1]/b]}function q(a,b){var c=b.target.cola.y-b.source.cola.y,d=b.target.cola.x-b.source.cola.x;return b.source!==a&&(c=-c,d=-d),b.parallel&&b.parallel.edges.length>1&&b.source.index>b.target.index&&(c=-c,d=-d),m([d,c])}function s(b,c){la={},c.forEach(function(a){var b=ka.nodeKey.eval(a.node),c=la[b]=la[b]||[];c.push(a)});for(var d in la){var e=b[d],f=la[d];f.forEach(function(b){if(ka.portElastic.eval(b)&&b.edges.length){var c=b.edges.map(q.bind(null,e));b.vec=[a.sum(c,function(a){return a[0]})/c.length,a.sum(c,function(a){return a[1]})/c.length]}else b.vec=b.vec||void 0;b.pos=null})}}function t(a,b,c){for(var d in la){var e=a[d];la[d].forEach(function(a){a.pos||N(ka,e,a)})}b.forEach(function(a){var b=ka.edgeSourcePortName.eval(a);a.sourcePort.pos=b?c[L(ka.nodeKey.eval(a.source),null,b)].pos:c[L(null,ka.edgeKey.eval(a),"source")].pos,b=ka.edgeTargetPortName.eval(a),a.targetPort.pos=b?c[L(ka.nodeKey.eval(a.target),null,b)].pos:c[L(null,ka.edgeKey.eval(a),"target")].pos})}function v(b,c){c.attr("stroke",ka.edgeStroke.eval).attr("stroke-width",ka.edgeStrokeWidth.eval).attr("stroke-dasharray",ka.edgeStrokeDashArray.eval).attr("marker-end",function(a){var b=ka.edgeArrowhead.eval(a),c=Z(a,"head",b);return c?"url(#"+c+")":null}).attr("marker-start",function(a){var b=ka.edgeArrowtail.eval(a),c=Z(a,"tail",b);return b?"url(#"+c+")":null}).each(function(b){a.selectAll("#"+ka.arrowId(b,"head")+",#"+ka.arrowId(b,"tail")).attr("fill",ka.edgeStroke.eval(b))}),ka._updateNode(b),X(b)}function w(a){ya.end(a),Ea=!1,Na&&(Na=!1,window.setTimeout(function(){ka.isRunning()||ka.redraw()},0))}function x(a,b){var c=a[0],d=a[a.length-1],e=J(a,"tail"===b?.25:.75);return("head"===b?Math.atan2(d.y-e.y,d.x-e.x):Math.atan2(c.y-e.y,c.x-e.x))+"rad"}function y(a,b,c){var d=a.points,e=d[0],f=d[d.length-1];switch(ka.enforceEdgeDirection()){case"LR":if(b.x>=c.x){var g=e.x-f.x;return{points:[e,{x:e.x+g,y:e.y-g/2},{x:f.x-g,y:f.y-g/2},f],bezDegree:3,sourcePort:a.sourcePort,targetPort:a.targetPort}}break;case"TB":if(b.y>=c.y){var h=e.y-f.y;return{points:[e,{x:e.x+h/2,y:e.y+h},{x:f.x+h/2,y:f.y-h},f],bezDegree:3,sourcePort:a.sourcePort,targetPort:a.targetPort}}}return a}function z(a,b,c,d,e,f){if(a.cola.points)a.pos.new=a.pos.old={path:{points:a.cola.points,bezDegree:3},orienthead:x(a.cola.points,"head"),orienttail:x(a.cola.points,"tail")};else if(!a.pos[b]){var g=a.parallel,h=a.source,i=a.target;if(g.edges.length>1&&a.source.index>a.target.index){var j;j=i,i=h,h=j,j=e,e=c,c=j,j=f,f=d,d=j}for(var k=h.dcg_ry+ka.nodeStrokeWidth.eval(h)/2,l=i.dcg_ry+ka.nodeStrokeWidth.eval(i)/2,m=0;m<g.edges.length;++m){var n=!!(m%2)==c<e?-1:1,o=Math.floor((m+1)/2),p=o>0?g.edges[m>2?m-2:0].pos[b].path:null,q=G(ka,a,c,d,e,f,p,n,ka.parallelEdgeOffset(),k,l);g.edges.length>1&&g.rev[m]&&q.points.reverse(),ka.enforceEdgeDirection()&&(q=y(q,h.cola,i.cola)),g.edges[m].pos[b]={path:q,orienthead:x(q.points,"head"),orienttail:x(q.points,"tail")}}}return a.pos[b].path}function D(a){z(a,"old",a.source.prevX||a.source.cola.x,a.source.prevY||a.source.cola.y,a.target.prevX||a.target.cola.x,a.target.prevY||a.target.cola.y)}function E(a){var b=z(a,"new",a.source.cola.x,a.source.cola.y,a.target.cola.x,a.target.cola.y),c=b.points[0],d=b.points[b.points.length-1];a.length=Math.hypot(d.x-c.x,d.y-c.y)}function F(a){return function(b){var c=b.pos[a].path;return r(c.points,c.bezDegree)}}function H(a){return function(b){var c=b.pos[a].path,d=c.points[c.points.length-1].x<c.points[0].x?c.points.slice(0).reverse():c.points;return r(d,c.bezDegree)}}function I(a,b){a.every(function(a){return 0===a.size()})&&b();var c=0;a.forEach(function(a){a.each(function(){++c}).each("end.all",function(){--c||b()})})}function K(a){return{left:a.cola.x-a.dcg_rx,top:a.cola.y-a.dcg_ry,right:a.cola.x+a.dcg_rx,bottom:a.cola.y+a.dcg_ry}}function O(a,b){return{left:Math.min(a.left,b.left),top:Math.min(a.top,b.top),right:Math.max(a.right,b.right),bottom:Math.max(a.bottom,b.bottom)}}function P(a){return{left:a.x,top:a.y,right:a.x,bottom:a.y}}function Q(a){var b=a.pos.new.path.points;return b.map(P).reduce(O)}function R(a){var b=va.selectAll("rect.bounds").data([0]);b.enter().insert("rect",":first-child").attr({class:"bounds",fill:"rgba(128,255,128,0.1)",stroke:"#000"}),b.attr({x:a.left,y:a.top,width:a.right-a.left,height:a.bottom-a.top})}function U(a,b){(ka.fitStrategy()||ka.restrictPan())&&a.size()&&(Oa=a.data().map(K).reduce(O),Oa=b.data().map(Q).reduce(O,Oa))}function V(){if(ka.fitStrategy()){if(!Oa)return;var a=Oa.right-Oa.left,b=Oa.bottom-Oa.top,c=ka.width(),d=ka.height();ka.DEBUG_BOUNDS&&R(Oa);var e=ka.fitStrategy(),f=[0,0],g=1;if(["default","vertical","horizontal"].indexOf(e)>=0){var h=d/c,i=b/a,j=i<h,k="default"===e?!j:"vertical"===e;g=k?(d-ka.margins().top-ka.margins().bottom)/b:(c-ka.margins().left-ka.margins().right)/a,g=Math.max(ka.zoomExtent()[0],Math.min(ka.zoomExtent()[1],g)),f=[ka.margins().left-Oa.left*g+(c-a*g)/2,ka.margins().top-Oa.top*g+(d-b*g)/2]}else if("string"==typeof e&&e.match(/^align_/)){var l=e.split("_")[1].toLowerCase().split("");if(l.length>2)throw new Error("align_ expecting 0-2 sides, not "+l.length);var m=_();f=oa.translate(),g=oa.scale(),l.forEach(function(a){switch(a){case"l":f[0]=aa(f,m.left);break;case"t":f[1]=ba(f,m.top);break;case"r":f[0]=ca(f,m.right);break;case"b":f[1]=da(f,m.bottom);break;default:throw new Error("align_ expecting l t r or b, not '"+a+"'")}})}else{if("zoom"!==e)throw new Error("unknown fitStrategy type "+typeof e);f=ea(oa.translate())}oa.translate(f).scale(g).event(ta),$(f,g,!0),ya.zoomed(f,g)}}function W(b,c,d,e,f,g,h,i,j,k,m){console.assert(d.data().every(l));var n={};c.each(function(a){n[ka.nodeKey.eval(a)]=!0}).attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"});var o=b.transition().duration(ka.stagedDuration()).delay(function(a){return ka.stagedDelay(n[ka.nodeKey.eval(a)])}).attr("opacity",ka.nodeOpacity.eval);m&&o.attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"}).each("end.record",function(a){a.prevX=a.cola.x,a.prevY=a.cola.y}),d.each(function(a){a.pos.new=null,a.pos.old=null});var p={};e.each(function(a){p[ka.edgeKey.eval(a)]=!0}).each(function(b){var c;"modins"===ka.stageTransitions()?(E(b),c="new"):(D(b),c="old"),ka.edgeArrowhead.eval(b)&&a.select("#"+ka.arrowId(b,"head")).attr("orient",function(){return b.pos[c].orienthead}),ka.edgeArrowtail.eval(b)&&a.select("#"+ka.arrowId(b,"tail")).attr("orient",function(){return b.pos[c].orienttail})}).attr("d",F("modins"===ka.stageTransitions()?"new":"old"));var q=d.each(E).each(function(b){ka.edgeArrowhead.eval(b)&&a.select("#"+ka.arrowId(b,"head")).transition().duration(ka.stagedDuration()).delay(ka.stagedDelay(!1)).attr("orient",function(){return b.pos.new.orienthead}),ka.edgeArrowtail.eval(b)&&a.select("#"+ka.arrowId(b,"tail")).transition().duration(ka.stagedDuration()).delay(ka.stagedDelay(!1)).attr("orient",function(){return b.pos.new.orienttail})}).transition().duration(ka.stagedDuration()).delay(function(a){return ka.stagedDelay(p[ka.edgeKey.eval(a)])}).attr("opacity",ka.edgeOpacity.eval);m&&q.attr("d",function(a){var b="insmod"===ka.stageTransitions()&&p[ka.edgeKey.eval(a)]?"old":"new";return F(b)(a)}),h.selectAll("textPath").text(function(a){return ka.edgeLabel.eval(a)}),k.attr("d",H("modins"===ka.stageTransitions()?"new":"old"));var r=j.transition().duration(ka.stagedDuration()).delay(function(a){return ka.stagedDelay(p[ka.edgeKey.eval(a)])}).attr("opacity",ka.edgeOpacity.eval);m&&r.attr("d",function(a){var b="insmod"===ka.stageTransitions()&&p[ka.edgeKey.eval(a)]?"old":"new";return H(b)(a)}),"insmod"===ka.stageTransitions()&&m&&(ka.stagedDuration()>=50?(q=q.transition().duration(ka.stagedDuration()).attr("d",F("new")),r=r.transition().duration(ka.stagedDuration()).attr("d",H("new"))):(q.attr("d",F("new")),r.attr("d",F("new")))),ka.showLayoutSteps()||I([o,q,r],function(){w(!0)}),m&&f.attr("d",F("new"))}function X(a){la&&ka.portStyle.enum().forEach(function(b){var c={};for(var d in la)c[d]=la[d].filter(function(a){return ka.portStyleName.eval(a)===b});ka.portStyle(b).drawPorts(c,a)})}function Z(a,b,c){var d=ka.arrowId(a,b),e=ka.addOrRemoveDef(d,!!c,"svg:marker");return c&&e.attr("viewBox","0 -5 10 10").attr("refX",Da[c].refX).attr("refY",Da[c].refY).attr("markerUnits","userSpaceOnUse").attr("markerWidth",Da[c].width*ka.edgeArrowSize.eval(a)).attr("markerHeight",Da[c].height*ka.edgeArrowSize.eval(a)).attr("stroke",ka.edgeStroke.eval(a)).attr("fill",ka.edgeStroke.eval(a)).call(Da[c].drawFunction),c?d:null}function $(a,b,c){Fa=a,Ga=b;var d=va;c&&(d=va.transition().duration(ka.zoomDuration())),d.attr("transform","translate("+a+") scale("+b+")")}function _(){var a=Oa||{left:0,top:0,right:0,bottom:0};return{left:a.left-ka.margins().left,top:a.top-ka.margins().top,right:a.right+ka.margins().right,bottom:a.bottom+ka.margins().bottom}}function aa(a,b){return a[0]-ka.x()(b)+ka.x().range()[0]}function ba(a,b){return a[1]-ka.y()(b)+ka.y().range()[0]}function ca(a,b){return a[0]-ka.x()(b)+ka.x().range()[1]}function da(a,b){return a[1]-ka.y()(b)+ka.y().range()[1]}function ea(a){var b,c=ka.x().domain(),d=ka.y().domain(),e=_(),f=e.left<c[0],g=e.right<c[1],h=e.right-e.left<c[1]-c[0],i=0;switch(f&&g?b=h?"left":"right":f||g||(b=h?"right":"left"),b){case"left":a[0]=aa(a,e.left);break;case"right":a[0]=ca(a,e.right);break;default:++i}switch(f=e.top<d[0],g=e.bottom<d[1],h=e.bottom-e.top<d[1]-d[0],f&&g?b=h?"top":"bottom":f||g||(b=h?"bottom":"top"),b){case"top":a[1]=ba(a,e.top);break;case"bottom":a[1]=da(a,e.bottom);break;default:++i}return a}function fa(){var b,c=a.event.scale;ka.restrictPan()?oa.translate(b=ea(a.event.translate)):b=a.event.translate,$(b,c,!1)}function ga(a,b){ta&&ta.attr("width",a||ka.width()).attr("height",b||ka.height())}function ha(){ta.call(oa),ta.on("dblclick.zoom",null)}function ia(){ta.on(".zoom",null)}function ja(){if(ta=ka.root().append("svg"),ga(),ua=ta.append("svg:defs"),ka.x()||ka.x(a.scale.linear().domain([0,ka.width()]).range([0,ka.width()])),ka.y()||ka.y(a.scale.linear().domain([0,ka.height()]).range([0,ka.height()])),oa=a.behavior.zoom().on("zoom",fa).x(ka.x()).y(ka.y()).scaleExtent(ka.zoomExtent()),ka.mouseZoomable()){var b,c,d=ka.child("brush");if(b=ka.modKeyZoom()){c=Array.isArray(b)?b.slice():"string"==typeof b?[b]:["Alt"];var e=0,f=!1,g=!1;ta.on("mousedown.modkey-zoom",function(){++e}).on("mouseup.modkey-zoom",function(){--e,e||f||!g||(g=!1,ia(),d&&d.activate())}),a.select(document).on("keydown.modkey-zoom",function(){c.indexOf(a.event.key)>-1&&(f=!0,e||(g=!0,ha(),d&&d.deactivate()))}).on("keyup.modkey-zoom",function(){c.indexOf(a.event.key)>-1&&(f=!1,e||(g=!1,ia(),d&&d.activate()))})}else ha()}return ta}var ka=c.marginMixin({});ka.__dcFlag__=c.utils.uniqueId();var la,ma,na,oa,pa,qa,ra,sa,ta=null,ua=null,va=null,wa=null,xa=null,ya=a.dispatch("preDraw","data","end","start","drawn","receivedLayout","transitionsStarted","zoomed"),za={},Aa={},Ba={},Ca={},Da={},Ea=!1,Fa=[0,0],Ga=1,Ha=200,Ia=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().width;return b&&b>Ha?b:Ha},Ja=Ia,Ka=200,La=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().height;return b&&b>Ka?b:Ka},Ma=La;ka.height=function(b){return arguments.length?(Ma=a.functor(b||La),sa=void 0,ka):(c.utils.isNumber(sa)||(sa=Ma(ka.root().node())),sa)},ka.minHeight=function(a){return arguments.length?(Ka=a,ka):Ka},ka.width=function(b){return arguments.length?(Ja=a.functor(b||Ia),ra=void 0,ka):(c.utils.isNumber(ra)||(ra=Ja(ka.root().node())),ra)},ka.minWidth=function(a){return arguments.length?(Ha=a,ka):Ha},ka.root=T(null).react(function(a){a.empty()&&console.log("Warning: parent selector "+h+" doesn't seem to exist")}),ka.mouseZoomable=T(!0),ka.zoomExtent=T([.1,2]),ka.modKeyZoom=ka.altKeyZoom=T(!1),ka.fitStrategy=T("default"),ka.restrictPan=T(!1),ka.autoZoom=T(null),ka.zoomToFit=function(){if(wa&&xa){var a=ka.selectAllNodes(),b=ka.selectAllEdges();V(a,b)}},ka.zoomDuration=T(500),ka.nodeDimension=T(),ka.nodeGroup=T(),ka.edgeDimension=T(),ka.edgeGroup=T(),ka.edgesInFront=T(!1),ka.nodeKey=ka.nodeKeyAccessor=T(function(a){return a.key}),ka.edgeKey=ka.edgeKeyAccessor=T(function(a){return a.key}),ka.edgeSource=ka.sourceAccessor=T(function(a){return a.value.sourcename}),ka.edgeTarget=ka.targetAccessor=T(function(a){return a.value.targetname}),ka.portDimension=T(null),ka.portGroup=T(null),ka.portNodeKey=T(null),ka.portEdgeKey=T(null),ka.portName=T(null),ka.portStyleName=T(null),ka.portElastic=T(!0),ka.portStyle=f(),ka.portBounds=T(null),ka.edgeSourcePortName=T(null),ka.edgeTargetPortName=T(null),ka.nodeRadius=ka.nodeRadiusAccessor=T(25),ka.nodeStrokeWidth=ka.nodeStrokeWidthAccessor=T(1),ka.nodeStroke=ka.nodeStrokeAccessor=T("black"),ka.nodeStrokeDashArray=T(null),ka.nodeFillScale=T(null),ka.nodeFill=ka.nodeFillAccessor=T("white"),ka.nodeOpacity=T(1),ka.nodePadding=T(6),ka.nodeLabelPadding=T({x:0,y:0}),ka.nodeLabel=ka.nodeLabelAccessor=T(function(a){return a.value.label||a.value.name}),ka.nodeLabelAlignment=T("center"),ka.nodeLabelFill=ka.nodeLabelFillAccessor=T(null),ka.nodeFitLabel=ka.nodeFitLabelAccessor=T(!0),ka.nodeShape=T(Y),ka.shape=f(),ka.shape("nothing",S.no_shape()),ka.shape("ellipse",S.ellipse_shape()),ka.shape("polygon",S.polygon_shape()),ka.shape("rounded-rect",S.rounded_rectangle_shape()),ka.nodeContent=T("text"),ka.content=f(),ka.content("text",S.text_contents()),ka.nodeIcon=T(null),ka.nodeTitle=ka.nodeTitleAccessor=T(function(a){
return ka.nodeKey()(a)}),ka.nodeOrdering=T(null),ka.nodeFixed=ka.nodeFixedAccessor=T(null),ka.edgeStroke=ka.edgeStrokeAccessor=T("black"),ka.edgeStrokeWidth=ka.edgeStrokeWidthAccessor=T(1),ka.edgeStrokeDashArray=T(null),ka.edgeOpacity=ka.edgeOpacityAccessor=T(1),ka.edgeLabel=ka.edgeLabelAccessor=T(function(a){return ka.edgeKey()(a)}),ka.edgeArrowhead=ka.edgeArrowheadAccessor=T("vee"),ka.edgeArrowtail=ka.edgeArrowtailAccessor=T(null),ka.edgeArrowSize=T(1),ka.edgeIsLayout=ka.edgeIsLayoutAccessor=T(function(a){return!a.value.notLayout}),ka.edgeIsShown=T(!0),ka.lengthStrategy=j("lengthStrategy"),ka.edgeLength=ka.edgeDistanceAccessor=T(function(a){return a.value.distance}),ka.flowLayout=j("flowLayout"),ka.rankdir=j("rankdir"),ka.baseLength=j("baseLength"),ka.transitionDuration=T(500),ka.stageTransitions=T("none"),ka.deleteDelay=T(0),ka.groupConnected=j("groupConnected"),ka.timeLimit=T(0),ka.constrain=T(function(a,b){return[]}),ka.parallelEdgeOffset=T(10),ka.edgeOrdering=T(null),ka.cascade=n(ka),ka.initLayoutOnRedraw=T(!1),ka.layoutUnchanged=T(!1),ka.relayout=function(){return ma=na=null,this},ka.initialLayout=g("initialLayout is deprecated - use layout algorithms instead",null),ka.initialOnly=g("initialOnly is deprecated - see the initialLayout deprecation notice in the documentation",!1),ka.induceNodes=T(!1),ka.showLayoutSteps=T(!1),ka.legend=T(null).react(function(a){a.parent(ka)}),ka.mode=ka.child=f(),ka.layoutAlgorithm=function(a,b){if(!arguments.length)return ka.layoutEngine()?ka.layoutEngine().layoutAlgorithm():"cola";b||console.warn("dc.graph.diagram.layoutAlgorithm is depecrated - pass the layout engine object to dc_graph.diagram.layoutEngine instead");var c;switch(a){case"cola":c=S.cola_layout();break;case"dagre":c=S.dagre_layout()}return c=S.webworker_layout(c),ka.layoutEngine(c),this},ka.layoutEngine=T(null).react(function(a){a&&a.parent&&a.parent(ka)}),ka.enforceEdgeDirection=T(null),ka.tickSize=j("tickSize"),ka.uniqueId=function(){return ka.anchorName().replace(/[ .#=\[\]"]/g,"-")},ka.edgeId=function(a){return"edge-"+ka.edgeKey.eval(a).replace(/[^\w-_]/g,"-")},ka.arrowId=function(a,b){return"arrow-"+b+"-"+ka.uniqueId()+"-"+ka.edgeId(a)},ka.textpathId=function(a){return"textpath-"+ka.uniqueId()+"-"+ka.edgeId(a)},ka.getNode=function(a){return za[a]?za[a].orig:null},ka.getWholeNode=function(a){return za[a]?za[a]:null},ka.getEdge=function(a){return Aa[a]?Aa[a].orig:null},ka.getWholeEdge=function(a){return Aa[a]?Aa[a]:null},ka.getPort=function(a,b,c){return Ba[L(a,b,c)]},ka.nodePorts=function(){return la},ka.handleDisconnected=j("handleDisconnected"),ka.forEachChild=function(a,b,c,d){b.enum().forEach(function(e){d(b(e),a.filter(function(a){return c(a)===e}))})},ka.forEachShape=function(a,b){ka.forEachChild(a,ka.shape,function(a){return a.dcg_shape.shape},b)},ka.forEachContent=function(a,b){ka.forEachChild(a,ka.content,ka.nodeContent.eval,b)},ka.renderNode=ka._enterNode=function(a){return ka.nodeTitle()&&a.append("title"),a.each(A(ka)),ka.forEachShape(a,function(a,b){b.call(a.create)}),ka},ka.redrawNode=ka._updateNode=function(a){var b=a.filter(B(ka));return b.each(A(ka)),ka.forEachShape(b,function(a,b){b.call(a.replace)}),a.select("title").text(ka.nodeTitle.eval),ka.forEachContent(a,function(a,b){b.call(a.update),ka.forEachShape(a.select(b),function(a,b){b.call(C(a,ka))})}),ka.forEachShape(a,function(a,b){b.call(a.update)}),a.select(".node-shape").attr({stroke:ka.nodeStroke.eval,"stroke-width":ka.nodeStrokeWidth.eval,"stroke-dasharray":ka.nodeStrokeDashArray.eval,fill:o(ka.nodeFillScale()||e,ka.nodeFill.eval)}),ka},ka.stagedDuration=function(){return"none"!==ka.stageTransitions()?ka.transitionDuration()/2:ka.transitionDuration()},ka.stagedDelay=function(a){return"none"===ka.stageTransitions()||"modins"===ka.stageTransitions()==!a?0:ka.transitionDuration()/2},ka.selectAllNodes=function(a){return a=a||".node",wa.selectAll(a).filter(function(a){return!a.deleted})},ka.selectAllEdges=function(a){return a=a||".edge",xa.selectAll(a).filter(function(a){return!a.deleted})},ka.selectAllDefs=function(a){return ua.selectAll(a).filter(function(a){return!a.deleted})},ka.isRunning=function(){return Ea};var Na=!1;ka.redraw=function(){return Ea?(Na=!0,this):ka.startLayout()},ka.startLayout=function(){function c(a,b){a.forEach(function(a){var b=za[a.dcg_nodeKey];return b?(b.cola.x=a.x,void(b.cola.y=a.y)):void console.warn('received node "'+a.dcg_nodeKey+'" that we did not send')}),b.forEach(function(a){var b=Aa[a.dcg_edgeKey];return b?void(a.points&&(b.cola.points=a.points)):void console.warn('received edge "'+a.dcg_edgeKey+'" that we did not send')})}var e=ka.nodeGroup().all(),f=ka.edgeGroup().all(),g=ka.portGroup()?ka.portGroup().all():[];if(Ea)throw new Error("dc_graph.diagram.redraw already running!");Ea=!0,ga(),ka.initLayoutOnRedraw()&&k(),ka.layoutEngine().stop(),ya.preDraw(),ka.nodeOrdering()&&(e=b.quicksort.by(ka.nodeOrdering())(e.slice(0),0,e.length)),ka.edgeOrdering()&&(f=b.quicksort.by(ka.edgeOrdering())(f.slice(0),0,f.length));var h=u(za,e,null,function(a){return ka.nodeKey()(a)},function(a,b){a.orig=b,a.cola=a.cola||{},a.cola.dcg_nodeKey=ka.nodeKey.eval(a),ka.layoutEngine().populateLayoutNode(a.cola,a)}),i=u(Aa,f,null,function(a){return ka.edgeKey()(a)},function(a,b){a.orig=b,a.cola=a.cola||{},a.cola.dcg_edgeKey=ka.edgeKey.eval(a),a.cola.dcg_edgeSource=ka.edgeSource.eval(a),a.cola.dcg_edgeTarget=ka.edgeTarget.eval(a),a.source=za[a.cola.dcg_edgeSource],a.target=za[a.cola.dcg_edgeTarget],a.cola.dcg_edgeLength=ka.edgeLength.eval(a),a.sourcePort=a.sourcePort||{},a.targetPort=a.targetPort||{},ka.layoutEngine().populateLayoutEdge(a.cola,a)});i=i.filter(l),i=i.filter(function(a){return a.source!==a.target}),i=i.filter(ka.edgeIsShown.eval);var j=i.map(function(a){return ka.edgeSourcePortName.eval(a)?L(ka.edgeSource.eval(a),null,ka.edgeSourcePortName.eval(a)):L(null,ka.edgeKey.eval(a),"source")});j=j.concat(i.map(function(a){return ka.edgeTargetPortName.eval(a)?L(ka.edgeTarget.eval(a),null,ka.edgeTargetPortName.eval(a)):L(null,ka.edgeKey.eval(a),"target")})),g=g.filter(function(a){return ka.portNodeKey()&&ka.portNodeKey()(a)||ka.portEdgeKey()&&ka.portEdgeKey()(a)});var m=u(Ba,g,j,function(a){return L(ka.portNodeKey()&&ka.portNodeKey()(a),ka.portEdgeKey()&&ka.portEdgeKey()(a),ka.portName()(a))},function(a,b){a.orig=b,a.named&&(a.edges=[])},function(a,b){console.assert(a,"should have screened out invalid ports");var c=M(a);if(c.nodeKey)b.node=za[c.nodeKey],b.named=!0;else{var d=Aa[c.edgeKey];b.node=d[c.name],b.edges=[d],b.named=!1}b.name=c.name});if(m=m.filter(function(a){return a.node}),i.forEach(function(a){var b=ka.edgeSourcePortName.eval(a);b&&Ba[L(ka.nodeKey.eval(a.source),null,b)].edges.push(a),b=ka.edgeTargetPortName.eval(a),b&&Ba[L(ka.nodeKey.eval(a.target),null,b)].edges.push(a)}),ka.induceNodes()){var n={};i.forEach(function(a){n[a.cola.dcg_edgeSource]=!0,n[a.cola.dcg_edgeTarget]=!0}),h=h.filter(function(a){return n[a.cola.dcg_nodeKey]});for(var o in za)n[o]||delete za[o]}if(h.forEach(function(a,b){a.index=b}),ya.data(ka,za,h,Aa,i,Ba,m),Ca={nnodes:h.length,nedges:i.length},h.forEach(function(a){ka.nodeFixed()&&(a.cola.dcg_nodeFixed=ka.nodeFixed.eval(a))}),ka.parallelEdgeOffset()){for(var q=new Array(h.length),r=0;r<h.length;++r)q[r]=new Array(r);i.forEach(function(a){a.pos=a.pos||{};var b,c,d,e;a.source.index<a.target.index?(b=a.source.index,c=a.target.index,d="edgeSourcePortName",e="edgeTargetPortName"):(c=a.source.index,b=a.target.index,e="edgeSourcePortName",d="edgeTargetPortName");var f=ka[d].eval(a)||"no port",g=ka[e].eval(a)||"no port";q[c][b]=q[c][b]||{},q[c][b][g]=q[c][b][g]||{},a.parallel=q[c][b][g][f]=q[c][b][g][f]||{rev:[],edges:[]},a.parallel.edges.push(a),a.parallel.rev.push(b!==a.source.index)})}var x=xa.selectAll(".edge").data(i,ka.edgeKey.eval),y=x.enter().append("svg:path").attr({class:"edge",id:ka.edgeId,opacity:0});x.exit().each(function(a){a.deleted=!0}).transition().duration(ka.stagedDuration()).delay(ka.deleteDelay()).attr("opacity",0).each(function(a){Z(a,"head",null),Z(a,"head",null)}).remove();var z=xa.selectAll(".edge-hover").data(i,ka.edgeKey.eval),A=z.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("fill","none").attr("stroke","green").attr("stroke-width",10).on("mouseover",function(b){a.select("#"+ka.edgeId(b)+"-label").attr("visibility","visible")}).on("mouseout",function(b){a.select("#"+ka.edgeId(b)+"-label").attr("visibility","hidden")});z.exit().remove();var B=xa.selectAll(".edge-label").data(i,ka.edgeKey.eval),C=B.enter().append("text").attr("id",function(a){return ka.edgeId(a)+"-label"}).attr("visibility","hidden").attr({class:"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(a){var b=ka.textpathId(a);return window.location.href.split("#")[0]+"#"+b}),D=ua.selectAll("path.edge-label-path").data(i,ka.textpathId),E=D.enter().append("svg:path").attr({class:"edge-label-path",id:ka.textpathId});B.exit().transition().duration(ka.stagedDuration()).delay(ka.deleteDelay()).attr("opacity",0).remove();var F=wa.selectAll(".node").data(h,ka.nodeKey.eval),G=F.enter().append("g").attr("class","node").attr("opacity","0");ka._enterNode(G),F.exit().each(function(a){a.deleted=!0}).transition().duration(ka.stagedDuration()).delay(ka.deleteDelay()).attr("opacity",0).remove(),ya.drawn(F,x,z),v(F,x),ka.initialLayout()&&ka.initialLayout()(ka,h,i);var H=!1;if(!ka.layoutUnchanged()){var I=JSON.stringify(h.map(function(a){return{orig:d(a),cola:{dcg_nodeFixed:a.cola.dcg_nodeFixed}}})),J=JSON.stringify(i.map(function(a){return{orig:d(a),cola:a.cola}}));I===ma&&J===na&&(H=!0),ma=I,na=J}var K=ka.constrain()(ka,h,i);K.forEach(function(a){if(a.type)switch(a.type){case"alignment":a.offsets.forEach(function(a){a.node=za[a.node].index});break;case"circle":a.nodes.forEach(function(a){a.node=za[a.node].index})}else a.axis&&(a.left=za[a.left].index,a.right=za[a.right].index)});var N=i.filter(ka.edgeIsLayout.eval),O=(i.filter(function(a){return!ka.edgeIsLayout.eval(a)}),K.filter(function(a){return"circle"===a.type}));K=K.filter(function(a){return"circle"!==a.type}),O.forEach(function(a){var b=(a.distance||4*ka.baseLength())/(2*Math.sin(Math.PI/a.nodes.length)),c=a.nodes.map(function(a){return a.node}),d=function(a){return ka.nodeKey.eval(h[a])},e=S.wheel_edges(d,c,b).map(function(a){var b={internal:a};return b.source=za[a.sourcename],b.target=za[a.targetname],b});N=N.concat(e)});var P=K.filter(function(a){return"ordering"===a.type});if(K=K.filter(function(a){return"ordering"!==a.type}),P.forEach(function(a){var c=a.nodes.map(function(a){return za[a]});if(a.ordering){var d=b.quicksort.by(p(a.ordering));c=d(c,0,c.length)}var e;c.forEach(function(b,c){0===c?e=b:K.push({left:e.index,right:(e=b).index,axis:a.axis,gap:a.gap})})}),ka.legend()&&ka.legend().redraw(),H)return Ea=!1,ya.end(!1),this;var Q=Date.now();return ka.layoutEngine().on("tick",function(a,b){var d=Date.now()-Q;ka.initialOnly()||c(a,b),ka.showLayoutSteps()&&(s(za,m),ya.receivedLayout(ka,za,h,Aa,i,Ba,m),t(za,i,Ba),W(F,G,x,y,z,A,B,C,D,E,!0),X(F),ya.transitionsStarted(F,x,z)),(Na||ka.timeLimit()&&d>ka.timeLimit())&&(console.log("cancelled"),ka.layoutEngine().stop())}).on("end",function(a,b){ka.showLayoutSteps()?w(!0):(ka.initialOnly()||c(a,b),s(za,m),ya.receivedLayout(ka,za,h,Aa,i,Ba,m),t(za,i,Ba),W(F,G,x,y,z,A,B,C,D,E,!0),X(F),ya.transitionsStarted(F,x,z));var d;switch(ka.autoZoom()){case"always":d=!0;break;case"once":d=!0,ka.autoZoom(null);break;default:d=!1}U(F,x),d&&V()}).on("start",function(){console.log("algo "+ka.layoutEngine().layoutAlgorithm()+" started."),ya.start()}),ka.initialOnly()?ka.layoutEngine().dispatch().end(h,i):(ya.start(),ka.layoutEngine().data({width:ka.width(),height:ka.height()},h.map(function(a){return a.cola}),N.map(function(a){return a.cola}),K),ka.layoutEngine().start()),this},ka.refresh=function(b,c,d,e,f){b=b||ka.selectAllNodes(),c=c||ka.selectAllEdges(),v(b,c),d=d||ka.selectAllEdges(".edge-hover"),e=e||ka.selectAllEdges(".edge-label"),f=f||ka.selectAllDefs("path.edge-label-path");var g=a.select(null);return W(b,g,c,g,d,g,e,g,f,g,!1),this},ka.reposition=function(b,c){return b.attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"}),c.each(function(b){b.pos.new=null,b.pos.old=null,E(b),ka.edgeArrowhead.eval(b)&&a.select("#"+ka.arrowId(b,"head")).attr("orient",function(){return b.pos.new.orienthead}),ka.edgeArrowtail.eval(b)&&a.select("#"+ka.arrowId(b,"tail")).attr("orient",function(){return b.pos.new.orienttail})}).attr("d",F("new")),this};var Oa;return ka.render=function(){ka.initLayoutOnRedraw()||k(),ka.resetSvg(),va=ta.append("g").attr("class","draw");var a=["edge-layer","node-layer"];return ka.edgesInFront()&&a.reverse(),va.selectAll("g").data(a).enter().append("g").attr("class",function(a){return a}),xa=va.selectAll("g.edge-layer"),wa=va.selectAll("g.node-layer"),ka.legend()&&ka.legend().render(),ka.redraw()},ka.on=function(a,b){return ya.on(a,b),this},ka.getStats=function(){return Ca},ka.select=function(a){return ka.root().select(a)},ka.selectAll=function(a){return ka.root()?ka.root().selectAll(a):null},ka.x=T(null),ka.y=T(null),ka.svg=function(a){return arguments.length?(ta=a,ka):ta},ka.g=function(a){return arguments.length?(va=a,ka):va},ka.resetSvg=function(){return ka.select("svg").remove(),ja()},ka.redrawGroup=function(){c.redrawAll(qa)},ka.renderGroup=function(){c.renderAll(qa)},ka.defineArrow=function(a,b,c,d,e,f){return Da[a]={name:a,width:b,height:c,refX:d,refY:e,drawFunction:f},ka},ka.addOrRemoveDef=function(a,b,c){var d=b?[0]:[],e=ua.selectAll("#"+a).data(d),f=e.enter().append(c).attr("id",a);return e.exit().remove(),f},ka.invertCoord=function(a){return[ka.x().invert(a[0]),ka.y().invert(a[1])]},ka.defineArrow("vee",12,12,10,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),ka.defineArrow("crow",12,12,0,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),ka.defineArrow("dot",7,7,0,0,function(a){a.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),ka.anchor=function(b,d){if(!arguments.length)return pa;if(!b)throw new c.errors.BadArgumentException("parent must be defined");return pa=b.select&&b.classed?b.node():b,ka.root(a.select(pa)),ka.root().classed(S.constants.CHART_CLASS,!0),c.registerChart(ka,d),qa=d,ka},ka.chartID=function(){return ka.__dcFlag__},ka.anchorName=function(){var a=ka.anchor();return a&&a.id?a.id:a&&a.replace?a.replace("#",""):"dc-graph"+ka.chartID()},ka.anchor(h,i)},S.spawn_engine=function(a,b,c){var d,e;switch(a){case"dagre":d=S.dagre_layout(),e=["rankdir"];break;case"tree":d=S.tree_layout(),e=[];break;case"circo":case"dot":case"neato":case"osage":case"twopi":d=S.graphviz_layout(null,a,b.server),e=[];break;case"cola":default:d=S.cola_layout(),e=["lengthStrategy"]}return e.forEach(function(a){b[a]&&d[a](b[a])}),d.supportsWebworker()&&c&&(d=S.webworker_layout(d)),d};var Z={};S.webworker_layout=function(b){var c=a.dispatch("init","start","tick","end"),d=K(b.layoutAlgorithm()),e={};d.layouts[b.layoutId()]=e,e.parent=function(a){b.parent&&b.parent(a)},e.init=function(a){return a=b.optionNames().reduce(function(a,c){return a[c]=b[c](),a},a),d.worker.postMessage({command:"init",args:{layoutId:b.layoutId(),options:a}}),this},e.data=function(a,c,e,f){d.worker.postMessage({command:"data",args:{layoutId:b.layoutId(),graph:a,nodes:c,edges:e,constraints:f}})},e.start=function(){d.worker.postMessage({command:"start",args:{layoutId:b.layoutId()}})},e.stop=function(){return d.worker.postMessage({command:"stop",args:{layoutId:b.layoutId()}}),this},e.getEngine=function(){return b};var f=["layoutAlgorithm","needsStage","populateLayoutNode","populateLayoutEdge","rankdir","ranksep"];return f.concat(b.optionNames()).forEach(function(a){e[a]=function(){var c=b[a].apply(b,arguments);return arguments.length?this:c}}),e.on=function(a,b){return c.on(a,b),this},e.dispatch=function(){return c},e},S.graphviz_attrs=function(){return{rankdir:T("TB"),nodesep:T(40),ranksep:T(40)}},S.cola_layout=function(b){function c(a){switch(j=cola.d3adaptor().avoidOverlaps(!0).size([a.width,a.height]).handleDisconnected(a.handleDisconnected),j.tickSize&&j.tickSize(a.tickSize),a.lengthStrategy){case"symmetric":j.symmetricDiffLinkLengths(a.baseLength);break;case"jaccard":j.jaccardLinkLengths(a.baseLength);break;case"individual":j.linkDistance(function(b){return b.dcg_edgeLength||a.baseLength});break;case"none":}a.flowLayout&&j.flowLayout(a.flowLayout.axis,a.flowLayout.minSeparation)}function d(a,b,c){function d(a){k[a](e,f.map(function(a){return{dcg_edgeKey:a.dcg_edgeKey}}))}var e=u(l,a,null,function(a){return a.dcg_nodeKey},function(a,b){a.dcg_nodeKey=b.dcg_nodeKey,a.width=b.width,a.height=b.height,a.fixed=!!b.dcg_nodeFixed,a.fixed&&"object"==typeof b.dcg_nodeFixed?(a.x=b.dcg_nodeFixed.x,a.y=b.dcg_nodeFixed.y):(void 0!==b.x&&(a.x=b.x),void 0!==b.y&&(a.y=b.y))}),f=u(m,b,null,function(a){return a.dcg_edgeKey},function(a,b){a.dcg_edgeKey=b.dcg_edgeKey,a.source=l[b.dcg_edgeSource],a.target=l[b.dcg_edgeTarget],a.dcg_edgeLength=b.dcg_edgeLength});e.forEach(function(a,b){a.index=b});var g=null;if(p.groupConnected()){var h=cola.separateGraphs(e,f);g=h.map(function(a){return{leaves:a.array.map(function(a){return a.index})}})}j.on("tick",function(){d("tick")}).on("start",function(){k.start()}).on("end",function(){d("end")}),j.nodes(e).links(f).constraints(c).groups(g)}function e(){j.start(p.unconstrainedIterations(),p.userConstraintIterations(),p.allConstraintsIterations(),p.gridSnapIterations())}function f(){j.stop()}var g,i=b||h(),j=null,k=a.dispatch("tick","start","end"),l={},m={},n=S.graphviz_attrs(),o=Object.keys(n);n.rankdir(null);var p=Object.assign(n,{layoutAlgorithm:function(){return"cola"},layoutId:function(){return i},supportsWebworker:function(){return!0},needsStage:function(a){return"ports"===a||"edgepos"===a},parent:T(null),on:function(a,b){return k.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),c(a),this},data:function(a,b,c,e){d(b,c,e)},start:function(){e()},stop:function(){f()},optionNames:function(){return["handleDisconnected","lengthStrategy","baseLength","flowLayout","tickSize","groupConnected"].concat(o)},populateLayoutNode:function(){},populateLayoutEdge:function(){},handleDisconnected:T(!0),lengthStrategy:T("symmetric"),baseLength:T(30),flowLayout:function(a){if(!arguments.length){if(g)return g;var b=p.rankdir();switch(b){case"LR":return{axis:"x",minSeparation:p.ranksep()+2*p.parent().nodeRadius()};case"TB":return{axis:"y",minSeparation:p.ranksep()+2*p.parent().nodeRadius()};default:return null}}return g=a,this},unconstrainedIterations:T(10),userConstraintIterations:T(20),allConstraintsIterations:T(20),gridSnapIterations:T(0),tickSize:T(1),groupConnected:T(!1)});return p},S.cola_layout.scripts=["d3.js","cola.js"],S.dagre_layout=function(b){function c(a){k=new dagre.graphlib.Graph({multigraph:!0}),k.setGraph({rankdir:a.rankdir,nodesep:a.nodesep,ranksep:a.ranksep}),k.setDefaultEdgeLabel(function(){return{}})}function d(a,b){function c(a){l[a](d,e.map(function(a){return{dcg_edgeKey:a.dcg_edgeKey}}))}var d=u(m,a,null,function(a){return a.dcg_nodeKey},function(a,b){a.dcg_nodeKey=b.dcg_nodeKey,a.width=b.width,a.height=b.height},function(a,b){k.setNode(a,b)},function(a){k.removeNode(a)}),e=u(n,b,null,function(a){return a.dcg_edgeKey},function(a,b){a.dcg_edgeKey=b.dcg_edgeKey,a.dcg_edgeSource=b.dcg_edgeSource,a.dcg_edgeTarget=b.dcg_edgeTarget},function(a,b,c){k.setEdge(c.dcg_edgeSource,c.dcg_edgeTarget,b)},function(a,b){k.removeEdge(b.dcg_edgeSource,b.dcg_edgeTarget,b.dcg_edgeKey)});g=function(){c("tick")},i=function(){c("end")}}function e(a){l.start(),dagre.layout(k),i()}function f(){}var g,i,j=b||h(),k=null,l=a.dispatch("tick","start","end"),m={},n={},o=S.graphviz_attrs(),p=Object.keys(o);return Object.assign(o,{layoutAlgorithm:function(){return"dagre"},layoutId:function(){return j},supportsWebworker:function(){return!0},needsStage:function(a){return"ports"===a||"edgepos"===a},on:function(a,b){return l.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),c(a),this},data:function(a,b,c){d(b,c)},start:function(){e()},stop:function(){f()},optionNames:function(){return p},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},S.dagre_layout.scripts=["d3.js","dagre.js"],S.tree_layout=function(b){function c(b){function c(a,b){return(e(a)+e(b))/2}var d,e=a.functor(b.nodeWidth);g=S.depth_first_traversal({nodeid:function(a){return a.dcg_nodeKey},sourceid:function(a){return a.dcg_edgeSource},targetid:function(a){return a.dcg_edgeTarget},init:function(){d=b.offsetX},row:function(a){return a.dcg_rank},place:function(a,c,f){if(f.length){var g=f[f.length-1],h=(e(g)+e(a))/2;d=Math.max(d,g.left_x+h)}a.left_x=d,a.hit_ins=1,a.y=c*b.gapY+b.offsetY},sib:function(a,b,e){var f=c(b,e);a&&(f*=1.5),d+=f},pop:function(a){a.x=(a.left_x+d)/2},skip:function(a,b){a.x=(a.hit_ins*a.x+d)/++a.hit_ins,a.hit_ins===b&&delete a.hit_ins},finish:function(a){a.forEach(function(a){for(var b,d=a.sort(function(a,b){return a.x-b.x}),e=null,f=null,g=0;g<d.length-1;++g){var h=d[g],i=d[g+1];if(e){if(b+=c(h,i),g<d.length-2&&i.x<f+b)continue;e>0&&--e;var j,k;if(g<d.length-2){var l=i.x-(f+b);j=d[e].x+l/2,k=g+1}else j=Math.max(d[e].x,f-c(d[e],d[e+1])-(b-i.x+f)/2),k=d.length;for(var m=e+1;m<k;++m)j+=c(d[m-1],d[m]),d[m].x=j;e=f=b=null}else i.x-h.x<c(h,i)&&(e=g,f=h.x,b=c(h,i))}})}})}function d(a,b){i=a,j=b}function e(){g(i,j),l.end(i,j)}function f(){}var g,i,j,k=b||h(),l=a.dispatch("tick","start","end"),m={layoutAlgorithm:function(){return"tree"},layoutId:function(){return k},supportsWebworker:function(){return!1},on:function(a,b){return l.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),c(a),this},data:function(a,b,c){d(b,c)},start:function(){e()},stop:function(){f()},optionNames:function(){return["nodeWidth","offsetX","offsetY","rowFunction","gapY"]},populateLayoutNode:function(a,b){this.rowFunction()&&(a.dcg_rank=this.rowFunction.eval(b))},populateLayoutEdge:function(){},nodeWidth:T(function(a){return a.width}),offsetX:T(30),offsetY:T(30),rowFunction:T(null),gapY:T(100)};return m},S.tree_layout.scripts=[],S.graphviz_layout=function(b,c,d){function e(a){}function f(a){return a.replace(/^%/,"&#37;")}function g(a){return a.replace(/^&#37;/,"%")}function i(a,b){return[a,'"'+b+'"'].join("=")}function j(a){return"["+a.join(", ")+"]"}function k(a,b){if(o)return void(p=o);var d=[],e="neato"!==c;d.push((e?"digraph":"graph")+" g {"),d.push("graph "+j([i("nodesep",t.nodesep()/72),i("ranksep",t.ranksep()/72),i("rankdir",t.rankdir())])),d=d.concat(a.map(function(a){var b=[i("width",a.width/72),i("height",a.height/72),i("fixedsize","true")];return a.dcg_nodeFixed&&b.push(i("pos",[a.dcg_nodeFixed.x,1e3-a.dcg_nodeFixed.y].join(","))),'  "'+f(a.dcg_nodeKey)+'" '+j(b)})),d=d.concat(b.map(function(a){return'  "'+f(a.dcg_edgeSource)+(e?'" -> "':'" -- "')+f(a.dcg_edgeTarget)+'" '+j([i("id",f(a.dcg_edgeKey)),i("arrowhead","none"),i("arrowtail","none")])})),d.push("}"),d.push(""),p=d.join("\n")}function l(a,b){s.start();var c=b.bb.split(",").map(function(a){return+a}),d=(b.objects||[]).filter(function(a){return a.pos}).map(function(a){var b=a.pos.split(",");return{dcg_nodeKey:g(a.name),x:+b[0],y:c[3]-b[1]}});q=(b.objects||[]).filter(function(a){return/^cluster/.test(a.name)}),q.forEach(function(a){a.bbflip=a.bb.split(",").map(function(a){return+a});var b=c[3]-a.bbflip[1];a.bbflip[1]=c[3]-a.bbflip[3],a.bbflip[3]=b});var e=(b.edges||[]).map(function(a){var b={dcg_edgeKey:g(a.id||"n"+a._gvid)};if(a._draw_){var d=a._draw_.find(function(a){return a.op&&a.points});b.points=d.points.map(function(a){return{x:a[0],y:c[3]-a[1]}})}return b});s.end(d,e)}function m(){if(d)a.json(d).header("Content-type","application/x-www-form-urlencoded").post("layouttool="+c+"&"+encodeURIComponent(p),l);else{var b=Viz(p,{format:"json",engine:c});b=JSON.parse(b),l(null,b)}}function n(){}var o,p,q,r=b||h(),s=a.dispatch("tick","start","end"),t=S.graphviz_attrs(),u=Object.keys(t);return Object.assign(t,{layoutAlgorithm:function(){return c},layoutId:function(){return r},supportsWebworker:function(){return!1},on:function(a,b){return s.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),e(a),this},data:function(a,b,c){k(b,c)},dotInput:function(a){return o=a,this},clusters:function(){return q},start:function(){m()},stop:function(){n()},optionNames:function(){return u},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},S.flexbox_layout=function(b){function c(a){}function d(a,b,c,e){if(e.address=a.slice(),e.children=e.children||{},!b.length)return void(e.node=c);var f=e.children[b[0]]=e.children[b[0]]||{};a.push(b.shift()),d(a,b,c,f)}function e(a){var b=u.addressToKey()(a.address);return Array.prototype.concat.apply([b],Object.keys(a.children).map(function(b){return e(a.children[b])}))}function f(a,b){m=a,n={},b.forEach(function(a){var b=u.keyToAddress()(a.dcg_nodeKey);d([],b,a,n)});e(n);o=b}function g(a,b){var c={name:u.addressToKey()(b.address),style:{}},d=Object.assign({},a),e=Object.keys(b.children).length;b.node&&Object.assign(a,b.node);for(var f in a)if(!(r.includes(f)||e&&s.includes(f))){var h=a[f];"function"==typeof h&&(h=h(b.node)),c.style[f]=h}return e&&(c.children=Object.values(b.children).sort(a.sort).map(function(a){return a.address[a.address.length-1]}).map(function(a){return g(Object.assign({},d),b.children[a])})),b.flexnode=c,c}function i(a,b){u.logStuff()&&console.log(b.node.dcg_nodeKey+": "+JSON.stringify(b.flexnode.layout)),b.node.x=a.x+b.flexnode.layout.left+b.flexnode.layout.width/2,b.node.y=a.y+b.flexnode.layout.top+b.flexnode.layout.height/2,Object.keys(b.children).map(function(a){return b.children[a]}).forEach(function(c){i({x:a.x+b.flexnode.layout.left,y:a.y+b.flexnode.layout.top},c)})}function j(a,b,c){q[c](a,b.map(function(a){return{dcg_edgeKey:a.dcg_edgeKey}}))}function k(){var b={sort:function(b,c){return a.ascending(b.node.dcg_nodeKey,c.node.dcg_nodeKey)}},c=g(b,n);c.style.width=m.width,c.style.height=m.height,u.logStuff()&&console.log(JSON.stringify(c,null,2)),computeLayout(c),i({x:0,y:0},n),j(o,[],"end")}function l(){}var m,n,o,p=b||h(),q=a.dispatch("tick","start","end"),r=["sort","dcg_nodeKey","x","y"],s=["width","height"],t=["width","height","minWidth","minHeight","maxWidth","maxHeight","left","right","top","bottom","margin","marginLeft","marginRight","marginTop","marginBottom","padding","paddingLeft","paddingRight","paddingTop","paddingBottom","borderWidth","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","flexDirection","justifyContent","alignItems","alignSelf","flex","flexWrap","position"],u={layoutAlgorithm:function(){return"cola"},layoutId:function(){return p},supportsWebworker:function(){return!0},needsStage:function(a){return"ports"===a||"edgepos"===a},parent:T(null),on:function(a,b){return q.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),c(a),this},data:function(a,b){f(a,b)},start:function(){k()},stop:function(){l()},optionNames:function(){return[]},populateLayoutNode:function(a,b){["sort","order"].concat(t).forEach(function(c){b.orig.value[c]&&(a[c]=b.orig.value[c])})},populateLayoutEdge:function(){},addressToKey:T(function(a){return a.join(",")}),keyToAddress:T(function(a){return a.split(",")}),logStuff:T(!1)};return u},S.flexbox_layout.scripts=["css-layout.js"],S.manual_layout=function(b){function c(a){}function d(a){i=a}function e(a,b,c){k[c](a,b.map(function(a){return{dcg_edgeKey:a.dcg_edgeKey}}))}function f(){e(i,[],"end")}function g(){}var i,j=b||h(),k=a.dispatch("tick","start","end"),l={layoutAlgorithm:function(){return"cola"},layoutId:function(){return j},supportsWebworker:function(){return!0},needsStage:function(a){return"ports"===a||"edgepos"===a},parent:T(null),on:function(a,b){return k.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),c(a),this},data:function(a,b,c){d(b)},start:function(){f()},stop:function(){g()},optionNames:function(){return[]},populateLayoutNode:function(a,b){["x","y"].forEach(function(c){void 0!==b.orig.value[c]&&(a[c]=b.orig.value[c])})},populateLayoutEdge:function(){},addressToKey:T(function(a){return a.join(",")}),keyToAddress:T(function(a){return a.split(",")})};return l},S.manual_layout.scripts=["css-layout.js"],S.place_ports=function(){function b(b,d,e,f,g,h,i){function j(a,b){return a[0]*b[1]-a[1]*b[0]>0}function k(a,b){return j(b[0],a)&&j(a,b[1])}function l(a,b){return j(a,b[0])?b[0]:j(b[1],a)?b[1]:a}function m(a){return[Math.cos(a),Math.sin(a)]}function n(a){return Math.atan2(a[1],a[0])}function o(a,b){return Math.hypot(b.pos.x-a.pos.x,b.pos.y-a.pos.y)}function p(a,b){var d=o(a,b),e=d>c.minDistance();return e}function q(a,b){return a+Math.random()*(b-a)}var r=b.nodePorts();for(var s in r){var t=d[s],u=r[s];u.forEach(function(a){var c=a.orig&&b.portBounds.eval(a)||[0,2*Math.PI];Array.isArray(c[0])?(a.vbounds=c,a.abounds=c.map(n)):(a.vbounds=c.map(m),a.abounds=c),a.abounds[0]>a.abounds[1]&&(a.abounds[1]+=2*Math.PI),console.assert(a.orig||a.vec,"unplaced unspecified port")});var v=[],w=[],x=[];u.forEach(function(a){a.vec?a.vbounds&&!k(a.vec,a.vbounds)?w.push(a):v.push(a):x.push(a)}),w.forEach(function(a){a.vec=l(a.vec,a.vbounds),v.push(a)});var y={},z={};x.forEach(function(a){var b=a.abounds.map(function(a){return a.toFixed(3)}).join(",");y[b]=a.abounds,z[b]=z[b]||[],z[b].push(a)});for(var A in z){var B=y[A],C=z[A];if(1===C.length)C[0].vec=m((B[0]+B[1])/2);else{var D=(B[1]-B[0])/(z[A].length-1);z[A].forEach(function(a,b){a.vec=m(B[0]+b*D)})}}v=v.concat(x),x=[],v.forEach(function(a){N(b,t,a)});for(var E=0;E<v.length;++E){var F=v[E];if(!x.includes(F))for(var G=E+1;G<v.length;++G){var H=v[G];if(!x.includes(H)&&!p(F,H)){if(!F.edges.length){x.push(F);continue}x.push(H)}}}v=v.filter(function(a){return!x.includes(a)});for(var I,J=c.patience(),K=0;x.length;){var L=x[0];L.vec=m(q(L.abounds[0],L.abounds[1])),N(b,t,L);var M=a.min(v,function(a){return o(L,a)});M>K&&(K=M,I=L.vec),(!J--||M>c.minDistance())&&(J<0&&(console.warn("ran out of patience placing a port"),L.vec=I,N(b,t,L)),v.push(L),x.shift(),J=c.patience(),K=0)}}}var c={parent:T(null).react(function(a){a?a.on("receivedLayout.place-ports",b):c.parent()&&c.parent().on("receivedLayout.place-ports",null)}),minDistance:T(20),patience:T(20)};return c},S.troubleshoot=function(){function a(a,c,d,f){function i(a){return{x:a.cola.x,y:a.cola.y}}g||(g=a.g().append("g").attr({class:"draw-graphs","pointer-events":"none"}));var j=c.data().map(function(a){return{x:a.cola.x,y:a.cola.y}}),k=g.selectAll("path.nodecenter").data(j);k.exit().remove(),k.enter().append("path").attr("class","nodecenter"),k.attr({d:function(a){return"M"+(a.x-h.xhairWidth()/2)+","+a.y+" h"+h.xhairWidth()+" M"+a.x+","+(a.y-h.xhairHeight()/2)+" v"+h.xhairHeight()},opacity:null!==h.xhairOpacity()?h.xhairOpacity():h.opacity(),stroke:h.xhairColor()});var l=c.data().map(function(a){return b(i(a),a.cola.width,a.cola.height)}),m=g.selectAll("path.colaboundary").data(l);e(m,"colaboundary");var n=c.data().map(function(a){return a.bbox?b(i(a),a.bbox.width,a.bbox.height):null}).filter(function(a){return!!a}),o=g.selectAll("path.textboundary").data(n);e(o,"textboundary");var p=c.data().map(function(a){return"number"===(a.dcg_rx,!1)?null:b(i(a),2*a.dcg_rx,2*a.dcg_ry)}).filter(function(a){return!!a}),q=g.selectAll("path.radiiboundary").data(p);e(q,"radiiboundary")}function b(a,b,c){return{left:a.x-b/2,top:a.y-c/2,right:a.x+b/2,bottom:a.y+c/2}}function c(a,b,c,d){return"M"+a+","+(b+d)+" v"+-d+" h"+c}function d(a){return[c(a.left,a.top,h.boundsWidth(),h.boundsHeight()),c(a.right,a.top,-h.boundsWidth(),h.boundsHeight()),c(a.right,a.bottom,-h.boundsWidth(),-h.boundsHeight()),c(a.left,a.bottom,h.boundsWidth(),-h.boundsHeight())].join(" ");
}function e(a,b){a.exit().remove(),a.enter().append("path").attr("class",b),a.attr({d:d,opacity:null!==h.boundsOpacity()?h.boundsOpacity():h.opacity(),stroke:h.boundsColor(),fill:"none"})}function f(a,b,c,d){g&&g.remove()}var g=null,h=S.behavior("highlight-paths",{laterDraw:!0,add_behavior:a,remove_behavior:f});return h.opacity=T(.75),h.xhairOpacity=T(null),h.xhairWidth=T(10),h.xhairHeight=T(10),h.xhairColor=T("blue"),h.boundsOpacity=T(null),h.boundsWidth=T(10),h.boundsHeight=T(10),h.boundsColor=T("green"),h},S.validate=function(b){function c(a,b,c,d){var e=a.filter(function(a){return!b(a)});return e.length?[c+" is empty for "+e.length+" of "+a.length+" "+d,e]:null}function d(a,b){return a.reduce(function(a,c){return a[b(c)]=c,a},{})}function e(a,b,c,d,e,f){var g=b.filter(function(b){return!a[c(b)]}).map(function(a){return{key:c(a),value:a}});return g.length?[d+" was not found in "+e,Object.keys(a),"for "+g.length+" of "+b.length+" "+f,g]:null}function f(){function f(a){a&&m.push(a)}function h(){return j.length+" nodes, "+k.length+" edges, "+l.length+" ports"}var i=g.parent(),j=i.nodeGroup().all(),k=i.edgeGroup().all(),l=i.portGroup()?i.portGroup().all():[],m=[];f(c(j,i.nodeKey(),"nodeKey","nodes")),f(c(k,i.edgeSource(),"edgeSource","edges")),f(c(k,i.edgeTarget(),"edgeTarget","edges"));var n=d(j,i.nodeKey()),o=d(k,i.edgeKey());f(e(n,k,i.edgeSource(),"edgeSource","nodes","edges")),f(e(n,k,i.edgeTarget(),"edgeTarget","nodes","edges")),f(c(l,function(a){return i.portNodeKey()&&i.portNodeKey()(a)||i.portEdgeKey()&&i.portEdgeKey()(a)},"portNodeKey||portEdgeKey","ports"));var p=!i.portNodeKey()&&[]||l.filter(function(a){return i.portNodeKey()(a)}),q=!i.portEdgeKey()&&[]||l.filter(function(a){return i.portEdgeKey()(a)});if(f(e(n,p,i.portNodeKey(),"portNodeKey","nodes","ports")),f(e(o,q,i.portEdgeKey(),"portEdgeKey","edges","ports")),i.portName()){var r=d(p,function(a){return i.portNodeKey()(a)+" - "+i.portName()(a)});i.edgeSourcePortName()&&f(e(r,k,function(b){return i.edgeSource()(b)+" - "+a.functor(i.edgeSourcePortName())(b)},"edgeSourcePortName","ports","edges")),i.edgeTargetPortName()&&f(e(r,k,function(b){return i.edgeTarget()(b)+" - "+a.functor(i.edgeTargetPortName())(b)},"edgeTargetPortName","ports","edges"))}m.length?(console.warn("validation of "+b+" failed with "+h()+":"),m.forEach(function(a){console.warn.apply(null,a)})):console.log("validation of "+b+" succeeded with "+h()+".")}var g={parent:T(null).react(function(a){a?a.on("data.validate",f):g.parent().on("data.validate",null)})};return g},S.legend=function(){var a,b={};return b.x=T(0),b.y=T(0),b.gap=T(5),b.nodeWidth=T(40),b.nodeHeight=T(40),b.exemplars=T({}),b.parent=T(null),b.redraw=function(){var c=b.parent().svg().selectAll("g.dc-graph-legend").data([0]);c.enter().append("g").attr("class","dc-graph-legend").attr("transform","translate("+b.x()+","+b.y()+")");var d=c.selectAll(".node").data(a,function(a){return a.name}),e=d.enter().append("g").attr("class","node");e.append("text").attr("dy","0.3em").attr("class","legend-label"),d.attr("transform",function(a,c){return"translate("+b.nodeWidth()/2+","+(b.nodeHeight()+b.gap())*(c+.5)+")"}),d.select("text.legend-label").attr("transform","translate("+(b.nodeWidth()/2+b.gap())+",0)").text(function(a){return a.name}),b.parent()._enterNode(e)._updateNode(d)},b.render=function(){var c=b.exemplars();if(c instanceof Array)a=c.map(function(a){return{name:a.name,orig:{key:a.key,value:a.value},cola:{}}});else{a=[];for(var d in c)a.push({name:d,orig:{key:d,value:c[d]},cola:{}})}b.redraw()},b},S.constraint_pattern=function(a){var b={},c=[];return a.nodes.forEach(function(a){var c=a.id,d=b[c]||(b[c]={});if(a.partition){var e=a.partition,f=a.value||a.id;a.all||a.typename?(d.match=a.extract?function(b){return a.extract(b.value[e])}:function(a){return a.value[e]},d.typename=a.typename||function(a){return e+"="+a.value[e]}):d.match=function(a){return a.value[e]===f}}else{if(!a.match)throw new Error("couldn't determine matcher for type "+JSON.stringify(a));d.match=a.match}}),a.edges.forEach(function(a){if(!a.disable){var b={source:a.source,target:a.target};b.produce="function"==typeof a.produce?a.produce:function(){return q(a.produce)},["listname","wrap","reverse"].forEach(function(c){void 0!==a[c]&&(b[c]=a[c])}),c.push(b)}}),function(a,d,e){var f=[],g={};d.forEach(function(c){var d=a.nodeKey.eval(c);for(var e in b){var f=b[e],h=f.match(c.orig);if(h){var i=f.typename?f.typename(e,h):e;g[i]||(g[i]={nodes:[],whether:{}}),g[i].nodes.push(d),g[i].whether[d]=!0}}});var h=c.filter(function(a){return a.source!==a.target}),i=c.filter(function(a){return a.source===a.target});return e.forEach(function(b){var c=a.edgeSource.eval(b),i=a.edgeTarget.eval(b);h.forEach(function(a){if(g[a.source]&&g[a.source].whether[c]&&g[a.target]&&g[a.target].whether[i]){var b=a.produce(g,d,e);a.reverse?(b.left=i,b.right=c):(b.left=c,b.right=i),f.push(b)}})}),i.forEach(function(a){if(g[a.source]){var b=a.produce(),c=a.listname||a.produce.listname||"nodes",d=a.wrap||a.produce.wrap||function(a){return a};b[c]=g[a.source].nodes.map(d),f.push(b)}}),f}},S.gap_y=function(a,b){return{axis:"y",gap:a,equality:!!b}},S.gap_x=function(a,b){return{axis:"x",gap:a,equality:!!b}},S.align_y=function(){return O("y")},S.align_x=function(){return O("x")},S.order_x=function(a,b){return{type:"ordering",axis:"x",gap:60,ordering:b}},S.order_y=function(a,b){return{type:"ordering",axis:"y",gap:60,ordering:b}},S.tree_positions=function(b,c,d,e,f,g,h){function i(a,b){return(g(a)+g(b))/2}console.warn("dc_graph.tree_positions is deprecated; use the layout engine tree_layout instead"),(b||d)&&console.warn("dc_graph.tree_positions: rootf and treef are ignored");var j;g=a.functor(g);var k=S.depth_first_traversal({nodeid:function(a){return a.cola.dcg_nodeKey},sourceid:function(a){return a.cola.dcg_edgeSource},targetid:function(a){return a.cola.dcg_edgeTarget},init:function(){j=e},row:function(a){return c(a.orig)},place:function(a,b,c){if(c.length){var d=c[c.length-1],e=(g(d)+g(a))/2;j=Math.max(j,d.left_x+e)}a.left_x=j,a.hit_ins=1,a.cola.y=b*h+f},sib:function(a,b,c){var d=i(b,c);a&&(d*=1.5),j+=d},pop:function(a){a.cola.x=(a.left_x+j)/2},skip:function(a,b){a.cola.x=(a.hit_ins*a.cola.x+j)/++a.hit_ins,a.hit_ins===b&&delete a.hit_ins},finish:function(a){a.forEach(function(a){for(var b,c=a.sort(function(a,b){return a.cola.x-b.cola.x}),d=null,e=null,f=0;f<c.length-1;++f){var g=c[f],h=c[f+1];if(d){if(b+=i(g,h),f<c.length-2&&h.cola.x<e+b)continue;d>0&&--d;var j,k;if(f<c.length-2){var l=h.cola.x-(e+b);j=c[d].cola.x+l/2,k=f+1}else j=Math.max(c[d].cola.x,e-i(c[d],c[d+1])-(b-h.cola.x+e)/2),k=c.length;for(var m=d+1;m<k;++m)j+=i(c[m-1],c[m]),c[m].cola.x=j;d=e=b=null}else h.cola.x-g.cola.x<i(g,h)&&(d=f,e=g.cola.x,b=i(g,h))}})}});return function(a,b,c){return k(b,c)}},S.tree_constraints=function(a,b,c,d){return console.warn("dc_graph.tree_constraints is deprecated - it never worked right and may not be a good idea"),function(d,e,f){var g=[],h=0,i=S.depth_first_traversal({root:a,tree:b,place:function(a,b,c){if(c.length){var e=c[c.length-1];g.push({left:d.nodeKey.eval(e),right:d.nodeKey.eval(a),axis:"x",gap:h-e.foo_x,equality:!0})}a.foo_x=h},sib:function(){h+=c}});return i(d,e,f),g}},S.behavior=function(a,b){var c={},d=b.laterDraw?"transitionsStarted":"drawn";return c.parent=T(null).react(function(e){var f;if(e){var g=!0;f=e,e.on(d+"."+a,function(a,c,d){b.add_behavior(f,a,c,d),g&&b.first?(b.first(f,a,c,d),g=!1):b.rest&&b.rest(f,a,c,d)})}else c.parent()&&(f=c.parent(),f.on(d+"."+a,function(c,e,g){b.remove_behavior(f,c,e,g),f.on(d+"."+a,null)}));b.parent&&b.parent(e)}),c},S.tip=function(b){function c(b){k||(k=a.tip().attr("class","d3-tip").html(function(a){return"<span>"+a+"</span>"}).direction(l.direction()),l.offset()&&k.offset(l.offset()),b.svg().call(k))}function d(b){return function(c){var d=this,f=function(){l[b]()(c,function(b){k.show.call(d,b,d),a.select("div.d3-tip").selectAll("a.tip-link").on("click",function(){a.event.preventDefault(),l.linkCallback()&&l.linkCallback()(this.id)})})};return l.selection().exclude&&l.selection().exclude(a.event.target)?void e.call(this):(i&&window.clearTimeout(i),void(l.delay()?(window.clearTimeout(h),h=window.setTimeout(f,l.delay())):f()))}}function e(){(!a.event.relatedTarget||l.selection().exclude&&l.selection().exclude(a.event.target)||!(this.contains(a.event.relatedTarget)||l.clickable()&&a.event.relatedTarget.classList.contains("d3-tip")))&&(h&&(window.clearTimeout(h),h=null),l.clickable()?i=window.setTimeout(function(){k.hide()},l.hideDelay()):k.hide())}function f(b,f,g,h){c(b),l.selection().select(b,f,g,h).on("mouseover."+j,d("content")).on("mouseout."+j,e),l.clickable()&&a.select("div.d3-tip").on("mouseover."+j,function(){i&&window.clearTimeout(i)}).on("mouseout."+j,e)}function g(a,b,c,d){l.selection().select(a,b,c,d).on("mouseover."+j,null).on("mouseout."+j,null)}b=b||{};var h,i,j=b.namespace||"tip",k=null,l=S.behavior(j,{add_behavior:f,remove_behavior:g,laterDraw:!0});return l.direction=T("n"),l.content=T(function(a,b){b(l.parent()?l.parent().nodeTitle.eval(a):"")}),l.selection=T(S.tip.select_node_and_edge()),l.showDelay=l.delay=T(0),l.hideDelay=T(200),l.offset=T(null),l.clickable=T(!1),l.linkCallback=T(null),l},S.tip.table=function(){var b=function(c,d){c=c.orig.value;var e=Object.keys(c).filter(a.functor(b.filter())).filter(function(a){return c[a]}),f=a.select(document.createElement("table")),g=f.selectAll("tr").data(e),h=g.enter().append("tr");h.append("td").text(function(a){return a}),h.append("td").text(function(a){return c[a]}),d(f.node().outerHTML)};return b.filter=T(!0),b},S.tip.select_node_and_edge=function(){return{select:function(a,b,c,d){var e=a.selectAll(".foo-this-does-not-exist");return e[0]=b[0].concat(d[0]),e},exclude:function(a){return t(a,"port")}}},S.tip.select_node=function(){return{select:function(a,b,c,d){return b},exclude:function(a){return t(a,"port")}}},S.tip.select_edge=function(){return{select:function(a,b,c,d){return c}}},S.tip.select_port=function(){return{select:function(a,b,c,d){return b.selectAll("g.port")}}},S.keyboard=function(){function b(){g.keydown()}function c(){g.keyup()}function d(a){f=a.svg().selectAll("a#dcgraph-keyboard").data([1]),f.enter().insert("a",":first-child").attr({id:"dcgraph-keyboard",href:"#"}),f.on("keydown.keyboard",b),f.on("keyup.keyboard",c),a.svg().on("mouseup.keyboard",function(){h.focus()})}function e(a){f.remove()}var f,g=a.dispatch("keydown","keyup"),h=S.behavior("brush",{add_behavior:d,remove_behavior:e});return h.on=function(a,b){return g.on(a,b),this},h.focus=function(){h.disableFocus()||f.node().focus()},h.disableFocus=T(!1),h},S.edit_text=function(b,c){function d(){var a;switch(c.align){case"left":a=[c.box.x,c.box.y];break;default:case"center":a=[c.box.x+(c.box.width-i.node().offsetWidth)/2,c.box.y+(c.box.height-i.node().offsetHeight)/2]}h.attr("transform","translate("+a.join(" ")+")")}function e(){a.event.stopPropagation()}function f(){c.accept&&c.accept(i.text()),i.on("blur.edittext",null),h.remove(),c.finally&&c.finally()}function g(){c.cancel&&c.cancel(),i.on("blur.edittext",null),h.remove(),c.finally&&c.finally()}var h=b.append("foreignObject").attr({height:"100%",width:"100%"}),i=h.append("xhtml:div"),j=c.text||"type on me";i.text(j).attr({contenteditable:!0,width:"auto"}).style({display:"inline-block","background-color":"white",padding:"2px"}),h.on("mousedown",e).on("mousemove",e).on("mouseup",e).on("dblclick",e),i.on("keydown.edittext",function(){13===a.event.keyCode&&a.event.preventDefault()}).on("keyup.edittext",function(){13===a.event.keyCode?f():27===a.event.keyCode&&g(),d()}).on("blur.edittext",g),d(),i.node().focus();var k=document.createRange();c.selectText?k.selectNodeContents(i.node()):(k.setStart(i.node(),1),k.setEnd(i.node(),1));var l=window.getSelection();l.removeAllRanges(),l.addRange(k)},S.brush=function(){function b(){i.brushstart()}function c(){var a=h.extent();i.brushmove(a)}function d(){i.brushend(),g.call(h.clear())}function e(e){h||(h=a.svg.brush().x(e.x()).y(e.y()).on("brushstart",b).on("brush",c).on("brushend",d)),g||(g=e.svg().insert("g",":first-child").attr("class","brush").call(h))}function f(){g&&(g.remove(),g=null)}var g,h=null,i=a.dispatch("brushstart","brushmove","brushend"),j=S.behavior("brush",{add_behavior:function(){},remove_behavior:f});return j.on=function(a,b){return i.on(a,b),this},j.activate=function(){return e(j.parent()),this},j.deactivate=function(){return f(),this},j.isActive=function(){return!!g},j},S.select_things=function(b,c,d){function e(a,b){return!!q.find(s(b))}function f(a){return a.shiftKey}function g(a){return W?a.metaKey:a.ctrlKey}function h(a,b){return e(a,b)?a:a.concat([b])}function i(a,b){return e(a,b)?a.filter(function(a){return a!=b}):a.concat([b])}function j(a){return function(b,c){void 0===c&&(c=!0),q=b,c&&a.refresh()}}function k(d,e){t!==e&&(d.svg().on("click."+c,e?function(c){a.event.target===this&&b.set_changed([])}:null),t=e)}function l(){f(a.event.sourceEvent)||g(a.event.sourceEvent)?p=q.slice():(p=[],b.set_changed([]))}function m(c){var e,j=d.intersectRect(c);e=f(a.event.sourceEvent)?j.reduce(h,p):g(a.event.sourceEvent)?j.reduce(i,p):j,b.set_changed(e)}function n(j,l,m){var n=u.noneIsAll()?function(a){return!q.length||e(q,d.key(a))}:function(a){return e(q,d.key(a))};if(d.applyStyles(n),d.clickables(j,l,m).on("mousedown."+c,function(a){r=a}),d.clickables(j,l,m).on("mouseup."+c,function(c){if(!(d.excludeClick&&d.excludeClick(a.event.target)||r!==c)){var e,j=d.key(c);u.multipleSelect()&&(f(a.event)?e=h(q,j):g(a.event)&&(e=i(q,j))),e||(e=[j]),b.set_changed(e)}}),u.multipleSelect()){var o=j.child("brush");o.activate()}else k(j,u.clickBackgroundClears());if(u.autoCropSelection()){var p=d.clickables(j,l,m).data().map(d.key),s=q.filter(function(a){return e(p,a)});q.length!==s.length&&b.set_changed(s,!1)}}function o(a,b,e){d.clickables(a,b,e).on("click."+c,null),a.svg().on("click."+c,null),d.removeStyles()}var p,q=[],r=null,s=d.keysEqual?function(a){return function(b){return d.keysEqual(a,b)}}:function(a){return function(b){return a===b}},t=!1,u=S.behavior(c,{add_behavior:n,remove_behavior:o,parent:function(a){if(b.on("set_changed."+c,a?j(a):null),a){var d=a.child("brush");d||(d=S.brush(),a.child("brush",d)),d.on("brushstart."+c,l).on("brushmove."+c,m)}},laterDraw:d.laterDraw||!1});return u.multipleSelect=T(!0),u.clickBackgroundClears=T(!0,!1).react(function(a){!u.multipleSelect()&&u.parent()&&k(u.parent(),a)}),u.noneIsAll=T(!1),u.autoCropSelection=T(!0),u.thinginess=function(){return d},u},S.select_things_group=function(b,c){return window.chart_registry.create_type(c,function(){return a.dispatch("set_changed")}),window.chart_registry.create_group(c,b)},S.select_nodes=function(a,b){b=b||{};var c=S.select_things_group(b.select_nodes_group||"select-nodes-group","select-nodes"),d={intersectRect:function(a){return e.parent().selectAllNodes().data().filter(function(b){return b&&a[0][0]<b.cola.x&&b.cola.x<a[1][0]&&a[0][1]<b.cola.y&&b.cola.y<a[1][1]}).map(this.key)},clickables:function(a,b,c){return b},excludeClick:function(a){return t(a,"port")},key:function(a){return e.parent().nodeKey.eval(a)},applyStyles:function(b){e.parent().cascade(50,!0,m(b,null,a))},removeStyles:function(){e.parent().cascade(50,!1,a)}},e=S.select_things(c,"select-nodes",d);return e},S.select_edges=function(a,b){b=b||{};var c=S.select_things_group(b.select_edges_group||"select-edges-group","select-edges"),d={intersectRect:function(a){return this.clickables().data().filter(function(b){var c={x:b.source.cola.x+b.sourcePort.pos.x,y:b.source.cola.y+b.sourcePort.pos.y},d={x:b.target.cola.x+b.targetPort.pos.x,y:b.target.cola.y+b.targetPort.pos.y};return[c,d].some(function(b){return a[0][0]<b.x&&b.x<a[1][0]&&a[0][1]<b.y&&b.y<a[1][1]})}).map(this.key)},clickables:function(){return e.parent().selectAllEdges(".edge-hover")},key:function(a){return e.parent().edgeKey.eval(a)},applyStyles:function(b){e.parent().cascade(50,!0,m(null,b,a))},removeStyles:function(){e.parent().cascade(50,!1,a)}},e=S.select_things(c,"select-edges",d);return e},S.select_ports=function(a,b){b=b||{};var c=b.portStyle||"symbols",d=S.select_things_group(b.select_ports_group||"select-ports-group","select-ports"),e={laterDraw:!0,intersectRect:null,clickables:function(){return f.parent().selectAllNodes("g.port")},key:function(a){return a.named?{node:f.parent().nodeKey.eval(a.node),name:a.name}:{edge:f.parent().edgeKey.eval(a.edges[0]),name:a.name}},applyStyles:function(b){f.parent().portStyle(c).cascade(50,!0,l(b,a))},removeStyles:function(){f.parent().portStyle(c).cascade(50,!1,a)},keysEqual:function(a,b){return a.name===b.name&&(a.node?a.node===b.node:a.edge===b.edge)}},f=S.select_things(d,"select-ports",e);return f},S.move_nodes=function(b){function c(a){return function(a,b){void 0===b&&(b=!0),n=a}}function d(a){n.forEach(function(b){var c=p.parent().getWholeNode(b);a(c,b)})}function e(b,c,e){function f(){if(o){var a=S.event_coords(b),f=a[0]-o[0],i=a[1]-o[1];!h&&Math.hypot(f,i)>p.dragSize()&&(h=!0,g&&g.style("pointer-events","none")),h&&(d(function(a){a.cola.x=a.original_position[0]+f,a.cola.y=a.original_position[1]+i}),b.reposition(c,e))}}function k(){if(o){if(h){h=!1,g&&(g.style("pointer-events",null),g=null);var a=[];d(function(b,c){a.push({id:c,pos:{x:b.cola.x,y:b.cola.y}})}),m.request_fixes(a)}o=null}}c.on("mousedown.move-nodes",function(c){if(!(j&&j.usePorts()&&j.usePorts().eventPort())){o=S.event_coords(b),g=a.select(this);var e=b.nodeKey.eval(c);n.indexOf(e)<0&&l.set_changed([e]),d(function(a){a.original_position=[a.cola.x,a.cola.y]}),i&&i.deactivate()}}),c.on("mousemove.move-nodes",f).on("mouseup.move-nodes",k),b.svg().on("mousemove.move-nodes",f).on("mouseup.move-nodes",k)}function f(a,b,c){b.on("mousedown.move-nodes",null),b.on("mousemove.move-nodes",null),b.on("mouseup.move-nodes",null)}b=b||{};var g,h,i,j,k,l=S.select_things_group(b.select_nodes_group||"select-nodes-group","select-nodes"),m=S.fix_nodes_group("fix-nodes-group"),n=[],o=null,p=S.behavior("move-nodes",{add_behavior:e,remove_behavior:f,parent:function(a){l.on("set_changed.move-nodes",a?c(a):null),i=a.child("brush"),j=a.child("draw-graphs"),k=a.child("select-nodes")}});return p.dragSize=T(5),p},S.fix_nodes=function(a){function b(a){u.strategy().request_fixes(t,a),g(e()).then(function(){u.parent().redraw()})}function c(a,b,c){u.strategy().new_node(t,a,b,c)}function d(a,b,c){var d=m[b],e=m[c];u.strategy().new_edge(t,a,d,e)}function e(){var a=[];return n.forEach(function(b){var c=u.parent().nodeKey.eval(b),d=s[c],e=b.orig.value[r],f=!1;e?d&&d.x===e.x&&d.y===e.y||(f=!0):f=d,f&&a.push({n:b,fixed:d?{x:d.x,y:d.y}:null})}),a}function f(a,b){b?t.fix_node(a.orig.value,b):t.unfix_node(a.orig.value)}function g(a){var b=u.fixNode()||function(a,b){return Promise.resolve(b)},c=a.map(function(a){var c=u.parent().nodeKey.eval(a.n);return b(c,a.fixed).then(function(b){f(a.n,b)})});return Promise.all(c)}function h(a){a.forEach(function(a){f(a.n,a.fixed)})}function i(a){var b=u.fixNode()||function(a,b){return Promise.resolve(b)},c=a.map(function(a){var c=u.parent().nodeKey.eval(a.n);return b(c,a.fixed)});return Promise.all(c)}function j(a){void 0===a&&(a=!0);var b=n.map(function(a){return{n:a,fixed:{x:a.cola.x,y:a.cola.y}}});return a?g(b):(h(b),Promise.resolve(void 0))}function k(){u.strategy().clear_all_fixes&&u.strategy().clear_all_fixes(),t.clear_fixes()}function l(a,b,c,d,f,g,j){if(m=b,n=c,o=d,p=f,u.strategy().on_data){u.strategy().on_data(t,b,c,d,f,g,j);var k=e();h(k),u.reportOverridesAsynchronously()&&i(k)}}a=a||{};var m,n,o,p,q=S.fix_nodes_group("fix-nodes-group"),r=a.fixedPosTag||"fixedPos",s=[],t={nodeid:function(a){return u.parent().nodeKey.eval(a)},sourceid:function(a){return u.parent().edgeSource.eval(a)},targetid:function(a){return u.parent().edgeTarget.eval(a)},get_fix:function(a){return u.parent().nodeFixed.eval(a)},fix_node:function(a,b){a[r]=b},unfix_node:function(a){a[r]=null},clear_fixes:function(){s={}},register_fix:function(a,b){s[a]=b}},u={parent:T(null).react(function(a){q.on("request_fixes.fix-nodes",a?b:null).on("new_node.fix_nodes",a?c:null).on("new_edge.fix_nodes",a?d:null),a?a.on("data.fix-nodes",l):u.parent()&&u.parent().on("data.fix-nodes",null)}),fixNode:T(null),fixAllNodes:j,clearFixes:k,strategy:T(S.fix_nodes.strategy.fix_last()),reportOverridesAsynchronously:T(!0)};return u},S.fix_nodes.strategy={},S.fix_nodes.strategy.fix_last=function(){return{request_fixes:function(a,b){a.clear_fixes(),b.forEach(function(b){a.register_fix(b.id,b.pos)})},new_node:function(a,b,c,d){a.fix_node(c,d)},new_edge:function(a,b,c,d){a.unfix_node(c.orig.value),a.unfix_node(d.orig.value)}}},S.fix_nodes.strategy.last_N_per_component=function(a){var b=0,c={};return{clear_all_fixes:function(){c={}},request_fixes:function(a,d){++b,d.forEach(function(a){c[a.id]={id:a.id,age:b,pos:a.pos}})},new_node:function(a,d,e,f){++b,c[d]={id:d,age:b,pos:f},a.fix_node(e,f)},new_edge:function(){},on_data:function(d,e,f,g,h,i,j){++b,f.forEach(function(a){var e=d.nodeid(a),f=d.get_fix(a);f&&!c[e]&&(c[e]={id:e,age:b,pos:f})});var k=[],l=S.undirected_dfs({nodeid:d.nodeid,sourceid:d.sourceid,targetid:d.targetid,comp:function(){k.push([])},node:function(a,b){k[a].push(b)}});l(f,h),d.clear_fixes(),k.forEach(function(b,e){var f=b.reduce(function(a,b){if(b.last_component){var e=a[b.last_component]=a[b.last_component]||{total:0,fixed:0};e.total++,c[d.nodeid(b)]&&e.fixed++}return a},{}),g=Object.keys(f).reduce(function(a,b){return f[b].fixed&&a.push({compid:+b,total:f[b].total,fixed:f[b].fixed}),a},[]).sort(function(a,b){return b.total-a.total}),h=g.length&&g[0].compid,i=b.filter(function(a){return!a.last_component||a.last_component===h}).map(function(a){return c[d.nodeid(a)]}).filter(function(a){return a});i.length>a&&(i.sort(function(a,b){return b.age-a.age}),i=i.slice(0,a)),i.forEach(function(a){d.register_fix(a.id,a.pos)});var j=i.reduce(function(a,b){return a[b.id]=!0,a},{});b.forEach(function(a){var b=d.nodeid(a);j[b]||(c[b]=null),a.last_component=e+1})})}}},S.fix_nodes_group=function(b){return window.chart_registry.create_type("fix-nodes",function(){return a.dispatch("request_fixes","new_node","new_edge")}),window.chart_registry.create_group("fix-nodes",b)},S.filter_selection=function(b,c){function d(b){return function(c){if(c.length){var d=a.set(c);f.dimensionAccessor()(b).filterFunction(function(a){return d.has(a)})}else f.dimensionAccessor()(b).filter(null);b.redrawGroup()}}c=c||"select-nodes";var e=S.select_things_group(b||"select-nodes-group",c),f={parent:T(null).react(function(a){e.on("set_changed.filter-selection-"+c,a?d(a):null)})};return f.dimensionAccessor=T(function(a){return a.nodeDimension()}),f},S.delete_things=function(b,c,d){function e(a){l=a}function f(a){return a[d]}function g(a){if(!m.crossfilterAccessor())throw new Error("need crossfilterAccessor");if(!m.dimensionAccessor())throw new Error("need dimensionAccessor");if(a=a||l,0===a.length)return Promise.resolve([]);var b=m.preDelete()?m.preDelete()(a):Promise.resolve(a);return m.onDelete()&&(b=b.then(m.onDelete())),b.then(function(a){if(a&&a.length){var b=m.crossfilterAccessor()(m.parent()),c=m.dimensionAccessor()(m.parent()),d=b.all().slice();d.length;c.filter(null),b.remove();var e=d.filter(function(b){return a.indexOf(f(b))===-1});d.length!==e.length+a.length&&console.warn("size after deletion is not previous size minus selection size",e.map(f),d.map(f),a),b.add(e),m.parent().redrawGroup()}return!0})}function h(b){j.on("keyup."+c,function(){a.event.code===k&&g()})}function i(a){}d=d||"id";var j,k=W?"Backspace":"Delete",l=[],m=S.behavior(c,{add_behavior:h,remove_behavior:i,parent:function(a){b.on("set_changed."+c,e),a&&(j=a.child("keyboard"),j||a.child("keyboard",j=S.keyboard()))}});return m.preDelete=T(null),m.onDelete=T(null),m.crossfilterAccessor=T(null),m.dimensionAccessor=T(null),m.deleteSelection=g,m},S.delete_nodes=function(a,b){b=b||{};var c=S.select_things_group(b.select_nodes_group||"select-nodes-group","select-nodes"),d=S.select_things_group(b.select_edges_group||"select-edges-group","select-edges"),e=S.delete_things(c,"delete-nodes",a);return e.preDelete(function(a){var b=e.parent(),c=b.child("delete-edges");return c?Promise.resolve(void 0).then(function(){var e=b.edgeGroup().all().filter(function(c){return a.indexOf(b.edgeSource()(c))!==-1||a.indexOf(b.edgeTarget()(c))!==-1}).map(b.edgeKey());return d.set_changed(e),c.deleteSelection().then(function(){return a})}):null}),e},S.label_things=function(b){function c(a){return function(a){m=a}}function d(){i.focus()}function e(a){return function(c,e){var f=b.thing_box(c);S.edit_text(a.g(),{text:e.text||b.thing_label(c)||b.default_label,align:b.align,box:f,selectText:e.selectText,accept:function(a){return b.accept(c,a)},finally:d})}}function f(a,c,d){var e=b.find_thing(m[0],a,c);return e.empty()?void console.error("couldn't find thing '"+m[0]+"'!"):e.size()>1?void console.error("found too many things for '"+m[0]+"' ("+e.size()+")!"):void l.edit_label(e,d)}function g(c,d,e){i.on("keyup."+b.label_type,function(){if(m.length){if(1!==a.event.key.length)return;f(d,e,{text:a.event.key,selectText:!1})}}),j&&j.thinginess().clickables(c,d,e).on("dblclick."+b.label_type,function(){f(d,e,{selectText:!0})})}function h(a,b,c){}b=b||{};var i,j,k=S.select_things_group(b.select_group,b.select_type),l=S.label_things_group(b.label_group,b.label_type),m=[],n=S.behavior(b.label_type,{add_behavior:g,remove_behavior:h,parent:function(a){k.on("set_changed."+b.label_type,a?c(a):null),l.on("edit_label."+b.label_type,a?e(a):null),a&&(i=a.child("keyboard"),i||a.child("keyboard",i=S.keyboard()),j=a.child(b.select_type))}});return n.editSelection=function(a){f(n.parent().selectAllNodes(),n.parent().selectAllEdges(),a)},n},S.label_things_group=function(b,c){return window.chart_registry.create_type(c,function(){return a.dispatch("edit_label")}),window.chart_registry.create_group(c,b)},S.label_nodes=function(a){a=a||{};var b=a.labelTag||"label";a.select_group=a.select_group||"select-nodes-group",a.select_type=a.select_type||"select-nodes",a.label_group=a.label_group||"label-nodes-group",a.label_type=a.label_type||"label-nodes",a.default_label="node name",a.find_thing=function(a,b,d){return b.filter(function(b){return c.parent().nodeKey.eval(b)===a})},a.thing_box=function(a,b){var d=c.parent().content(c.parent().nodeContent.eval(a.datum())),e=d.textbox(a);return e.x+=a.datum().cola.x,e.y+=a.datum().cola.y,e},a.thing_label=function(a){return c.parent().nodeLabel.eval(a.datum())},a.accept=function(a,d){var e=c.changeNodeLabel()?c.changeNodeLabel()(c.parent().nodeKey.eval(a.datum()),d):Promise.resolve(d);return e.then(function(d){var e=a.datum();e.orig.value[b]=d,c.parent().redrawGroup()})};var c=S.label_things(a);return c.changeNodeLabel=T(null),c},S.label_edges=function(a){a=a||{};var b=a.labelTag||"label";a.select_group=a.select_group||"select-edges-group",a.select_type=a.select_type||"select-edges",a.label_group=a.label_group||"label-edges-group",a.label_type=a.label_type||"label-edges",a.default_label="edge name",a.find_thing=function(a,b,d){return d.filter(function(b){return c.parent().edgeKey.eval(b)===a})},a.thing_box=function(a,b){var c=a.datum().pos.new.path.points,d=(c[0].x+c[1].x)/2,e=(c[0].y+c[1].y)/2;return{x:d,y:e-10,width:0,height:20}},a.thing_label=function(a){return c.parent().edgeLabel.eval(a.datum())},a.accept=function(a,d){var e=c.changeEdgeLabel()?c.changeEdgeLabel()(c.parent().edgeKey.eval(a.datum()),d):Promise.resolve(d);return e.then(function(d){var e=a.datum();e.orig.value[b]=d,c.parent().redrawGroup()})};var c=S.label_things(a);return c.changeEdgeLabel=T(null),c},S.highlight_neighbors=function(a){function b(a){a.each(function(a){a.dcg_highlighted=!1})}function c(c,d,e){c.cascade(100,!0,m(null,function(a){return a.dcg_highlighted},a)),d.on("mouseover.highlight-neighbors",function(a){e.each(function(b){b.dcg_highlighted=b.source===a||b.target===a}),c.refresh(d,e)}).on("mouseout.highlight-neighbors",function(a){b(e),c.refresh(d,e)})}function d(c,d,e){d.on("mouseover.highlight-neighbors",null).on("mouseout.highlight-neighbors",null),b(e),c.cascade(100,!1,a)}return S.behavior("highlight-neighbors",{add_behavior:c,remove_behavior:function(a,b,c){d(a,b,c)}})},S.register_highlight_paths_group=function(b){return window.chart_registry.create_type("highlight-paths",function(){return a.dispatch("paths_changed","hover_changed","select_changed")}),window.chart_registry.create_group("highlight-paths",b)},S.highlight_paths=function(a,b,c,d){function e(){w.doRedraw()?w.parent().relayout().redraw():w.parent().refresh()}function f(a,b){u=v=null,0===Object.keys(s).length&&0===Object.keys(a).length&&0===Object.keys(t).length&&0===Object.keys(b).length||(s=a,t=b,e())}function g(a){a!==v&&(v=a,e())}function h(a){a!==u&&(u=a,e())}function i(){s={},t={}}function j(a){return function(b){return a.indexOf(b)>=0}}function k(a){var b=j(a);return function(a){return!b(a)}}function l(a,b){return!(!a||!b)&&a.some(j(b))}function n(a,b){return a?b?b.every(j(a))?a.filter(k(b)):a.concat(b.filter(k(a))):a:b}function o(d,e,f,g){d.cascade(200,!0,m(function(a){return!!s[d.nodeKey.eval(a)]},function(a){return!!t[d.edgeKey.eval(a)]},a)).cascade(300,!0,m(function(a){return l(s[d.nodeKey.eval(a)],u)},function(a){return l(t[d.edgeKey.eval(a)],u)},c)).cascade(400,!0,m(function(a){return l(s[d.nodeKey.eval(a)],v)},function(a){return l(t[d.edgeKey.eval(a)],v)},b)),e.on("mouseover.highlight-paths",function(a){q.hover_changed(s[d.nodeKey.eval(a)]||null)}).on("mouseout.highlight-paths",function(a){q.hover_changed(null)}).on("click.highlight-paths",function(a){q.select_changed(n(u,s[d.nodeKey.eval(a)]))}),g.on("mouseover.highlight-paths",function(a){q.hover_changed(t[d.edgeKey.eval(a)]||null)}).on("mouseout.highlight-paths",function(a){q.hover_changed(null)}).on("click.highlight-paths",function(a){q.select_changed(n(u,t[d.nodeKey.eval(a)]))})}function p(d,e,f,g){e.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),g.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),i(),d.cascade(200,!1,a).cascade(300,!1,c).cascade(400,!1,b)}var q=S.register_highlight_paths_group(d||"highlight-paths-group");a=a||{},b=b||{},c=c||{};var r,s={},t={},u=null,v=null,w=S.behavior("highlight-paths",{add_behavior:o,remove_behavior:function(a,b,c,d){return p(a,b,c,d),this},parent:function(a){a&&(r=a.anchorName()),q.on("paths_changed."+r,a?f:null),q.on("hover_changed."+r,a?g:null),q.on("select_changed."+r,a?h:null)}});return w.doRedraw=T(!1),w},S.expand_collapse=function(b,c,d,e){function f(a){var b=a.addOrRemoveDef("spike-gradient",!0,"linearGradient");b.attr({x1:"0%",y1:"0%",x2:"100%",y2:"0%",spreadMethod:"pad"}),b.selectAll("stop").data([[0,"black",1],[100,"black","0"]]).enter().append("stop").attr({offset:function(a){return a[0]+"%"},"stop-color":function(a){return a[1]},"stop-opacity":function(a){return a[2]}})}function g(a,b,c,d){var e;switch(c){case"out":e=function(b){return a.edgeSource.eval(b)===d};break;case"in":e=function(b){return a.edgeTarget.eval(b)===d};break;case"both":e=function(b){return a.edgeSource.eval(b)===d||a.edgeTarget.eval(b)===d}}return b.filter(e).size()}function h(a,b,c){if("both"===b)return function(a){return Math.PI*(2*a/c-.5)};var d,e=(c-1)*Math.PI/c;switch(a){case"LR":d=0;break;case"TB":d=Math.PI/2;break;case"RL":d=Math.PI;break;case"BT":d=-Math.PI/2}return"in"===b&&(d+=Math.PI),function(a){return d+e*(-.5+(c>1?a/(c-1):0))}}function i(a,b,c){var d=b.selectAll("g.spikes").data(function(a){return!a.dcg_expand_selected||a.dcg_expanded&&a.dcg_expanded[a.dcg_expand_selected.dir]?[]:[a]});d.exit().remove(),d.enter().insert("g",":first-child").classed("spikes",!0);var e=d.selectAll("rect.spike").data(function(b){for(var c=(a.nodeKey.eval(b),b.dcg_expand_selected.dir),d=b.dcg_expand_selected.n,e=h(a.layoutEngine().rankdir(),c,d),f=Array(d),g=0;g<d;++g){var i=e(g);
f[g]={a:180*i/Math.PI,x:Math.cos(i)*b.dcg_rx*.9,y:Math.sin(i)*b.dcg_ry*.9}}return f});e.enter().append("rect").classed("spike",!0).attr({width:25,height:3,fill:"url(#spike-gradient)",rx:1,ry:1,x:0,y:0}),e.attr("transform",function(a){return"translate("+a.x+","+a.y+") rotate("+a.a+")"}),e.exit().remove()}function j(a,b,c){b.each(function(a){a.dcg_expand_selected=null}),i(a,b,c)}function k(a,b,c,d){return 1===g(a,b,d,c)}function l(a,b,c,d){if(1===c.length)return c[0];var e=a.root().node().getBoundingClientRect(),f=a.invertCoord([b.clientX-e.left,b.clientY-e.top]),g=f[0],h=f[1];switch(a.layoutEngine().rankdir()){case"TB":return h>d.cola.y?"out":"in";case"BT":return h<d.cola.y?"out":"in";case"LR":return g>d.cola.x?"out":"in";case"RL":return g<d.cola.x?"out":"in"}throw new Error("unknown rankdir "+a.layoutEngine().rankdir())}function m(f,h,m){function n(c){var d=l(f,a.event,e,c),j=f.nodeKey.eval(c);Promise.resolve(b(j,d)).then(function(a){var b={dir:d,n:Math.max(0,a-g(f,m,d,j))};h.each(function(a){a.dcg_expand_selected=a===c?b:null}),i(f,h,m)})}function o(b){function g(){var a=l(f,j,e,b);b.dcg_expanded=b.dcg_expanded||{},b.dcg_expanded[a]?(d(f.nodeKey.eval(b),k.bind(null,f,m,a),a),b.dcg_expanded[a]=!1):(c(f.nodeKey.eval(b),a,"dblclick"===j.type),b.dcg_expanded[a]=!0),i(f,h,m),b.dcg_dblclk_timeout=null}var j=a.event;return console.log(j.type),g()}h.on("mouseover.expand-collapse",n).on("mousemove.expand-collapse",n).on("mouseout.expand-collapse",function(a){j(f,h,m)}).on("click",o).on("dblclick",o)}function n(a,b,c){b.on("mouseover.expand-collapse",null).on("mouseout.expand-collapse",null),j(a,b)}if(e=e||["both"],e.length>2)throw new Error("there are only two directions to expand in");return S.behavior("expand-collapse",{add_behavior:m,first:f,remove_behavior:n})},S.draw_graphs=function(b){function c(){var a=w.filter(function(a){return a.source&&a.target}),b=v.selectAll("line.hint-edge").data(a);b.exit().remove(),b.enter().append("line").attr("class","hint-edge").style({fill:"none",stroke:"black","pointer-events":"none"}),b.attr({x1:function(a){return a.source.x},y1:function(a){return a.source.y},x2:function(a){return a.target.x},y2:function(a){return a.target.y}})}function d(){w=[],t=u=null,c()}function e(a,b,c){if(!x.nodeCrossfilter())throw new Error("need nodeCrossfilter");var d,e=x.addNode()||s;c?d=c:(d={},d[m]=h(),d[q]=""),b&&l.new_node(d[m],d,{x:b[0],y:b[1]}),e(d).then(function(b){b&&(x.nodeCrossfilter().add([b]),a.redrawGroup(),j.set_changed([b[m]]))})}function f(a,b,c){if(!x.edgeCrossfilter())throw new Error("need edgeCrossfilter");var d={},e=x.addEdge()||s;if(d[n]=h(),d[r]="",x.conduct().detectReversedEdge&&x.conduct().detectReversedEdge(d,b.port,c.port)){d[o]=c.node.orig.key,d[p]=b.node.orig.key;var f;f=b,b=c,c=f}else d[o]=b.node.orig.key,d[p]=c.node.orig.key;e(d,b.port,c.port).then(function(b){b&&(l.new_edge(d[n],b[o],b[p]),x.edgeCrossfilter().add([b]),j.set_changed([],!1),k.set_changed([b[n]],!1),a.redrawGroup())})}function g(b,g,h,i){var j=b.child("select-nodes");j&&x.clickCreatesNodes()&&j.clickBackgroundClears(!1),g.on("mousedown.draw-graphs",function(c){if(a.event.stopPropagation(),x.dragCreatesEdges()){if(x.usePorts()){var e;if(e="object"==typeof x.usePorts()&&x.usePorts().eventPort?x.usePorts().eventPort():b.getPort(b.nodeKey.eval(c),null,"out")||b.getPort(b.nodeKey.eval(c),null,"in"),!e)return;t={node:c,port:e},w=[{source:{x:c.cola.x+e.pos.x,y:c.cola.y+e.pos.y}}]}else t={node:c},w=[{source:{x:t.node.cola.x,y:t.node.cola.y}}];x.conduct().startDragEdge&&(x.conduct().startDragEdge(t)||d())}}).on("mousemove.draw-graphs",function(d){if(a.event.stopPropagation(),t){var e=u;if(d===t.node)u=null,w[0].target=null;else if(x.usePorts()){var f;f="object"==typeof x.usePorts()&&x.usePorts().eventPort?x.usePorts().eventPort():b.getPort(b.nodeKey.eval(d),null,"in")||b.getPort(b.nodeKey.eval(d),null,"out"),u=f?{node:d,port:f}:null}else u&&d===u.node||(u={node:d});if(x.conduct().changeDragTarget){var g;if(x.usePorts()){var h=e&&e.port,i=u&&u.port;g=h!==i}else{var j=e&&e.node,k=u&&u.node;g=j!==k}g&&!x.conduct().changeDragTarget(t,u)&&(u=null)}if(u)u.port?w[0].target={x:d.cola.x+f.pos.x,y:d.cola.y+f.pos.y}:w[0].target={x:d.cola.x,y:d.cola.y};else{var l=S.event_coords(b);w[0].target={x:l[0],y:l[1]}}c()}}).on("mouseup.draw-graphs",function(a){if(t&&u){var c;c=x.conduct().finishDragEdge?x.conduct().finishDragEdge(t,u):Promise.resolve(!0);var e=t,g=u;c.then(function(a){a&&f(b,e,g)})}else t&&x.conduct().cancelDragEdge&&x.conduct().cancelDragEdge(t);d()}),b.svg().on("mousedown.draw-graphs",function(){t=null}).on("mousemove.draw-graphs",function(){if(t){var a=S.event_coords(b);x.conduct().dragCanvas&&x.conduct().dragCanvas(t,a),x.conduct().changeDragTarget&&u&&x.conduct().changeDragTarget(t,null),u=null,w[0].target={x:a[0],y:a[1]},c()}}).on("mouseup.draw-graphs",function(){t?(x.conduct().cancelDragEdge&&x.conduct().cancelDragEdge(t),d()):a.event.target===this&&x.clickCreatesNodes()&&e(b,S.event_coords(b))}),v||(v=b.g().append("g").attr("class","draw-graphs"))}function i(a,b,c,d){b.on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null),a.svg().on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null)}var j=S.select_things_group(b.select_nodes_group||"select-nodes-group","select-nodes"),k=S.select_things_group(b.select_edges_group||"select-edges-group","select-edges"),l=(S.label_things_group("label-nodes-group","label-nodes"),S.label_things_group("label-edges-group","label-edges"),S.fix_nodes_group("fix-nodes-group")),m=b.idTag||"id",n=b.edgeIdTag||m,o=b.sourceTag||"source",p=b.targetTag||"target",q=b.labelTag||"label",r=b.edgeLabelTag||q,t=null,u=null,v=null,w=[],x=S.behavior("highlight-paths",{add_behavior:g,remove_behavior:i});return x.nodeCrossfilter=T(b.nodeCrossfilter),x.edgeCrossfilter=T(b.edgeCrossfilter),x.usePorts=T(null),x.clickCreatesNodes=T(!0),x.dragCreatesEdges=T(!0),x.conduct=T({}),x.addNode=T(null),x.addEdge=T(null),x.createNode=function(a,b){e(x.parent(),a,b)},x},S.match_ports=function(a,b){function c(b,c){return b.map(function(b){return b.state=c,a.portNodeKey.eval(b)})}function d(d){var e=c(i,"small");d.port.state="small",e.push(a.portNodeKey.eval(d.port)),b.animateNodes(e)}function e(a,b){return(j.allowParallel()||!h.some(function(c){return a.edges.indexOf(c)>=0&&b.edges.indexOf(c)>=0}))&&j.isValid()(a,b)}var f,g,h,i;a.on("data.match-ports",function(a,b,c,d,e,i,j){f=i,g=j,h=e});var j={isValid:T(function(a,b){return b!==a&&b.name===a.name}),allowParallel:T(!1),hoverPort:function(a){if(a){if(i=g.filter(e.bind(null,a)),i.length)return c(i,"shimmer-medium")}else if(i)return c(i,"small");return null},startDragEdge:function(d){i=g.filter(e.bind(null,d.port));var f=c(i,"shimmer");return i.length&&(b.enableHover(!1),d.port.state="large",f.push(a.portNodeKey.eval(d.port)),b.animateNodes(f)),console.log("valid targets",f),0!==i.length},changeDragTarget:function(a,d){var f,g,h=d&&e(a.port,d.port);return h?(f=c(i,"small"),d.port.state="large"):(f=c(i,"small"),g=b.animateNodes(f),f=c(i,"shimmer")),b.animateNodes(f,g),h},finishDragEdge:function(a,c){return b.enableHover(!0),d(a),Promise.resolve(e(a.port,c.port))},cancelDragEdge:function(a){return b.enableHover(!0),d(a),!0}};return j},S.match_opposites=function(b,c,d){function e(a){return{x:a.node.cola.x+a.pos.x,y:a.node.cola.y+a.pos.y}}function f(a,b){return(n.allowParallel()||!l.some(function(c){return a.edges.indexOf(c)>=0&&b.edges.indexOf(c)>=0}))&&n.isValid()(a,b)}function g(a,b){b.forEach(function(a){a.edges.forEach(function(a){a.deleting=0})}),a&&a.port.edges.forEach(function(a){a.deleting=0})}d=Object.assign({multiplier:2,ease:a.ease("cubic")},d);var h,i,l,m;b.cascade(100,!0,k(function(a){return d.ease(a.deleting||0)},c,j)),b.on("data.match-opposites",function(a,b,c,d,e,f,g){h=f,i=g,l=e});var n={isValid:T(function(a,c){return"in"===b.portName.eval(a)^"in"===b.portName.eval(c)}),allowParallel:T(!1),hoverPort:function(a){},startDragEdge:function(a){return m=i.filter(f.bind(null,a.port)),console.log("valid targets",m.map(b.portNodeKey.eval)),0!==m.length},dragCanvas:function(a,c){var f=m.map(function(a){var b=e(a);return{distance:Math.hypot(c[0]-b.x,c[1]-b.y),port:a}}).sort(function(a,b){return a.distance-b.distance}),g=e(f[0].port),h=e(a.port);f.forEach(function(a){a.port.edges.forEach(function(b){b.deleting=1-d.multiplier*a.distance/Math.hypot(g.x-h.x,g.y-h.y)})}),a.port.edges.forEach(function(a){a.deleting=1-d.multiplier*f[0].distance/Math.hypot(g.x-h.x,g.y-h.y)}),b.refresh()},changeDragTarget:function(a,c){var d=c&&f(a.port,c.port);return d&&(c.port.edges.forEach(function(a){a.deleting=1}),a.port.edges.forEach(function(a){a.deleting=1}),g(null,m.filter(function(a){return a!==c.port})),b.refresh()),d},finishDragEdge:function(a,c){if(f(a.port,c.port)){if(g(null,m.filter(function(a){return a!==c.port})),d.delete_edges){var e=a.port.edges.map(b.edgeKey.eval).concat(c.port.edges.map(b.edgeKey.eval));return d.delete_edges.deleteSelection(e)}return Promise.resolve(!0)}return g(a,m),Promise.resolve(!1)},cancelDragEdge:function(a){return g(a,m),!0},detectReversedEdge:function(a,c,d){return"in"===b.portName.eval(c)}};return n},S.wildcard_ports=function(a){var b=a.get_type||function(a){return a.name},c=a.set_type||function(a,b){a.name=b},d=a.is_wild||function(a){return a.orig.value.wild},e=a.update_ports||function(){};return{isValid:function(a,c){return null===b(a)^null===b(c)||null!==b(a)&&b(a)===b(c)},copyType:function(a,d,f){return null===b(d)?(c(d,f),e()):null===b(f)&&(c(f,d),e()),Promise.resolve(a)},resetTypes:function(a,b){return b.forEach(function(b){var e=a.getWholeEdge(b),f=a.getPort(a.nodeKey.eval(e.source),null,a.edgeSourcePortName.eval(e));d(f)&&1===f.edges.length&&c(f,null);var f=a.getPort(a.nodeKey.eval(e.target),null,a.edgeTargetPortName.eval(e));d(f)&&1===f.edges.length&&c(f,null)}),Promise.resolve(b)}}},S.symbol_port_style=function(){function b(a){return a.named?a.name:q.parent().edgeKey.eval(a.edges[0])}function c(a){var b=q.color.eval(a);return b?q.colorScale()(b):"none"}function d(a){var b=Math.hypot(a.pos.x,a.pos.y),c={x:a.pos.x/b,y:a.pos.y/b},d=q.displacement.eval(a),e={x:a.pos.x+d*c.x,y:a.pos.y+d*c.y};return"translate("+e.x+","+e.y+")"}function f(b,c){var d=q.symbol.eval(b);return d&&a.svg.symbol().type(q.symbolScale()(d)).size(c*c)()}function g(a){return a.vec[0]<0}function h(a){switch(a.state){case"large":return q.largeRadius.eval(a);case"medium":return q.mediumRadius.eval(a);case"small":default:return q.smallRadius.eval(a)}}function i(a){return/-medium$/.test(a.state)?q.mediumRadius.eval(a):q.largeRadius.eval(a)}function j(a){var b,c;return q.outlineFill.eval(a)?(b=q.outlineFillScale()||e,c=q.outlineFill.eval(a)):(b=q.parent().nodeFillScale()||e,c=q.parent().nodeFill.eval(a.node)),"none"===c?"none":b(c)}function k(a){return q.outlineStroke.eval(a)||q.parent().nodeStroke.eval(a.node)}function l(a){var b=q.outlineStrokeWidth.eval(a);return"number"==typeof b?b:q.parent().nodeStrokeWidth.eval(a.node)}var m,o,p,q={};return q.symbolScale=T(a.shuffle(a.scale.ordinal().range(a.svg.symbolTypes))),q.colorScale=T(a.scale.ordinal().range(a.shuffle(["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]))),q.symbol=q.portSymbol=T(b,!1),q.color=q.portColor=T(b,!1),q.outline=T(S.symbol_port_style.outline.circle()),q.smallRadius=q.portRadius=T(7),q.mediumRadius=q.portHoverNodeRadius=T(10),q.largeRadius=q.portHoverPortRadius=T(14),q.displacement=q.portDisplacement=T(2),q.outlineFillScale=q.portBackgroundScale=T(null),q.outlineFill=q.portBackgroundFill=T(null),q.outlineStroke=q.portBackgroundStroke=T(null),q.outlineStrokeWidth=q.portBackgroundStrokeWidth=T(null),q.padding=q.portPadding=T(2),q.label=q.portLabel=q.portText=T(function(a){return a.name}),q.portLabelPadding=T({x:5,y:5}),q.cascade=n(q),q.animateNodes=function(b,c){function d(){var a=l.transition().duration(1e3).ease("bounce");a.selectAll(".port-outline").call(q.outline().draw(function(a){return i(a)+q.portPadding.eval(a)})),a.selectAll("path.port-symbol").attr({d:function(a){return f(a,i(a))}});var b=a.transition().duration(1e3).ease("sin");b.selectAll(".port-outline").call(q.outline().draw(function(a){return q.smallRadius.eval(a)+q.portPadding.eval(a)})),b.selectAll("path.port-symbol").attr({d:function(a){return f(a,q.smallRadius.eval(a))}}),b.each("end",d)}function e(a){return"large"===a.state||"medium"===a.state}var g=a.set(b),j=o.filter(function(a){return g.has(q.parent().nodeKey.eval(a))}),k=j.selectAll("g.port"),l=k.filter(function(a){return/^shimmer/.test(a.state)}),n=k.filter(function(a){return!/^shimmer/.test(a.state)});l.size()&&(c?c.each("end",d):d());var p=n.transition().duration(250);return p.selectAll(".port-outline").call(q.outline().draw(function(a){return h(a)+q.portPadding.eval(a)})),p.selectAll("path.port-symbol").attr({d:function(a){return f(a,h(a))}}),p.selectAll("text.port-label").attr({opacity:function(a){return e(a)?1:0},"pointer-events":function(a){return e(a)?"auto":"none"}}),p.selectAll("rect.port-label-background").attr("opacity",function(a){return e(a)?1:0}),o.filter(function(a){var b=m[q.parent().nodeKey.eval(a)];return b&&b.some(e)}).each(function(){this.parentNode.appendChild(this)}),k.filter(function(a){return"small"!==a.state}).each(function(){this.parentNode.appendChild(this)}),p},q.eventPort=function(){var b=a.select(a.event.target.parentNode);return"g"===a.event.target.parentNode.tagName&&b.classed("port")?b.datum():null},q.drawPorts=function(a,e){m=a,o=e;var h=e.selectAll("g.port").data(function(b){return a[q.parent().nodeKey.eval(b)]||[]},b);h.exit().remove();var i=h.enter().append("g").attr({class:"port",transform:d});h.transition("port-position").duration(q.parent().stagedDuration()).delay(q.parent().stagedDelay(!1)).attr({transform:d});var n=h.selectAll(".port-outline").data(function(a){return"none"!==j(a)?[a]:[]});n.exit().remove();var p=n.enter().append(q.outline().tag()).attr({class:"port-outline",fill:j,"stroke-width":l,stroke:k});q.outline().init&&p.call(q.outline().init),p.call(q.outline().draw(function(a){return q.smallRadius.eval(a)+q.portPadding.eval(a)})),n.attr({fill:j,"stroke-width":l,stroke:k}),n.transition().duration(q.parent().stagedDuration()).delay(q.parent().stagedDelay(!1)).call(q.outline().draw(function(a){return q.smallRadius.eval(a)+q.portPadding.eval(a)}));var r=(i.append("path").attr({class:"port-symbol",d:function(a){return f(a,q.smallRadius.eval(a))}}),h.select("path.port-symbol"));r.attr("fill",c),r.transition().duration(q.parent().stagedDuration()).delay(q.parent().stagedDelay(!1)).attr({d:function(a){return f(a,q.smallRadius.eval(a))}});var s=h.selectAll("text.port-label").data(function(a){return q.portLabel.eval(a)?[a]:[]});s.exit().remove();var t=s.enter();return t.append("rect").attr({class:"port-label-background","pointer-events":"none"}),t.append("text").attr({class:"port-label","alignment-baseline":"middle","pointer-events":"none",cursor:"default",opacity:0}),s.each(function(a){a.offset=(g(a)?-1:1)*(q.largeRadius.eval(a)+q.portPadding.eval(a))}).attr({"text-anchor":function(a){return g(a)?"end":"start"},transform:function(a){return"translate("+a.offset+",0)"}}).text(q.portLabel.eval).each(function(a){a.bbox=this.getBBox()}),h.selectAll("rect.port-label-background").attr({x:function(a){return(a.offset<0?a.offset-a.bbox.width:a.offset)-q.portLabelPadding.eval(a).x},y:function(a){return-a.bbox.height/2-q.portLabelPadding.eval(a).y},width:function(a){return a.bbox.width+2*q.portLabelPadding.eval(a).x},height:function(a){return a.bbox.height+2*q.portLabelPadding.eval(a).y},fill:"white",opacity:0}),q.enableHover(!0),q},q.enableHover=function(a){if(!p&&q.parent()){var b=q.parent().child("draw-graphs");b&&(p=b.conduct())}return a?(o.on("mouseover.grow-ports",function(a){var b=q.parent().nodeKey.eval(a),c=q.eventPort();m[b]&&m[b].forEach(function(a){a.state=a===c?"large":c?"small":"medium"});var d=p&&p.hoverPort(c)||[];d.push(b),q.animateNodes(d)}),o.on("mouseout.grow-ports",function(a){var b=q.parent().nodeKey.eval(a);m[b]&&m[b].forEach(function(a){a.state="small"});var c=p&&p.hoverPort(null)||[];c.push(b),q.animateNodes(c)})):(o.on("mouseover.grow-ports",null),o.on("mouseout.grow-ports",null)),q},q.parent=T(null),q},S.symbol_port_style.outline={},S.symbol_port_style.outline.circle=function(){return{tag:function(){return"circle"},draw:function(a){return function(b){b.attr("r",function(b){return a(b)})}}}},S.symbol_port_style.outline.square=function(){return{tag:function(){return"rect"},init:function(a){},draw:function(a){return function(b){b.attr({x:function(b){return-a(b)},y:function(b){return-a(b)},width:function(b){return 2*a(b)},height:function(b){return 2*a(b)}})}}}},S.symbol_port_style.outline.arrow=function(){var a=.75-Math.PI/8,b={tag:function(){return"path"},init:function(a){},draw:function(c){return function(d){d.attr("d",function(d){var e=c(d);return!b.outie()||b.outie()(d.orig)?"M"+-a*e+","+-e+" h"+e+" l"+e+","+e+" l"+-e+","+e+" h"+-e+" a"+e+","+e+" 0 1,1 0,"+-2*e:"M"+-(2-a)*e+","+-e+" h"+2*e+" a"+e+","+e+" 0 1,1 0,"+2*e+" h"+-2*e+" l"+e+","+-e+" l"+-e+","+-e})}},outie:T(null)};return b},S.load_graph=function(){function b(a){return a?a.replace(/\?.*/,""):null}var c,d,e;if(c=arguments[0],3===arguments.length)d=arguments[1],e=arguments[2];else{if(2!==arguments.length)throw new Error("need two or three arguments");e=arguments[1]}d?queue().defer(a.json,c).defer(a.json,d).await(function(a,b,c){a?e(a,null):e(null,{nodes:b.results,edges:c.results})}):/\.json$/.test(b(c))?a.json(c,e):/\.gv|\.dot$/.test(b(c))?a.text(c,P.bind(null,e)):/\.psv$/.test(b(c))?a.dsv("|","text/plain")(c,Q.bind(null,e)):/\.csv$/.test(b(c))&&a.csv(c,Q.bind(null,e))},S.munge_graph=function(a,b,c,d){function e(a,b){return b.filter(function(b){return!!a[b]})}var f,g,h=b||"name",i=c||"sourcename",j=d||"targetname";if(!R(a)){var k=["database","response"],l=k.findIndex(function(b){return a[b]&&R(a[b])});if(l<0)throw new Error("couldn't find the data!");a=a[k[l]]}g=a.edges||a.links,f=a.nodes||a.vertices;var m=g[0];if(void 0===m[i]){var n=c?[c]:["source_ecomp_uid","node1","source","tail"],o=d?[d]:["target_ecomp_uid","node2","target","head"],p=["edge"];if(m.node0&&m.node1)i="node0",j="node1";else{var q=e(m,n);if(!q.length){if(l=p.findIndex(function(a){return m[a]&&e(m[a],n).length}),l<0)throw c?new Error("sourceattr "+i+" didn't work"):new Error("didn't find any source attr");g=g.map(function(a){return a[p[l]]}),m=g[0],q=e(m,n)}if(q.length>1&&console.warn("found more than one possible source attr",q),i=q[0],q=e(m,o),!q.length)throw d&&!m[d]?new Error("targetattr "+j+" didn't work"):new Error("didn't find any target attr");q.length>1&&console.warn("found more than one possible target attr",q),j=q[0]}}var r=f[0];if(void 0===r[h]){var s=b?[b]:["ecomp_uid","id","_id"],t=["vertex"];if(q=e(r,s),!q.length){if(l=t.findIndex(function(a){return r[a]&&e(r[a],s).length}),l<0)throw b?new Error("nodekeyattr "+h+" didn't work"):new Error("couldn't find the node data");f=f.map(function(a){return a[t[l]]}),r=f[0],q=e(r,s)}q.length>1&&console.warn("found more than one possible node key attr",q),h=q[0]}return{nodes:f,edges:g,nodekeyattr:h,sourceattr:i,targetattr:j}},S.flat_group=function(){function a(a){return{all:function(){return a.all().filter(function(a){return null!==a.value})}}}function c(b,c){var e=b.dimension(c);return{crossfilter:b,dimension:e,group:a(e.group().reduce(d.add,d.remove,d.init))}}var d={add:function(a,b){return b},remove:function(){return null},init:function(){return null}};return{make:function(a,d){var e=b(a);return c(e,d)},another:function(a,b){return c(a,b)}}}();var $=function(a,b,d,e,f,g){if(f=f||0,b.length>(d.valuesByAttr?1:0)){var i=b.shift(),j=[],k=[],l=a.map(function(a){var c=a[d.nestKey],l=d.nestKeysUnique?c:h();if(l){var m;if(d.ancestorKeys?(g=g||{},i&&(g[i]=c),m=Object.assign({},g)):m={},m[d.nodeKey]=l,d.label&&d.labelFun&&(m[d.label]=d.labelFun(c,i,a)),d.level&&(m[d.level]=f+1),j.push(m),e){var n={};n[d.edgeSource]=e,n[d.edgeTarget]=l,k.push(n)}}var o=d.valuesByAttr?a[b[0]]:a.values,p=$(o,b.slice(0),d,l,f+1,Object.assign({},g));return p});return{nodes:Array.prototype.concat.apply(j,l.map(c.pluck("nodes"))),edges:Array.prototype.concat.apply(k,l.map(c.pluck("edges")))}}return{nodes:a.map(function(a){return a=Object.assign({},a),d.level&&(a[d.level]=f+1),a}),edges:a.map(function(a){var b={};return b[d.edgeSource]=e,b[d.edgeTarget]=a[d.nodeKey],b})}};return S.convert_tree=function(a,b,c){return c=Object.assign({nodeKey:"key",edgeKey:"key",edgeSource:"sourcename",edgeTarget:"targetname",nestKey:"key"},c),Array.isArray(a)?$(a,b,c,c.root,0,c.inherit):(b=[""].concat(b),$([a],b,c,c.root,0,c.inherit))},S.convert_nest=function(a,b,c,d,e,f,g){return S.convert_tree(a,b,{nodeKey:c,edgeSource:d,edgeTarget:e,root:f,inherit:g,ancestorKeys:!0,label:"name",labelFun:function(a,b,c){return b+":"+a},level:"_level"})},S.convert_adjacency_list=function(a,b,c){var d=Array.prototype.concat.apply([],a.map(function(a){return a[b.adjacencies].map(function(d){var e={};return c.edgeKey&&(e[c.edgeKey]=h()),e[c.edgeSource]=a[b.nodeKey],e[c.edgeTarget]=b.targetKey?d[b.targetKey]:d,c.adjacency&&(e[c.adjacency]=d),e})}));return{nodes:a,edges:d}},S.path_reader=function(a){function b(a,b,c){h.elementList.eval(a).forEach(function(d){var e,f;switch(h.elementType.eval(d)){case"node":e=h.nodeKey.eval(d),f=b[e]=b[e]||[];break;case"edge":e=h.edgeSource.eval(d)+"-"+h.edgeTarget.eval(d),f=c[e]=c[e]||[]}f.push(a)})}var c,d,f,g=S.register_highlight_paths_group(a||"highlight-paths-group"),h={pathList:T(e,!1),timeRange:T(null,!1),elementList:T(e,!1),elementType:T(null,!1),nodeKey:T(null,!1),edgeSource:T(null,!1),edgeTarget:T(null,!1),clear:function(){g.paths_changed({},{},[])},data:function(a){var e,i={},j={},k=[];h.pathList.eval(a).forEach(function(a){if(a._range=h.timeRange.eval(a)){if(e===!1)throw new Error("can't have a mix of ranged and non-ranged paths");e=!0}else{if(e===!0)throw new Error("can't have a mix of ranged and non-ranged paths");e=!1,b(a,i,j)}k.push(a)}),e?(c=k.map(function(a){var b=[a._range[0].getTime(),a._range[1].getTime()];return b.path=a,b}),d=lysenkoIntervalTree(c),f&&this.setTime(f)):(c=null,d=null,g.paths_changed(i,j,k))},getIntervals:function(){return c},setTime:function(a){if(a&&d){var c=[],e={},h={};d.queryPoint(a.getTime(),function(a){c.push(a.path),b(a.path,e,h)}),g.paths_changed(e,h,c)}f=a}};return h},S.path_selector=function(b,d,e,f){function g(a){return function(b){return!!a&&a.indexOf(b)>=0}}function h(a){var b=g(a);return function(a){return!b(a)}}function i(a,b){return a?b?b.every(g(a))?a.filter(h(b)):a.concat(b.filter(h(a))):a:b}function j(a){var b=n.selectAll("span.path-selector").data(a);b.enter().append("span").attr("class","path-selector").style({"border-width":"1px","border-style":"solid","border-color":"grey","border-radius":"4px",display:"inline-block",padding:"4px",cursor:"pointer",margin:"5px"}),b.exit().transition(1e3).attr("opacity",0).remove(),b.text(function(a,b){return"path "+(b+1)+" ("+d.elementList.eval(a).length+")"}).on("mouseover",function(a){m.hover_changed([a])}).on("mouseout",function(a){m.hover_changed(null)}).on("click",function(a){m.select_changed(i(q,[a]))});var c=n.selectAll("span.no-paths").data(0===a.length?[0]:[]);c.exit().remove(),c.enter().append("span").attr("class","no-paths"),c.classed("error",!!r.error_text()).text(r.error_text()||(r.queried()?r.zero_text():r.default_text()))}function k(){var a=g(p);n.selectAll("span.path-selector").style({"border-color":function(b,c){return a(b)?"#e41a1c":"grey"},"border-width":function(b,c){return(a(b)?2:1)+"px"},padding:function(b,c){return(a(b)?3:4)+"px"}})}function l(){var a=g(q);n.selectAll("span.path-selector").style({"background-color":function(b,c){return a(b)?"#1c1ae6":"white"},color:function(b,c){return a(b)?"white":"black"}})}var m=S.register_highlight_paths_group(e||"highlight-paths-group"),n=a.select(b),o=[],p=null,q=null;m.on("paths_changed.selector",function(a,b,c){p=q=null,o=c,r.redraw()}).on("hover_changed.selector",function(a){p=a,k()}).on("select_changed.selector",function(a){q=a,l()});var r={default_text:T("Nothing here"),zero_text:T("No paths"),error_text:T(null),queried:T(!1),redraw:function(){j(o),k(),l()},render:function(){return this.redraw(),this}};return c.registerChart(r,f),r},S.node_name=function(a){if(a<26)return String.fromCharCode(97+a);if(a<52)return String.fromCharCode(65+a-26);if(a<2704)return S.node_name(Math.floor(a/52))+S.node_name(a%52);throw new Error("no, that's too large")},S.node_object=function(a,b){return b=b||{},_.extend({id:a,name:S.node_name(a)},b)},S.edge_object=function(a,b,c,d){return d=d||{},_.extend({source:b,target:c,sourcename:a(b),targetname:a(c)},d)},S.generate=function(a,b,c,d){var e,f,g,h,i=c.nodePrefix||"",j=function(a){return e[a].name},k=b[0],l=c.linkLength||30;switch(a){case"clique":case"cliquestf":for(e=new Array(k),f=[],g=0;g<k;++g)for(e[g]=S.node_object(g,{circle:"A",name:i+S.node_name(g)}),h=0;h<g;++h)f.push(S.edge_object(j,g,h,{notLayout:!0,undirected:!0}));if("cliquestf"===a)for(g=0;g<k;++g)e[g+k]=S.node_object(g+k),e[g+2*k]=S.node_object(g+2*k),f.push(S.edge_object(j,g,g+k,{undirected:!0})),f.push(S.edge_object(j,g,g+2*k,{undirected:!0}));break;case"wheel":for(e=new Array(k),g=0;g<k;++g)e[g]=S.node_object(g,{name:i+S.node_name(g)});f=S.wheel_edges(j,_.range(k),k*l/2);var m=f[0].distance;for(g=0;g<b[1];++g)for(h=0;h<k;++h){var n,o=h,p=(h+1)%k;g%2===1&&(n=o,o=p,p=n),f.push(S.edge_object(j,o,p,{distance:m,par:g+2}))}break;default:throw new Error("unknown generation type "+a)}var q={nodes:e,links:f};d(null,q)},S.wheel_edges=function(a,b,c){for(var d=b.length,e=[],f=Math.floor(d/2),g=2*c*Math.sin(Math.PI/d),h=2*c*Math.sin(f*Math.PI/d),i=0;i<d;++i)e.push(S.edge_object(a,b[i],b[(i+1)%d],{distance:g}));for(i=0;i<d/2;++i)e.push(S.edge_object(a,b[i],b[(i+f)%d],{distance:h})),d%2&&i!=Math.floor(d/2)&&e.push(S.edge_object(a,b[i],b[(i+d-f)%d],{distance:h}));return e},S.random_graph=function(a){function b(){var b={};return b[a.nodeKey]=a.nodeKeyGen(d.length),b[a.colorTag]=Math.floor(Math.random()*a.ncolors),d.push(b),b}function c(){return d[Math.floor(Math.random()*d.length)]}a=Object.assign({ncolors:5,ndashes:4,nodeKey:"key",edgeKey:"key",sourceKey:"sourcename",targetKey:"targetname",colorTag:"color",dashTag:"dash",nodeKeyGen:function(a){return"n"+a},edgeKeyGen:function(a){return"e"+a},newComponentProb:.1,newNodeProb:.9,log:!1},a),isNaN(a.newNodeProb)&&(a.newNodeProb=.9),a.newNodProb<=0&&(a.newNodeProb=.1);var d=[],e=[];return{nodes:function(){return d},edges:function(){return e},generate:function(f){for(;f-- >0;){var g,h,i=Math.random();if(g=!d.length||i<a.newComponentProb?b():c(),h=i<a.newNodeProb?b():c(),g&&h){var j={};j[a.edgeKey]=a.edgeKeyGen(e.length),j[a.sourceKey]=g[a.nodeKey],j[a.targetKey]=h[a.nodeKey],j[a.dashTag]=Math.floor(Math.random()*a.ndashes),a.log&&console.log(g[a.nodeKey]+" -> "+h[a.nodeKey]),e.push(j)}}}}},S.line_breaks=function(a,b){var c=new RegExp(a,"g");return function(a){var d,e,f=a.key,g="",h=[],i=0;do d=c.exec(f),e=d?f.slice(i,c.lastIndex):f.slice(i),g.length+e.length>b&&g.length>0&&(h.push(g),g=""),g+=e,i=c.lastIndex;while(null!==d);return h.push(g),h}},S.build_type_graph=function(a,b,c,d,e,f){var g={},h={},i={};return a.forEach(function(a){g[c(a)]=a;var b=d(a);h[b]||(h[b]={type:b})}),b.forEach(function(a){var b,c,h=e(a),j=f(a);if(!(b=g[h]))throw new Error("source key "+h+" not found!");if(!(c=g[j]))throw new Error("target key "+j+" not found!");var k=d(b)+"/"+d(c);i[k]||(i[k]={type:k,source:d(b),target:d(c)})}),{nodes:Object.keys(h).map(function(a){return h[a]}),edges:Object.keys(i).map(function(a){return i[a]})}},S.d3=a,S.crossfilter=b,S.dc=c,S}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],a);else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter);var d=require("dc");module.exports=a(b,c,d)}else this.dc_graph=a(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map